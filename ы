#include <QApplication>
#include <QMainWindow>
#include <QWidget>
#include <QVBoxLayout>
#include <QHBoxLayout>
#include <QGridLayout>
#include <QPushButton>
#include <QLabel>
#include <QTextEdit>
#include <QListWidget>
#include <QSplitter>
#include <QToolBar>
#include <QMenuBar>
#include <QMenu>
#include <QAction>
#include <QTabWidget>
#include <QFontComboBox>
#include <QSpinBox>
#include <QComboBox>
#include <QColorDialog>
#include <QFileDialog>
#include <QMessageBox>
#include <QScrollArea>
#include <QGroupBox>
#include <QToolButton>
#include <QFrame>

// Класс для Ribbon панели
class RibbonTab : public QWidget {
    Q_OBJECT
public:
    RibbonTab(const QString& title, QWidget* parent = nullptr) : QWidget(parent) {
        mainLayout = new QHBoxLayout(this);
        mainLayout->setSpacing(5);
        mainLayout->setContentsMargins(5, 5, 5, 5);
    }

    void addGroup(const QString& groupName, QWidget* groupWidget) {
        QGroupBox* group = new QGroupBox(groupName, this);
        QVBoxLayout* groupLayout = new QVBoxLayout(group);
        groupLayout->addWidget(groupWidget);
        groupLayout->addStretch();
        mainLayout->addWidget(group);
    }

private:
    QHBoxLayout* mainLayout;
};

// Класс для кнопки Ribbon с иконкой и текстом
class RibbonButton : public QToolButton {
public:
    RibbonButton(const QString& text, QWidget* parent = nullptr) : QToolButton(parent) {
        setText(text);
        setToolButtonStyle(Qt::ToolButtonTextUnderIcon);
        setMinimumSize(60, 60);
    }
};

// Главное окно приложения
class PowerPointClone : public QMainWindow {
    Q_OBJECT

public:
    PowerPointClone(QWidget *parent = nullptr) : QMainWindow(parent) {
        setupUI();
        setWindowTitle("PowerPoint Clone");
        resize(1400, 800);
    }

private slots:
    void addNewSlide() {
        QListWidgetItem* item = new QListWidgetItem("Слайд " + QString::number(slideList->count() + 1));
        slideList->addItem(item);
        slideList->setCurrentItem(item);
    }

    void deleteSlide() {
        if (slideList->currentRow() >= 0) {
            delete slideList->takeItem(slideList->currentRow());
        }
    }

    void changeFont() {
        QFont font = fontComboBox->currentFont();
        font.setPointSize(fontSizeSpinBox->value());
        slideEditor->setCurrentFont(font);
    }

    void setBold(bool checked) {
        QTextCharFormat format;
        format.setFontWeight(checked ? QFont::Bold : QFont::Normal);
        mergeFormatOnWordOrSelection(format);
    }

    void setItalic(bool checked) {
        QTextCharFormat format;
        format.setFontItalic(checked);
        mergeFormatOnWordOrSelection(format);
    }

    void setUnderline(bool checked) {
        QTextCharFormat format;
        format.setFontUnderline(checked);
        mergeFormatOnWordOrSelection(format);
    }

    void setTextColor() {
        QColor color = QColorDialog::getColor(Qt::black, this, "Выбрать цвет текста");
        if (color.isValid()) {
            QTextCharFormat format;
            format.setForeground(color);
            mergeFormatOnWordOrSelection(format);
        }
    }

    void mergeFormatOnWordOrSelection(const QTextCharFormat &format) {
        QTextCursor cursor = slideEditor->textCursor();
        if (!cursor.hasSelection())
            cursor.select(QTextCursor::WordUnderCursor);
        cursor.mergeCharFormat(format);
        slideEditor->mergeCurrentCharFormat(format);
    }

    void alignLeft() {
        slideEditor->setAlignment(Qt::AlignLeft);
    }

    void alignCenter() {
        slideEditor->setAlignment(Qt::AlignCenter);
    }

    void alignRight() {
        slideEditor->setAlignment(Qt::AlignRight);
    }

    void newPresentation() {
        slideList->clear();
        slideEditor->clear();
        addNewSlide();
    }

    void openPresentation() {
        QString fileName = QFileDialog::getOpenFileName(this, "Открыть презентацию", "", "Text Files (*.txt)");
        if (!fileName.isEmpty()) {
            QMessageBox::information(this, "Открыть", "Открытие файла: " + fileName);
        }
    }

    void savePresentation() {
        QString fileName = QFileDialog::getSaveFileName(this, "Сохранить презентацию", "", "Text Files (*.txt)");
        if (!fileName.isEmpty()) {
            QMessageBox::information(this, "Сохранить", "Сохранение файла: " + fileName);
        }
    }

private:
    void setupUI() {
        // Центральный виджет
        QWidget* centralWidget = new QWidget(this);
        QVBoxLayout* mainLayout = new QVBoxLayout(centralWidget);
        mainLayout->setSpacing(0);
        mainLayout->setContentsMargins(0, 0, 0, 0);

        // Создание Ribbon интерфейса
        createRibbon();
        mainLayout->addWidget(ribbonWidget);

        // Создание рабочей области
        createWorkArea();
        mainLayout->addWidget(workArea, 1);

        setCentralWidget(centralWidget);
    }

    void createRibbon() {
        ribbonWidget = new QWidget(this);
        QVBoxLayout* ribbonLayout = new QVBoxLayout(ribbonWidget);
        ribbonLayout->setSpacing(0);
        ribbonLayout->setContentsMargins(0, 0, 0, 0);

        // Вкладки Ribbon
        ribbonTabs = new QTabWidget(this);
        ribbonTabs->setMaximumHeight(120);

        // Вкладка "Главная"
        createHomeTab();

        // Вкладка "Вставка"
        createInsertTab();

        // Вкладка "Конструктор"
        createDesignTab();

        // Вкладка "Переходы"
        createTransitionsTab();

        // Вкладка "Анимация"
        createAnimationTab();

        // Вкладка "Слайд-шоу"
        createSlideshowTab();

        // Вкладка "Рецензирование"
        createReviewTab();

        // Вкладка "Вид"
        createViewTab();

        ribbonLayout->addWidget(ribbonTabs);
    }

    void createHomeTab() {
        QWidget* homeTab = new QWidget();
        QHBoxLayout* homeLayout = new QHBoxLayout(homeTab);
        homeLayout->setSpacing(5);
        homeLayout->setContentsMargins(5, 5, 5, 5);

        // Группа "Буфер обмена"
        QGroupBox* clipboardGroup = new QGroupBox("Буфер обмена");
        QGridLayout* clipboardLayout = new QGridLayout();
        
        RibbonButton* pasteBtn = new RibbonButton("Вставить");
        RibbonButton* copyBtn = new RibbonButton("Копировать");
        RibbonButton* cutBtn = new RibbonButton("Вырезать");
        RibbonButton* formatBtn = new RibbonButton("Формат");
        
        clipboardLayout->addWidget(pasteBtn, 0, 0, 2, 1);
        clipboardLayout->addWidget(cutBtn, 0, 1);
        clipboardLayout->addWidget(copyBtn, 1, 1);
        clipboardLayout->addWidget(formatBtn, 0, 2, 2, 1);
        clipboardGroup->setLayout(clipboardLayout);
        homeLayout->addWidget(clipboardGroup);

        // Группа "Слайды"
        QGroupBox* slidesGroup = new QGroupBox("Слайды");
        QGridLayout* slidesLayout = new QGridLayout();
        
        RibbonButton* newSlideBtn = new RibbonButton("Создать
слайд");
        connect(newSlideBtn, &QPushButton::clicked, this, &PowerPointClone::addNewSlide);
        RibbonButton* layoutBtn = new RibbonButton("Макет");
        RibbonButton* resetBtn = new RibbonButton("Восста-
новить");
        RibbonButton* sectionBtn = new RibbonButton("Раздел");
        
        slidesLayout->addWidget(newSlideBtn, 0, 0, 2, 1);
        slidesLayout->addWidget(layoutBtn, 0, 1, 2, 1);
        slidesLayout->addWidget(resetBtn, 0, 2);
        slidesLayout->addWidget(sectionBtn, 1, 2);
        slidesGroup->setLayout(slidesLayout);
        homeLayout->addWidget(slidesGroup);

        // Группа "Шрифт"
        QGroupBox* fontGroup = new QGroupBox("Шрифт");
        QGridLayout* fontLayout = new QGridLayout();
        
        fontComboBox = new QFontComboBox();
        fontComboBox->setMaximumWidth(150);
        connect(fontComboBox, QOverload<int>::of(&QFontComboBox::currentIndexChanged), 
                this, &PowerPointClone::changeFont);
        
        fontSizeSpinBox = new QSpinBox();
        fontSizeSpinBox->setRange(8, 72);
        fontSizeSpinBox->setValue(12);
        fontSizeSpinBox->setMaximumWidth(60);
        connect(fontSizeSpinBox, QOverload<int>::of(&QSpinBox::valueChanged), 
                this, &PowerPointClone::changeFont);
        
        QPushButton* boldBtn = new QPushButton("Ж");
        boldBtn->setCheckable(true);
        boldBtn->setMaximumSize(30, 25);
        boldBtn->setFont(QFont("Arial", 10, QFont::Bold));
        connect(boldBtn, &QPushButton::toggled, this, &PowerPointClone::setBold);
        
        QPushButton* italicBtn = new QPushButton("К");
        italicBtn->setCheckable(true);
        italicBtn->setMaximumSize(30, 25);
        italicBtn->setFont(QFont("Arial", 10, QFont::Normal, true));
        connect(italicBtn, &QPushButton::toggled, this, &PowerPointClone::setItalic);
        
        QPushButton* underlineBtn = new QPushButton("Ч");
        underlineBtn->setCheckable(true);
        underlineBtn->setMaximumSize(30, 25);
        QFont underlineFont("Arial", 10);
        underlineFont.setUnderline(true);
        underlineBtn->setFont(underlineFont);
        connect(underlineBtn, &QPushButton::toggled, this, &PowerPointClone::setUnderline);
        
        QPushButton* colorBtn = new QPushButton("A");
        colorBtn->setMaximumSize(30, 25);
        connect(colorBtn, &QPushButton::clicked, this, &PowerPointClone::setTextColor);
        
        fontLayout->addWidget(fontComboBox, 0, 0, 1, 6);
        fontLayout->addWidget(fontSizeSpinBox, 1, 0);
        fontLayout->addWidget(boldBtn, 1, 1);
        fontLayout->addWidget(italicBtn, 1, 2);
        fontLayout->addWidget(underlineBtn, 1, 3);
        fontLayout->addWidget(colorBtn, 1, 4);
        
        fontGroup->setLayout(fontLayout);
        homeLayout->addWidget(fontGroup);

        // Группа "Абзац"
        QGroupBox* paragraphGroup = new QGroupBox("Абзац");
        QGridLayout* paragraphLayout = new QGridLayout();
        
        QPushButton* alignLeftBtn = new QPushButton("≡");
        alignLeftBtn->setMaximumSize(30, 25);
        connect(alignLeftBtn, &QPushButton::clicked, this, &PowerPointClone::alignLeft);
        
        QPushButton* alignCenterBtn = new QPushButton("≡");
        alignCenterBtn->setMaximumSize(30, 25);
        connect(alignCenterBtn, &QPushButton::clicked, this, &PowerPointClone::alignCenter);
        
        QPushButton* alignRightBtn = new QPushButton("≡");
        alignRightBtn->setMaximumSize(30, 25);
        connect(alignRightBtn, &QPushButton::clicked, this, &PowerPointClone::alignRight);
        
        QPushButton* bulletBtn = new QPushButton("•");
        bulletBtn->setMaximumSize(30, 25);
        
        QPushButton* numberBtn = new QPushButton("1.");
        numberBtn->setMaximumSize(30, 25);
        
        paragraphLayout->addWidget(bulletBtn, 0, 0);
        paragraphLayout->addWidget(numberBtn, 0, 1);
        paragraphLayout->addWidget(alignLeftBtn, 1, 0);
        paragraphLayout->addWidget(alignCenterBtn, 1, 1);
        paragraphLayout->addWidget(alignRightBtn, 1, 2);
        
        paragraphGroup->setLayout(paragraphLayout);
        homeLayout->addWidget(paragraphGroup);

        // Группа "Рисование"
        QGroupBox* drawingGroup = new QGroupBox("Рисование");
        QGridLayout* drawingLayout = new QGridLayout();
        
        RibbonButton* shapesBtn = new RibbonButton("Фигуры");
        RibbonButton* arrangeBtn = new RibbonButton("Упоря-
дочить");
        RibbonButton* stylesBtn = new RibbonButton("Экспресс-
стили");
        
        drawingLayout->addWidget(shapesBtn, 0, 0);
        drawingLayout->addWidget(arrangeBtn, 0, 1);
        drawingLayout->addWidget(stylesBtn, 0, 2);
        
        drawingGroup->setLayout(drawingLayout);
        homeLayout->addWidget(drawingGroup);

        // Группа "Редактирование"
        QGroupBox* editingGroup = new QGroupBox("Редактирование");
        QVBoxLayout* editingLayout = new QVBoxLayout();
        
        QPushButton* findBtn = new QPushButton("Найти");
        QPushButton* replaceBtn = new QPushButton("Заменить");
        QPushButton* selectBtn = new QPushButton("Выделить");
        
        editingLayout->addWidget(findBtn);
        editingLayout->addWidget(replaceBtn);
        editingLayout->addWidget(selectBtn);
        
        editingGroup->setLayout(editingLayout);
        homeLayout->addWidget(editingGroup);

        homeLayout->addStretch();
        ribbonTabs->addTab(homeTab, "Главная");
    }

    void createInsertTab() {
        QWidget* insertTab = new QWidget();
        QHBoxLayout* insertLayout = new QHBoxLayout(insertTab);
        
        QGroupBox* tablesGroup = new QGroupBox("Таблицы");
        RibbonButton* tableBtn = new RibbonButton("Таблица");
        QVBoxLayout* tablesLayout = new QVBoxLayout();
        tablesLayout->addWidget(tableBtn);
        tablesGroup->setLayout(tablesLayout);
        insertLayout->addWidget(tablesGroup);

        QGroupBox* imagesGroup = new QGroupBox("Изображения");
        QHBoxLayout* imagesLayout = new QHBoxLayout();
        RibbonButton* pictureBtn = new RibbonButton("Рисунки");
        RibbonButton* onlineBtn = new RibbonButton("Изобра-
жения из
Интернета");
        imagesLayout->addWidget(pictureBtn);
        imagesLayout->addWidget(onlineBtn);
        imagesGroup->setLayout(imagesLayout);
        insertLayout->addWidget(imagesGroup);

        QGroupBox* illustrationsGroup = new QGroupBox("Иллюстрации");
        QHBoxLayout* illustrationsLayout = new QHBoxLayout();
        RibbonButton* shapesBtn = new RibbonButton("Фигуры");
        RibbonButton* iconsBtn = new RibbonButton("Значки");
        RibbonButton* chartBtn = new RibbonButton("Диаграмма");
        illustrationsLayout->addWidget(shapesBtn);
        illustrationsLayout->addWidget(iconsBtn);
        illustrationsLayout->addWidget(chartBtn);
        illustrationsGroup->setLayout(illustrationsLayout);
        insertLayout->addWidget(illustrationsGroup);

        insertLayout->addStretch();
        ribbonTabs->addTab(insertTab, "Вставка");
    }

    void createDesignTab() {
        QWidget* designTab = new QWidget();
        QHBoxLayout* designLayout = new QHBoxLayout(designTab);
        
        QGroupBox* themesGroup = new QGroupBox("Темы");
        RibbonButton* themesBtn = new RibbonButton("Темы");
        QVBoxLayout* themesLayout = new QVBoxLayout();
        themesLayout->addWidget(themesBtn);
        themesGroup->setLayout(themesLayout);
        designLayout->addWidget(themesGroup);

        designLayout->addStretch();
        ribbonTabs->addTab(designTab, "Конструктор");
    }

    void createTransitionsTab() {
        QWidget* transitionsTab = new QWidget();
        QHBoxLayout* transitionsLayout = new QHBoxLayout(transitionsTab);
        
        QGroupBox* transitionGroup = new QGroupBox("Переход к этому слайду");
        RibbonButton* effectBtn = new RibbonButton("Эффект");
        QVBoxLayout* transitionLayout = new QVBoxLayout();
        transitionLayout->addWidget(effectBtn);
        transitionGroup->setLayout(transitionLayout);
        transitionsLayout->addWidget(transitionGroup);

        transitionsLayout->addStretch();
        ribbonTabs->addTab(transitionsTab, "Переходы");
    }

    void createAnimationTab() {
        QWidget* animationTab = new QWidget();
        QHBoxLayout* animationLayout = new QHBoxLayout(animationTab);
        
        QGroupBox* animationGroup = new QGroupBox("Анимация");
        RibbonButton* animateBtn = new RibbonButton("Добавить
анимацию");
        QVBoxLayout* animLayout = new QVBoxLayout();
        animLayout->addWidget(animateBtn);
        animationGroup->setLayout(animLayout);
        animationLayout->addWidget(animationGroup);

        animationLayout->addStretch();
        ribbonTabs->addTab(animationTab, "Анимация");
    }

    void createSlideshowTab() {
        QWidget* slideshowTab = new QWidget();
        QHBoxLayout* slideshowLayout = new QHBoxLayout(slideshowTab);
        
        QGroupBox* startGroup = new QGroupBox("Начать показ слайдов");
        QHBoxLayout* startLayout = new QHBoxLayout();
        RibbonButton* fromBeginBtn = new RibbonButton("С начала");
        RibbonButton* fromCurrentBtn = new RibbonButton("С текущего
слайда");
        startLayout->addWidget(fromBeginBtn);
        startLayout->addWidget(fromCurrentBtn);
        startGroup->setLayout(startLayout);
        slideshowLayout->addWidget(startGroup);

        slideshowLayout->addStretch();
        ribbonTabs->addTab(slideshowTab, "Слайд-шоу");
    }

    void createReviewTab() {
        QWidget* reviewTab = new QWidget();
        QHBoxLayout* reviewLayout = new QHBoxLayout(reviewTab);
        
        QGroupBox* proofingGroup = new QGroupBox("Правописание");
        RibbonButton* spellingBtn = new RibbonButton("Орфография");
        QVBoxLayout* proofingLayout = new QVBoxLayout();
        proofingLayout->addWidget(spellingBtn);
        proofingGroup->setLayout(proofingLayout);
        reviewLayout->addWidget(proofingGroup);

        reviewLayout->addStretch();
        ribbonTabs->addTab(reviewTab, "Рецензирование");
    }

    void createViewTab() {
        QWidget* viewTab = new QWidget();
        QHBoxLayout* viewLayout = new QHBoxLayout(viewTab);
        
        QGroupBox* viewsGroup = new QGroupBox("Режимы просмотра");
        QHBoxLayout* viewsLayout = new QHBoxLayout();
        RibbonButton* normalBtn = new RibbonButton("Обычный");
        RibbonButton* sorterBtn = new RibbonButton("Сортиров-
щик слайдов");
        viewsLayout->addWidget(normalBtn);
        viewsLayout->addWidget(sorterBtn);
        viewsGroup->setLayout(viewsLayout);
        viewLayout->addWidget(viewsGroup);

        viewLayout->addStretch();
        ribbonTabs->addTab(viewTab, "Вид");
    }

    void createWorkArea() {
        workArea = new QWidget(this);
        QHBoxLayout* workLayout = new QHBoxLayout(workArea);
        workLayout->setContentsMargins(0, 0, 0, 0);

        // Левая панель - список слайдов
        slideList = new QListWidget();
        slideList->setMaximumWidth(200);
        slideList->setMinimumWidth(150);
        addNewSlide(); // Добавляем первый слайд

        // Правая панель - редактор слайда
        QWidget* editorWidget = new QWidget();
        QVBoxLayout* editorLayout = new QVBoxLayout(editorWidget);

        // Панель инструментов над редактором
        QToolBar* editorToolbar = new QToolBar();
        QPushButton* deleteSlideBtn = new QPushButton("Удалить слайд");
        connect(deleteSlideBtn, &QPushButton::clicked, this, &PowerPointClone::deleteSlide);
        editorToolbar->addWidget(deleteSlideBtn);
        editorLayout->addWidget(editorToolbar);

        // Редактор текста
        slideEditor = new QTextEdit();
        slideEditor->setPlaceholderText("Введите текст слайда...");
        editorLayout->addWidget(slideEditor);

        // Разделитель
        QSplitter* splitter = new QSplitter(Qt::Horizontal);
        splitter->addWidget(slideList);
        splitter->addWidget(editorWidget);
        splitter->setStretchFactor(1, 3);

        workLayout->addWidget(splitter);
    }

    // Виджеты
    QWidget* ribbonWidget;
    QTabWidget* ribbonTabs;
    QWidget* workArea;
    QListWidget* slideList;
    QTextEdit* slideEditor;
    QFontComboBox* fontComboBox;
    QSpinBox* fontSizeSpinBox;
};

int main(int argc, char *argv[]) {
    QApplication app(argc, argv);
    
    PowerPointClone window;
    window.show();
    
    return app.exec();
}

#include "main.moc"
