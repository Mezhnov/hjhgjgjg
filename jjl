using System;
using System.Collections.Generic;
using System.Collections.ObjectModel;
using System.IO;
using System.Linq;
using System.Net.Http;
using System.Text;
using System.Text.Json;
using System.Threading.Tasks;
using Avalonia;
using Avalonia.Controls;
using Avalonia.Controls.ApplicationLifetimes;
using Avalonia.Controls.Templates;
using Avalonia.Data;
using Avalonia.Interactivity;
using Avalonia.Layout;
using Avalonia.Markup.Xaml;
using Avalonia.Media;
using Avalonia.Media.Imaging;
using Avalonia.Threading;

namespace SteamLikeGameStore;

public class App : Application
{
    public override void Initialize()
    {
        AvaloniaXamlLoader.Load(this);
    }

    public override void OnFrameworkInitializationCompleted()
    {
        if (ApplicationLifetime is IClassicDesktopStyleApplicationLifetime desktop)
            desktop.MainWindow = new MainWindow();

        base.OnFrameworkInitializationCompleted();
    }
}

public class MainWindow : Window
{
    private ObservableCollection<Game> _games = new();
    private ObservableCollection<Game> _libraryGames = new();
    private ObservableCollection<Game> _wishlistGames = new();
    private TextBlock _statusText;
    private TextBlock _balanceText;
    private TextBlock _userNameText;
    private StackPanel _mainContent;
    private TabControl _tabControl;
    private double _userBalance = 5000.0;
    private string _userName = "Ð˜Ð³Ñ€Ð¾Ðº";
    
    // Ð¦Ð²ÐµÑ‚Ð° Ð² ÑÑ‚Ð¸Ð»Ðµ Steam
    private static readonly Color SteamDarkBlue = Color.FromRgb(27, 40, 56);
    private static readonly Color SteamBlue = Color.Parse("#1b2838");
    private static readonly Color SteamLightBlue = Color.Parse("#2a475e");
    private static readonly Color SteamGreen = Color.Parse("#5c7e10");
    private static readonly Color SteamOrange = Color.Parse("#f5ae29");
    
    public MainWindow()
    {
        Title = "Steam Store";
        Width = 1200;
        Height = 800;
        WindowStartupLocation = WindowStartupLocation.CenterScreen;
        
        InitializeGames();
        InitializeUI();
    }
    
    private void InitializeGames()
    {
        // Ð˜Ð³Ñ€Ñ‹ Ñ Ð±Ð¾Ð»ÐµÐµ Ð´ÐµÑ‚Ð°Ð»ÑŒÐ½Ð¾Ð¹ Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸ÐµÐ¹
        _games.Add(new Game(
            "Cyberpunk 2077: Phantom Liberty",
            1999,
            "RPG",
            "CD Projekt Red",
            "ÐŸÑ€Ð¾Ð´Ð¾Ð»Ð¶ÐµÐ½Ð¸Ðµ ÐºÑƒÐ»ÑŒÑ‚Ð¾Ð²Ð¾Ð¹ ÐºÐ¸Ð±ÐµÑ€Ð¿Ð°Ð½Ðº-ÑÐ°Ð³Ð¸ Ñ Ð½Ð¾Ð²Ñ‹Ð¼ ÑÑŽÐ¶ÐµÑ‚Ð¾Ð¼ Ð¸ Ð»Ð¾ÐºÐ°Ñ†Ð¸ÑÐ¼Ð¸",
            4.5,
            new DateTime(2023, 9, 26),
            "https://cdn.cloudflare.steamstatic.com/steam/apps/1091500/header.jpg"
        ));
        
        _games.Add(new Game(
            "Baldur's Gate 3",
            2499,
            "RPG",
            "Larian Studios",
            "Ð­Ð¿Ð¸Ñ‡ÐµÑÐºÐ°Ñ RPG Ñ Ð³Ð»ÑƒÐ±Ð¾ÐºÐ¸Ð¼ ÑÑŽÐ¶ÐµÑ‚Ð¾Ð¼ Ð¸ Ñ‚Ð°ÐºÑ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ð¼Ð¸ Ð±Ð¾ÑÐ¼Ð¸",
            4.8,
            new DateTime(2023, 8, 3),
            "https://cdn.cloudflare.steamstatic.com/steam/apps/1086940/header.jpg"
        ));
        
        _games.Add(new Game(
            "Counter-Strike 2",
            0,
            "Ð¨ÑƒÑ‚ÐµÑ€",
            "Valve",
            "Ð‘ÐµÑÐ¿Ð»Ð°Ñ‚Ð½Ñ‹Ð¹ Ñ‚Ð°ÐºÑ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹ ÑˆÑƒÑ‚ÐµÑ€ Ð¾Ñ‚ ÑÐ¾Ð·Ð´Ð°Ñ‚ÐµÐ»ÐµÐ¹ CS:GO",
            4.3,
            new DateTime(2023, 9, 27),
            "https://cdn.cloudflare.steamstatic.com/steam/apps/730/header.jpg"
        ));
        
        _games.Add(new Game(
            "The Witcher 3: Wild Hunt",
            599,
            "RPG",
            "CD Projekt Red",
            "ÐÐ°Ð³Ñ€Ð°Ð¶Ð´Ñ‘Ð½Ð½Ð°Ñ Ð¸Ð³Ñ€Ð° Ð³Ð¾Ð´Ð° Ñ Ð¾Ð³Ñ€Ð¾Ð¼Ð½Ñ‹Ð¼ Ð¾Ñ‚ÐºÑ€Ñ‹Ñ‚Ñ‹Ð¼ Ð¼Ð¸Ñ€Ð¾Ð¼",
            4.9,
            new DateTime(2015, 5, 18),
            "https://cdn.cloudflare.steamstatic.com/steam/apps/292030/header.jpg"
        ));
        
        _games.Add(new Game(
            "Dota 2",
            0,
            "MOBA",
            "Valve",
            "Ð‘ÐµÑÐ¿Ð»Ð°Ñ‚Ð½Ð°Ñ ÑÑ‚Ñ€Ð°Ñ‚ÐµÐ³Ð¸Ñ‡ÐµÑÐºÐ°Ñ Ð¸Ð³Ñ€Ð° Ñ Ð¼Ð¸Ð»Ð»Ð¸Ð¾Ð½Ð°Ð¼Ð¸ Ð¸Ð³Ñ€Ð¾ÐºÐ¾Ð²",
            4.2,
            new DateTime(2013, 7, 9),
            "https://cdn.cloudflare.steamstatic.com/steam/apps/570/header.jpg"
        ));
        
        _games.Add(new Game(
            "Portal 2",
            399,
            "Ð“Ð¾Ð»Ð¾Ð²Ð¾Ð»Ð¾Ð¼ÐºÐ°",
            "Valve",
            "ÐšÑƒÐ»ÑŒÑ‚Ð¾Ð²Ð°Ñ Ð³Ð¾Ð»Ð¾Ð²Ð¾Ð»Ð¾Ð¼ÐºÐ° Ñ ÑƒÐ½Ð¸ÐºÐ°Ð»ÑŒÐ½Ñ‹Ð¼ Ð³ÐµÐ¹Ð¼Ð¿Ð»ÐµÐµÐ¼",
            4.8,
            new DateTime(2011, 4, 19),
            "https://cdn.cloudflare.steamstatic.com/steam/apps/620/header.jpg"
        ));
        
        _games.Add(new Game(
            "Half-Life: Alyx",
            1499,
            "VR",
            "Valve",
            "ÐŸÑ€Ð¾Ð´Ð¾Ð»Ð¶ÐµÐ½Ð¸Ðµ Ð»ÐµÐ³ÐµÐ½Ð´Ð°Ñ€Ð½Ð¾Ð¹ ÑÐµÑ€Ð¸Ð¸ Ð² Ð²Ð¸Ñ€Ñ‚ÑƒÐ°Ð»ÑŒÐ½Ð¾Ð¹ Ñ€ÐµÐ°Ð»ÑŒÐ½Ð¾ÑÑ‚Ð¸",
            4.7,
            new DateTime(2020, 3, 23),
            "https://cdn.cloudflare.steamstatic.com/steam/apps/546560/header.jpg"
        ));
        
        _games.Add(new Game(
            "Stardew Valley",
            399,
            "Ð¡Ð¸Ð¼ÑƒÐ»ÑÑ‚Ð¾Ñ€",
            "ConcernedApe",
            "Ð Ð°ÑÑÐ»Ð°Ð±Ð»ÑÑŽÑ‰Ð°Ñ Ñ„ÐµÑ€Ð¼ÐµÑ€ÑÐºÐ°Ñ ÑÐ¸Ð¼ÑƒÐ»ÑÑ†Ð¸Ñ Ñ ÑÐ»ÐµÐ¼ÐµÐ½Ñ‚Ð°Ð¼Ð¸ RPG",
            4.8,
            new DateTime(2016, 2, 26),
            "https://cdn.cloudflare.steamstatic.com/steam/apps/413150/header.jpg"
        ));
    }
    
    private void InitializeUI()
    {
        // Ð’ÐµÑ€Ñ…Ð½ÑÑ Ð¿Ð°Ð½ÐµÐ»ÑŒ Ð½Ð°Ð²Ð¸Ð³Ð°Ñ†Ð¸Ð¸
        var topPanel = new StackPanel
        {
            Orientation = Orientation.Horizontal,
            Background = new SolidColorBrush(SteamDarkBlue),
            Height = 50,
            Margin = new Thickness(0, 0, 0, 2),
            Children =
            {
                new Button
                {
                    Content = "ðŸ  ÐœÐÐ“ÐÐ—Ð˜Ð",
                    Margin = new Thickness(20, 0, 10, 0),
                    Background = Brushes.Transparent,
                    Foreground = Brushes.White,
                    BorderThickness = new Thickness(0),
                    FontWeight = FontWeight.Bold
                },
                new Button
                {
                    Content = "ðŸ“š Ð‘Ð˜Ð‘Ð›Ð˜ÐžÐ¢Ð•ÐšÐ",
                    Margin = new Thickness(10, 0, 10, 0),
                    Background = Brushes.Transparent,
                    Foreground = Brushes.White,
                    BorderThickness = new Thickness(0),
                    FontWeight = FontWeight.Bold
                }.WithAction(() => SwitchToTab(1))
            }
        };
        
        // ÐŸÐ°Ð½ÐµÐ»ÑŒ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ
        var userPanel = new StackPanel
        {
            Orientation = Orientation.Horizontal,
            HorizontalAlignment = HorizontalAlignment.Right,
            Margin = new Thickness(0, 0, 20, 0),
            Spacing = 15,
            Children =
            {
                (_userNameText = new TextBlock
                {
                    Text = _userName,
                    Foreground = Brushes.White,
                    VerticalAlignment = VerticalAlignment.Center,
                    FontWeight = FontWeight.Bold
                }),
                (_balanceText = new TextBlock
                {
                    Text = $"ðŸ’° {_userBalance:0.00} â‚½",
                    Foreground = Brushes.Gold,
                    VerticalAlignment = VerticalAlignment.Center,
                    FontWeight = FontWeight.Bold
                }),
                new Button
                {
                    Content = "âž• ÐŸÐ¾Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÑŒ",
                    Background = new SolidColorBrush(SteamGreen),
                    Foreground = Brushes.White,
                    Padding = new Thickness(10, 5),
                    FontWeight = FontWeight.Bold
                }.WithAction(AddBalance)
            }
        };
        
        topPanel.Children.Add(userPanel);
        
        // ÐžÑÐ½Ð¾Ð²Ð½Ð¾Ð¹ ÐºÐ¾Ð½Ñ‚ÐµÐ½Ñ‚
        _mainContent = new StackPanel
        {
            Margin = new Thickness(20),
            Spacing = 20
        };
        
        // Ð—Ð°Ð³Ð¾Ð»Ð¾Ð²Ð¾Ðº Ð¼Ð°Ð³Ð°Ð·Ð¸Ð½Ð°
        var headerPanel = new StackPanel
        {
            Children =
            {
                new TextBlock
                {
                    Text = "ðŸŽ® STEAM STORE",
                    FontSize = 32,
                    FontWeight = FontWeight.Bold,
                    Foreground = Brushes.White,
                    HorizontalAlignment = HorizontalAlignment.Center
                },
                new TextBlock
                {
                    Text = "ÐžÑ‚ÐºÑ€Ð¾Ð¹Ñ‚Ðµ Ð´Ð»Ñ ÑÐµÐ±Ñ Ð»ÑƒÑ‡ÑˆÐ¸Ðµ Ð¸Ð³Ñ€Ñ‹",
                    FontSize = 16,
                    Foreground = Brushes.LightGray,
                    HorizontalAlignment = HorizontalAlignment.Center,
                    Margin = new Thickness(0, 5, 0, 20)
                }
            }
        };
        
        // ÐŸÐ¾Ð¸ÑÐºÐ¾Ð²Ð°Ñ ÑÑ‚Ñ€Ð¾ÐºÐ°
        var searchBox = new TextBox
        {
            Watermark = "ðŸ” ÐŸÐ¾Ð¸ÑÐº Ð¸Ð³Ñ€...",
            Width = 400,
            HorizontalAlignment = HorizontalAlignment.Center,
            Padding = new Thickness(10),
            FontSize = 14
        };
        
        searchBox.TextChanged += (s, e) => FilterGames(searchBox.Text);
        
        // Ð¤Ð¸Ð»ÑŒÑ‚Ñ€Ñ‹
        var filterPanel = new StackPanel
        {
            Orientation = Orientation.Horizontal,
            HorizontalAlignment = HorizontalAlignment.Center,
            Spacing = 10,
            Margin = new Thickness(0, 10, 0, 20)
        };
        
        var filters = new[] { "Ð’ÑÐµ", "RPG", "Ð¨ÑƒÑ‚ÐµÑ€", "Ð‘ÐµÑÐ¿Ð»Ð°Ñ‚Ð½Ñ‹Ðµ", "Ð¡Ð¾ ÑÐºÐ¸Ð´ÐºÐ¾Ð¹" };
        foreach (var filter in filters)
        {
            var filterButton = new Button
            {
                Content = filter,
                Padding = new Thickness(15, 8),
                Background = Brushes.Transparent,
                Foreground = Brushes.White,
                BorderBrush = Brushes.Gray,
                BorderThickness = new Thickness(1)
            };
            
            filterButton.Click += (s, e) => ApplyFilter(filter);
            filterPanel.Children.Add(filterButton);
        }
        
        // Ð¡ÐµÑ‚ÐºÐ° Ð¸Ð³Ñ€
        var gamesGrid = new UniformGrid
        {
            Columns = 3,
            HorizontalAlignment = HorizontalAlignment.Stretch,
            Margin = new Thickness(0, 20, 0, 0)
        };
        
        foreach (var game in _games)
        {
            gamesGrid.Children.Add(CreateGameCard(game));
        }
        
        // Ð¡Ñ‚Ð°Ñ‚ÑƒÑ Ð±Ð°Ñ€
        _statusText = new TextBlock
        {
            HorizontalAlignment = HorizontalAlignment.Center,
            Foreground = Brushes.LightGreen,
            FontSize = 14,
            Margin = new Thickness(0, 20, 0, 0)
        };
        
        // Ð¡Ð¾Ð±Ð¸Ñ€Ð°ÐµÐ¼ Ð¾ÑÐ½Ð¾Ð²Ð½Ð¾Ð¹ ÐºÐ¾Ð½Ñ‚ÐµÐ½Ñ‚
        _mainContent.Children.Add(headerPanel);
        _mainContent.Children.Add(searchBox);
        _mainContent.Children.Add(filterPanel);
        _mainContent.Children.Add(gamesGrid);
        _mainContent.Children.Add(_statusText);
        
        // Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ Ð²ÐºÐ»Ð°Ð´ÐºÐ¸
        _tabControl = new TabControl
        {
            TabStripPlacement = Dock.Top,
            Background = new SolidColorBrush(SteamBlue)
        };
        
        var storeTab = new TabItem
        {
            Header = "ðŸ  ÐœÐÐ“ÐÐ—Ð˜Ð",
            Content = new ScrollViewer
            {
                Content = _mainContent,
                VerticalScrollBarVisibility = ScrollBarVisibility.Auto
            }
        };
        
        var libraryTab = new TabItem
        {
            Header = "ðŸ“š Ð‘Ð˜Ð‘Ð›Ð˜ÐžÐ¢Ð•ÐšÐ",
            Content = CreateLibraryTab()
        };
        
        var wishlistTab = new TabItem
        {
            Header = "â­ Ð˜Ð—Ð‘Ð ÐÐÐÐžÐ•",
            Content = CreateWishlistTab()
        };
        
        _tabControl.Items = new[] { storeTab, libraryTab, wishlistTab };
        
        // ÐžÑÐ½Ð¾Ð²Ð½Ð¾Ð¹ ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€
        Content = new DockPanel
        {
            Background = new SolidColorBrush(SteamBlue),
            Children =
            {
                topPanel,
                _tabControl
            }
        };
        
        DockPanel.SetDock(topPanel, Dock.Top);
    }
    
    private Control CreateGameCard(Game game)
    {
        var card = new Border
        {
            Background = new SolidColorBrush(SteamLightBlue),
            CornerRadius = new CornerRadius(8),
            Margin = new Thickness(10),
            Padding = new Thickness(15),
            Width = 350,
            Height = 200
        };
        
        var contentPanel = new StackPanel
        {
            Spacing = 10
        };
        
        // Ð—Ð°Ð³Ð¾Ð»Ð¾Ð²Ð¾Ðº Ð¸Ð³Ñ€Ñ‹
        var titlePanel = new StackPanel
        {
            Orientation = Orientation.Horizontal,
            Spacing = 10
        };
        
        titlePanel.Children.Add(new TextBlock
        {
            Text = game.Name,
            FontSize = 18,
            FontWeight = FontWeight.Bold,
            Foreground = Brushes.White,
            TextWrapping = TextWrapping.Wrap,
            Width = 250
        });
        
        // Ð ÐµÐ¹Ñ‚Ð¸Ð½Ð³
        titlePanel.Children.Add(new StackPanel
        {
            Orientation = Orientation.Horizontal,
            Spacing = 3,
            Children =
            {
                new TextBlock
                {
                    Text = "â­",
                    Foreground = Brushes.Gold
                },
                new TextBlock
                {
                    Text = game.Rating.ToString("0.0"),
                    Foreground = Brushes.White,
                    FontWeight = FontWeight.Bold
                }
            }
        });
        
        contentPanel.Children.Add(titlePanel);
        
        // Ð˜Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ñ Ð¾Ð± Ð¸Ð³Ñ€Ðµ
        contentPanel.Children.Add(new TextBlock
        {
            Text = $"ðŸŽ® {game.Genre} | ðŸ¢ {game.Developer}",
            Foreground = Brushes.LightGray,
            FontSize = 12
        });
        
        contentPanel.Children.Add(new TextBlock
        {
            Text = game.Description.Length > 100 
                ? game.Description.Substring(0, 100) + "..." 
                : game.Description,
            Foreground = Brushes.White,
            TextWrapping = TextWrapping.Wrap,
            FontSize = 13,
            Height = 40
        });
        
        // ÐŸÐ°Ð½ÐµÐ»ÑŒ Ñ†ÐµÐ½Ñ‹ Ð¸ ÐºÐ½Ð¾Ð¿Ð¾Ðº
        var bottomPanel = new StackPanel
        {
            Orientation = Orientation.Horizontal,
            HorizontalAlignment = HorizontalAlignment.Stretch,
            Spacing = 10,
            Margin = new Thickness(0, 10, 0, 0)
        };
        
        var priceText = game.Price == 0 
            ? "Ð‘Ð•Ð¡ÐŸÐ›ÐÐ¢ÐÐž" 
            : $"{game.Price} â‚½";
        
        var priceColor = game.Price == 0 ? Brushes.LightGreen : Brushes.White;
        
        bottomPanel.Children.Add(new TextBlock
        {
            Text = priceText,
            FontSize = 20,
            FontWeight = FontWeight.Bold,
            Foreground = priceColor,
            VerticalAlignment = VerticalAlignment.Center
        });
        
        var buttonPanel = new StackPanel
        {
            Orientation = Orientation.Horizontal,
            HorizontalAlignment = HorizontalAlignment.Right,
            Spacing = 5
        };
        
        var buyButton = new Button
        {
            Content = game.Price == 0 ? "Ð£Ð¡Ð¢ÐÐÐžÐ’Ð˜Ð¢Ð¬" : "ÐšÐ£ÐŸÐ˜Ð¢Ð¬",
            Background = new SolidColorBrush(SteamGreen),
            Foreground = Brushes.White,
            Padding = new Thickness(15, 8),
            FontWeight = FontWeight.Bold
        }.WithAction(() => BuyGame(game));
        
        var wishButton = new Button
        {
            Content = "â­",
            Background = Brushes.Transparent,
            Foreground = Brushes.Gold,
            BorderBrush = Brushes.Gold,
            BorderThickness = new Thickness(1),
            Width = 40,
            FontWeight = FontWeight.Bold
        }.WithAction(() => AddToWishlist(game));
        
        buttonPanel.Children.Add(wishButton);
        buttonPanel.Children.Add(buyButton);
        
        bottomPanel.Children.Add(buttonPanel);
        
        contentPanel.Children.Add(bottomPanel);
        
        card.Child = contentPanel;
        
        // Ð­Ñ„Ñ„ÐµÐºÑ‚ Ð¿Ñ€Ð¸ Ð½Ð°Ð²ÐµÐ´ÐµÐ½Ð¸Ð¸
        card.PointerEntered += (s, e) =>
        {
            card.Background = new SolidColorBrush(Color.FromRgb(40, 60, 80));
        };
        
        card.PointerExited += (s, e) =>
        {
            card.Background = new SolidColorBrush(SteamLightBlue);
        };
        
        return card;
    }
    
    private Control CreateLibraryTab()
    {
        var panel = new StackPanel
        {
            Margin = new Thickness(20),
            Spacing = 20
        };
        
        panel.Children.Add(new TextBlock
        {
            Text = "ðŸ“š Ð’ÐÐ¨Ð Ð‘Ð˜Ð‘Ð›Ð˜ÐžÐ¢Ð•ÐšÐ",
            FontSize = 28,
            FontWeight = FontWeight.Bold,
            Foreground = Brushes.White,
            HorizontalAlignment = HorizontalAlignment.Center
        });
        
        if (_libraryGames.Count == 0)
        {
            panel.Children.Add(new TextBlock
            {
                Text = "Ð’Ð°ÑˆÐ° Ð±Ð¸Ð±Ð»Ð¸Ð¾Ñ‚ÐµÐºÐ° Ð¿ÑƒÑÑ‚Ð°. ÐšÑƒÐ¿Ð¸Ñ‚Ðµ Ð¸Ð³Ñ€Ñ‹ Ð² Ð¼Ð°Ð³Ð°Ð·Ð¸Ð½Ðµ!",
                FontSize = 16,
                Foreground = Brushes.LightGray,
                HorizontalAlignment = HorizontalAlignment.Center,
                Margin = new Thickness(0, 50, 0, 0)
            });
        }
        else
        {
            var libraryGrid = new UniformGrid
            {
                Columns = 2,
                HorizontalAlignment = HorizontalAlignment.Stretch
            };
            
            foreach (var game in _libraryGames)
            {
                libraryGrid.Children.Add(CreateLibraryGameCard(game));
            }
            
            panel.Children.Add(libraryGrid);
        }
        
        return new ScrollViewer
        {
            Content = panel,
            VerticalScrollBarVisibility = ScrollBarVisibility.Auto
        };
    }
    
    private Control CreateWishlistTab()
    {
        var panel = new StackPanel
        {
            Margin = new Thickness(20),
            Spacing = 20
        };
        
        panel.Children.Add(new TextBlock
        {
            Text = "â­ Ð˜Ð—Ð‘Ð ÐÐÐÐ«Ð• Ð˜Ð“Ð Ð«",
            FontSize = 28,
            FontWeight = FontWeight.Bold,
            Foreground = Brushes.White,
            HorizontalAlignment = HorizontalAlignment.Center
        });
        
        if (_wishlistGames.Count == 0)
        {
            panel.Children.Add(new TextBlock
            {
                Text = "Ð¡Ð¿Ð¸ÑÐ¾Ðº Ð¸Ð·Ð±Ñ€Ð°Ð½Ð½Ð¾Ð³Ð¾ Ð¿ÑƒÑÑ‚. Ð”Ð¾Ð±Ð°Ð²ÑŒÑ‚Ðµ Ð¸Ð³Ñ€Ñ‹ Ð¸Ð· Ð¼Ð°Ð³Ð°Ð·Ð¸Ð½Ð°!",
                FontSize = 16,
                Foreground = Brushes.LightGray,
                HorizontalAlignment = HorizontalAlignment.Center,
                Margin = new Thickness(0, 50, 0, 0)
            });
        }
        else
        {
            var wishlistGrid = new UniformGrid
            {
                Columns = 2,
                HorizontalAlignment = HorizontalAlignment.Stretch
            };
            
            foreach (var game in _wishlistGames)
            {
                wishlistGrid.Children.Add(CreateWishlistGameCard(game));
            }
            
            panel.Children.Add(wishlistGrid);
        }
        
        return new ScrollViewer
        {
            Content = panel,
            VerticalScrollBarVisibility = ScrollBarVisibility.Auto
        };
    }
    
    private Control CreateLibraryGameCard(Game game)
    {
        var card = new Border
        {
            Background = new SolidColorBrush(SteamLightBlue),
            CornerRadius = new CornerRadius(8),
            Margin = new Thickness(10),
            Padding = new Thickness(15),
            Height = 120
        };
        
        var panel = new StackPanel
        {
            Orientation = Orientation.Horizontal,
            Spacing = 15
        };
        
        panel.Children.Add(new StackPanel
        {
            Children =
            {
                new TextBlock
                {
                    Text = game.Name,
                    FontSize = 18,
                    FontWeight = FontWeight.Bold,
                    Foreground = Brushes.White
                },
                new TextBlock
                {
                    Text = $"ðŸŽ® {game.Genre} | ðŸ¢ {game.Developer}",
                    Foreground = Brushes.LightGray,
                    FontSize = 12,
                    Margin = new Thickness(0, 5, 0, 0)
                },
                new TextBlock
                {
                    Text = $"ðŸ“… ÐŸÑ€Ð¸Ð¾Ð±Ñ€ÐµÑ‚ÐµÐ½Ð¾: {game.ReleaseDate:dd.MM.yyyy}",
                    Foreground = Brushes.LightGray,
                    FontSize = 12
                }
            }
        });
        
        var buttonPanel = new StackPanel
        {
            HorizontalAlignment = HorizontalAlignment.Right,
            VerticalAlignment = VerticalAlignment.Center,
            Spacing = 10
        };
        
        buttonPanel.Children.Add(new Button
        {
            Content = "â–¶ Ð—ÐÐŸÐ£Ð¡Ð¢Ð˜Ð¢Ð¬",
            Background = new SolidColorBrush(SteamGreen),
            Foreground = Brushes.White,
            Padding = new Thickness(20, 10),
            FontWeight = FontWeight.Bold
        }.WithAction(() => LaunchGame(game)));
        
        buttonPanel.Children.Add(new Button
        {
            Content = "ðŸ—‘ Ð£Ð”ÐÐ›Ð˜Ð¢Ð¬",
            Background = Brushes.Transparent,
            Foreground = Brushes.LightCoral,
            BorderBrush = Brushes.LightCoral,
            BorderThickness = new Thickness(1),
            Padding = new Thickness(20, 5)
        }.WithAction(() => RemoveFromLibrary(game)));
        
        panel.Children.Add(buttonPanel);
        
        card.Child = panel;
        return card;
    }
    
    private Control CreateWishlistGameCard(Game game)
    {
        var card = new Border
        {
            Background = new SolidColorBrush(SteamLightBlue),
            CornerRadius = new CornerRadius(8),
            Margin = new Thickness(10),
            Padding = new Thickness(15),
            Height = 120
        };
        
        var panel = new StackPanel
        {
            Orientation = Orientation.Horizontal,
            Spacing = 15
        };
        
        panel.Children.Add(new StackPanel
        {
            Children =
            {
                new TextBlock
                {
                    Text = game.Name,
                    FontSize = 18,
                    FontWeight = FontWeight.Bold,
                    Foreground = Brushes.White
                },
                new TextBlock
                {
                    Text = $"ðŸŽ® {game.Genre} | ðŸ¢ {game.Developer}",
                    Foreground = Brushes.LightGray,
                    FontSize = 12,
                    Margin = new Thickness(0, 5, 0, 0)
                },
                new TextBlock
                {
                    Text = game.Price == 0 
                        ? "ðŸŽ Ð‘Ð•Ð¡ÐŸÐ›ÐÐ¢ÐÐž" 
                        : $"ðŸ’° {game.Price} â‚½",
                    Foreground = game.Price == 0 ? Brushes.LightGreen : Brushes.Gold,
                    FontSize = 16,
                    FontWeight = FontWeight.Bold,
                    Margin = new Thickness(0, 10, 0, 0)
                }
            }
        });
        
        var buttonPanel = new StackPanel
        {
            HorizontalAlignment = HorizontalAlignment.Right,
            VerticalAlignment = VerticalAlignment.Center,
            Spacing = 10
        };
        
        buttonPanel.Children.Add(new Button
        {
            Content = "ðŸ›’ ÐšÐ£ÐŸÐ˜Ð¢Ð¬",
            Background = new SolidColorBrush(SteamGreen),
            Foreground = Brushes.White,
            Padding = new Thickness(20, 10),
            FontWeight = FontWeight.Bold
        }.WithAction(() => BuyGame(game)));
        
        buttonPanel.Children.Add(new Button
        {
            Content = "âŒ Ð£Ð”ÐÐ›Ð˜Ð¢Ð¬",
            Background = Brushes.Transparent,
            Foreground = Brushes.LightCoral,
            BorderBrush = Brushes.LightCoral,
            BorderThickness = new Thickness(1),
            Padding = new Thickness(20, 5)
        }.WithAction(() => RemoveFromWishlist(game)));
        
        panel.Children.Add(buttonPanel);
        
        card.Child = panel;
        return card;
    }
    
    private void BuyGame(Game game)
    {
        if (_libraryGames.Any(g => g.Name == game.Name))
        {
            _statusText.Text = $"âš  Ð˜Ð³Ñ€Ð° '{game.Name}' ÑƒÐ¶Ðµ ÐµÑÑ‚ÑŒ Ð² Ð²Ð°ÑˆÐµÐ¹ Ð±Ð¸Ð±Ð»Ð¸Ð¾Ñ‚ÐµÐºÐµ!";
            return;
        }
        
        if (game.Price > _userBalance)
        {
            _statusText.Text = $"âŒ ÐÐµÐ´Ð¾ÑÑ‚Ð°Ñ‚Ð¾Ñ‡Ð½Ð¾ ÑÑ€ÐµÐ´ÑÑ‚Ð² Ð´Ð»Ñ Ð¿Ð¾ÐºÑƒÐ¿ÐºÐ¸ '{game.Name}'!";
            return;
        }
        
        if (game.Price > 0)
        {
            _userBalance -= game.Price;
            _balanceText.Text = $"ðŸ’° {_userBalance:0.00} â‚½";
        }
        
        _libraryGames.Add(game);
        RemoveFromWishlist(game);
        
        _statusText.Text = $"ðŸŽ‰ Ð’Ñ‹ Ð¿Ñ€Ð¸Ð¾Ð±Ñ€ÐµÐ»Ð¸ '{game.Name}'! Ð˜Ð³Ñ€Ð° Ð´Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð° Ð² Ð±Ð¸Ð±Ð»Ð¸Ð¾Ñ‚ÐµÐºÑƒ.";
        
        // ÐžÐ±Ð½Ð¾Ð²Ð»ÑÐµÐ¼ Ð²ÐºÐ»Ð°Ð´ÐºÑƒ Ð±Ð¸Ð±Ð»Ð¸Ð¾Ñ‚ÐµÐºÐ¸
        SwitchToTab(1);
    }
    
    private void AddToWishlist(Game game)
    {
        if (_wishlistGames.Any(g => g.Name == game.Name))
        {
            _statusText.Text = $"âš  Ð˜Ð³Ñ€Ð° '{game.Name}' ÑƒÐ¶Ðµ Ð² Ð¸Ð·Ð±Ñ€Ð°Ð½Ð½Ð¾Ð¼!";
            return;
        }
        
        _wishlistGames.Add(game);
        _statusText.Text = $"â­ Ð˜Ð³Ñ€Ð° '{game.Name}' Ð´Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð° Ð² Ð¸Ð·Ð±Ñ€Ð°Ð½Ð½Ð¾Ðµ!";
        
        // ÐŸÐµÑ€ÐµÐºÐ»ÑŽÑ‡Ð°ÐµÐ¼ÑÑ Ð½Ð° Ð²ÐºÐ»Ð°Ð´ÐºÑƒ Ð¸Ð·Ð±Ñ€Ð°Ð½Ð½Ð¾Ð³Ð¾
        SwitchToTab(2);
    }
    
    private void RemoveFromWishlist(Game game)
    {
        var gameToRemove = _wishlistGames.FirstOrDefault(g => g.Name == game.Name);
        if (gameToRemove != null)
        {
            _wishlistGames.Remove(gameToRemove);
        }
    }
    
    private void RemoveFromLibrary(Game game)
    {
        var gameToRemove = _libraryGames.FirstOrDefault(g => g.Name == game.Name);
        if (gameToRemove != null)
        {
            _libraryGames.Remove(gameToRemove);
            _statusText.Text = $"ðŸ—‘ Ð˜Ð³Ñ€Ð° '{game.Name}' ÑƒÐ´Ð°Ð»ÐµÐ½Ð° Ð¸Ð· Ð±Ð¸Ð±Ð»Ð¸Ð¾Ñ‚ÐµÐºÐ¸.";
            
            // Ð•ÑÐ»Ð¸ Ð¼Ñ‹ Ð½Ð° Ð²ÐºÐ»Ð°Ð´ÐºÐµ Ð±Ð¸Ð±Ð»Ð¸Ð¾Ñ‚ÐµÐºÐ¸, Ð½ÑƒÐ¶Ð½Ð¾ Ð¾Ð±Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ ÐºÐ¾Ð½Ñ‚ÐµÐ½Ñ‚
            if (_tabControl.SelectedIndex == 1)
            {
                SwitchToTab(1);
            }
        }
    }
    
    private void LaunchGame(Game game)
    {
        _statusText.Text = $"ðŸš€ Ð—Ð°Ð¿ÑƒÑÐºÐ°ÐµÐ¼ '{game.Name}'...";
        // Ð—Ð´ÐµÑÑŒ Ð¼Ð¾Ð¶Ð½Ð¾ Ð´Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ñ€ÐµÐ°Ð»ÑŒÐ½Ñ‹Ð¹ Ð·Ð°Ð¿ÑƒÑÐº Ð¸Ð³Ñ€Ñ‹
    }
    
    private void AddBalance()
    {
        _userBalance += 1000;
        _balanceText.Text = $"ðŸ’° {_userBalance:0.00} â‚½";
        _statusText.Text = "ðŸ’³ Ð‘Ð°Ð»Ð°Ð½Ñ Ð¿Ð¾Ð¿Ð¾Ð»Ð½ÐµÐ½ Ð½Ð° 1000 â‚½!";
    }
    
    private void FilterGames(string searchText)
    {
        // Ð’ Ñ€ÐµÐ°Ð»ÑŒÐ½Ð¾Ð¼ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ð¸ Ð·Ð´ÐµÑÑŒ Ð±Ñ‹Ð»Ð° Ð±Ñ‹ Ñ„Ð¸Ð»ÑŒÑ‚Ñ€Ð°Ñ†Ð¸Ñ ÑÐ¿Ð¸ÑÐºÐ° Ð¸Ð³Ñ€
        _statusText.Text = string.IsNullOrEmpty(searchText) 
            ? "ðŸ” ÐŸÐ¾Ð¸ÑÐº Ð¾Ñ‚ÐºÐ»ÑŽÑ‡ÐµÐ½" 
            : $"ðŸ” ÐŸÐ¾Ð¸ÑÐº: '{searchText}'";
    }
    
    private void ApplyFilter(string filter)
    {
        _statusText.Text = $"ðŸŽ¯ ÐŸÑ€Ð¸Ð¼ÐµÐ½Ñ‘Ð½ Ñ„Ð¸Ð»ÑŒÑ‚Ñ€: {filter}";
        // Ð’ Ñ€ÐµÐ°Ð»ÑŒÐ½Ð¾Ð¼ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ð¸ Ð·Ð´ÐµÑÑŒ Ð±Ñ‹Ð»Ð° Ð±Ñ‹ Ñ„Ð¸Ð»ÑŒÑ‚Ñ€Ð°Ñ†Ð¸Ñ Ð¿Ð¾ Ð¶Ð°Ð½Ñ€Ñƒ/Ñ†ÐµÐ½Ðµ
    }
    
    private void SwitchToTab(int tabIndex)
    {
        _tabControl.SelectedIndex = tabIndex;
    }
}

public class Game
{
    public string Name { get; }
    public int Price { get; }
    public string Genre { get; }
    public string Developer { get; }
    public string Description { get; }
    public double Rating { get; }
    public DateTime ReleaseDate { get; }
    public string ImageUrl { get; }
    
    public Game(string name, int price, string genre, string developer, 
                string description, double rating, DateTime releaseDate, string imageUrl)
    {
        Name = name;
        Price = price;
        Genre = genre;
        Developer = developer;
        Description = description;
        Rating = rating;
        ReleaseDate = releaseDate;
        ImageUrl = imageUrl;
    }
}

// Ð Ð°ÑÑˆÐ¸Ñ€ÐµÐ½Ð¸Ðµ Ð´Ð»Ñ ÑƒÐ´Ð¾Ð±Ð½Ð¾Ð³Ð¾ Ð´Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð¸Ñ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ð¹ Ðº ÐºÐ½Ð¾Ð¿ÐºÐ°Ð¼
public static class ButtonExtensions
{
    public static Button WithAction(this Button button, Action action)
    {
        button.Click += (s, e) => action();
        return button;
    }
}

// Ð¡Ñ‚Ð°Ñ€Ñ‚ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ
class Program
{
    public static void Main(string[] args)
        => AppBuilder.Configure<App>()
            .UsePlatformDetect()
            .LogToTrace()
            .StartWithClassicDesktopLifetime(args);
}
