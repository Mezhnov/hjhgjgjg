#include <windows.h>
#include <windowsx.h>
#include <commctrl.h>
#include <urlmon.h>
#include <gdiplus.h>
#include <string>
#include <memory>
#include <vector>
#include <shlwapi.h>
#include <cmath>
#include <chrono>
#include <thread>

#pragma comment(lib, "urlmon.lib")
#pragma comment(lib, "gdiplus.lib")
#pragma comment(lib, "comctl32.lib")
#pragma comment(lib, "shlwapi.lib")
#pragma comment(lib, "winmm.lib") // –î–ª—è —Ç–∞–π–º–µ—Ä–æ–≤

using namespace Gdiplus;

// –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –¥–ª—è —Ä–∞–∑–º–µ—Ä–æ–≤ –æ–∫–Ω–∞ –∏ —ç–ª–µ–º–µ–Ω—Ç–æ–≤
const int WINDOW_WIDTH = 900;
const int WINDOW_HEIGHT = 650;
const int BUTTON_SIZE = 32;
const int BUTTON_MARGIN = 15;
const int TITLE_BAR_HEIGHT = 50;
const int LAUNCH_BUTTON_WIDTH = 250;
const int LAUNCH_BUTTON_HEIGHT = 60;
const int SIDEBAR_WIDTH = 280;
const int CONTENT_PADDING = 30;

// –¶–≤–µ—Ç–æ–≤–∞—è —Å—Ö–µ–º–∞
const Color MAIN_COLOR(255, 41, 128, 185);      // –û—Å–Ω–æ–≤–Ω–æ–π —Å–∏–Ω–∏–π
const Color SECONDARY_COLOR(255, 52, 152, 219); // –í—Ç–æ—Ä–∏—á–Ω—ã–π —Å–∏–Ω–∏–π
const Color ACCENT_COLOR(255, 231, 76, 60);     // –ê–∫—Ü–µ–Ω—Ç–Ω—ã–π –∫—Ä–∞—Å–Ω—ã–π
const Color SUCCESS_COLOR(255, 46, 204, 113);   // –ó–µ–ª–µ–Ω—ã–π —É—Å–ø–µ—Ö–∞
const Color DARK_BG(255, 30, 39, 46);           // –¢–µ–º–Ω—ã–π —Ñ–æ–Ω
const Color LIGHT_BG(255, 44, 62, 80);          // –°–≤–µ—Ç–ª—ã–π —Ñ–æ–Ω
const Color TEXT_COLOR(255, 236, 240, 241);     // –¶–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞
const Color GLOW_COLOR(255, 52, 152, 219);      // –¶–≤–µ—Ç —Å–≤–µ—á–µ–Ω–∏—è

// –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
HWND g_hWnd = nullptr;
HWND g_hCloseButton = nullptr;
HWND g_hMinimizeButton = nullptr;
HWND g_hLaunchButton = nullptr;
HWND g_hProgressBar = nullptr;
HWND g_hStatusLabel = nullptr;
HWND g_hNewsList = nullptr;
HWND g_hVersionLabel = nullptr;
HWND g_hPlayerCount = nullptr;

std::wstring g_backgroundImagePath = L"background.jpg";
std::unique_ptr<Gdiplus::Image> g_backgroundImage;
bool g_isDragging = false;
POINT g_dragStartPoint;
RECT g_windowRect;
int g_animationPhase = 0;
bool g_glowEffect = true;
int g_glowAlpha = 0;
bool g_glowIncreasing = true;

// –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–ª—è –Ω–æ–≤–æ—Å—Ç–µ–π
struct NewsItem {
    std::wstring title;
    std::wstring date;
    std::wstring content;
};

std::vector<NewsItem> g_newsItems = {
    {L"–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ 1.5.2", L"27.01.2026", L"–î–æ–±–∞–≤–ª–µ–Ω—ã –Ω–æ–≤—ã–µ –∫–≤–µ—Å—Ç—ã –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –±–∞–≥–∏"},
    {L"–ù–æ–≤—ã–π –∏–≤–µ–Ω—Ç", L"25.01.2026", L"–ó–∏–º–Ω–∏–π –∏–≤–µ–Ω—Ç —Å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º–∏ –Ω–∞–≥—Ä–∞–¥–∞–º–∏"},
    {L"–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ä–∞–±–æ—Ç—ã", L"23.01.2026", L"–£–ª—É—á—à–µ–Ω–∞ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å —Å–µ—Ä–≤–µ—Ä–∞"},
    {L"–ö–æ–Ω–∫—É—Ä—Å —Å–∫—Ä–∏–Ω—à–æ—Ç–æ–≤", L"20.01.2026", L"–ü—Ä–∏–∑—ã –∑–∞ –ª—É—á—à–∏–µ —Å–∫—Ä–∏–Ω—à–æ—Ç—ã –∏–≥—Ä—ã"}
};

// –ü—Ä–æ—Ç–æ—Ç–∏–ø—ã —Ñ—É–Ω–∫—Ü–∏–π
LRESULT CALLBACK WndProc(HWND hWnd, UINT message, WPARAM wParam, LPARAM lParam);
void InitializeGdiPlus();
void ShutdownGdiPlus();
bool DownloadBackgroundImage(const std::wstring& url);
void CreateUIElements(HWND hWnd);
void DrawModernBackground(HDC hdc, RECT& clientRect);
void DrawSidebar(HDC hdc, RECT& clientRect);
void DrawGlowEffect(HDC hdc, RECT& clientRect);
void DrawAnimatedElements(HDC hdc, RECT& clientRect);
void UpdateProgress(int progress, const std::wstring& status);
void LaunchGame();
void UpdateAnimation();
void DrawRoundedRect(Graphics& graphics, const Rect& rect, int radius, const Brush& brush);
void DrawRoundedRectWithBorder(Graphics& graphics, const Rect& rect, int radius, const Brush& brush, const Pen& pen);

// –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
int WINAPI WinMain(HINSTANCE hInstance, HINSTANCE hPrevInstance, LPSTR lpCmdLine, int nCmdShow)
{
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è GDI+
    InitializeGdiPlus();
    
    // –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ–Ω–∞ –ø–æ —Å—Å—ã–ª–∫–µ
    std::wstring imageUrl = L"https://images.unsplash.com/photo-1519681393784-d120267933ba";
    if (!DownloadBackgroundImage(imageUrl))
    {
        MessageBox(NULL, L"–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ–Ω. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ñ–æ–Ω.", L"–í–Ω–∏–º–∞–Ω–∏–µ", MB_OK | MB_ICONINFORMATION);
    }
    
    // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∫–ª–∞—Å—Å–∞ –æ–∫–Ω–∞
    WNDCLASSEX wc = {0};
    wc.cbSize = sizeof(WNDCLASSEX);
    wc.style = CS_HREDRAW | CS_VREDRAW;
    wc.lpfnWndProc = WndProc;
    wc.hInstance = hInstance;
    wc.hCursor = LoadCursor(NULL, IDC_ARROW);
    wc.hbrBackground = (HBRUSH)(COLOR_WINDOW + 1);
    wc.lpszClassName = L"ModernLauncherWindowClass";
    
    if (!RegisterClassEx(&wc))
    {
        MessageBox(NULL, L"–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –∫–ª–∞—Å—Å–∞ –æ–∫–Ω–∞", L"–û—à–∏–±–∫–∞", MB_OK | MB_ICONERROR);
        return 1;
    }
    
    // –°–æ–∑–¥–∞–Ω–∏–µ –æ–∫–Ω–∞
    g_hWnd = CreateWindowEx(
        WS_EX_LAYERED | WS_EX_TOPMOST,
        L"ModernLauncherWindowClass",
        L"MAJESTIKA RP | LAUNCHER",
        WS_POPUP | WS_VISIBLE,
        (GetSystemMetrics(SM_CXSCREEN) - WINDOW_WIDTH) / 2,
        (GetSystemMetrics(SM_CYSCREEN) - WINDOW_HEIGHT) / 2,
        WINDOW_WIDTH,
        WINDOW_HEIGHT,
        NULL,
        NULL,
        hInstance,
        NULL
    );
    
    if (!g_hWnd)
    {
        MessageBox(NULL, L"–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –æ–∫–Ω–∞", L"–û—à–∏–±–∫–∞", MB_OK | MB_ICONERROR);
        return 1;
    }
    
    // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç–∏
    SetLayeredWindowAttributes(g_hWnd, 0, 255, LWA_ALPHA);
    
    // –°–æ–∑–¥–∞–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ UI
    CreateUIElements(g_hWnd);
    
    // –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–π–º–µ—Ä–∞ –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏
    SetTimer(g_hWnd, 1, 50, NULL); // 20 FPS
    
    // –ü–æ–∫–∞–∑–∞—Ç—å –æ–∫–Ω–æ
    ShowWindow(g_hWnd, nCmdShow);
    UpdateWindow(g_hWnd);
    
    // –¶–∏–∫–ª —Å–æ–æ–±—â–µ–Ω–∏–π
    MSG msg;
    while (GetMessage(&msg, NULL, 0, 0))
    {
        TranslateMessage(&msg);
        DispatchMessage(&msg);
    }
    
    // –û—á–∏—Å—Ç–∫–∞
    KillTimer(g_hWnd, 1);
    ShutdownGdiPlus();
    
    return (int)msg.wParam;
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è GDI+
void InitializeGdiPlus()
{
    GdiplusStartupInput gdiplusStartupInput;
    ULONG_PTR gdiplusToken;
    GdiplusStartup(&gdiplusToken, &gdiplusStartupInput, NULL);
}

// –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã GDI+
void ShutdownGdiPlus()
{
    // –û—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤ GDI+ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
}

// –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ–Ω–æ–≤–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø–æ URL
bool DownloadBackgroundImage(const std::wstring& url)
{
    DeleteFile(g_backgroundImagePath.c_str());
    
    HRESULT hr = URLDownloadToFile(NULL, url.c_str(), g_backgroundImagePath.c_str(), 0, NULL);
    
    if (SUCCEEDED(hr))
    {
        try
        {
            g_backgroundImage = std::make_unique<Gdiplus::Image>(g_backgroundImagePath.c_str());
            return true;
        }
        catch (...)
        {
            return false;
        }
    }
    
    return false;
}

// –°–æ–∑–¥–∞–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
void CreateUIElements(HWND hWnd)
{
    // –ö–Ω–æ–ø–∫–∞ –∑–∞–∫—Ä—ã—Ç–∏—è (–∫—Ä–µ—Å—Ç–∏–∫)
    g_hCloseButton = CreateWindow(
        L"BUTTON",
        L"‚úï",
        WS_CHILD | WS_VISIBLE | BS_OWNERDRAW,
        WINDOW_WIDTH - BUTTON_SIZE - BUTTON_MARGIN,
        BUTTON_MARGIN,
        BUTTON_SIZE,
        BUTTON_SIZE,
        hWnd,
        (HMENU)1001,
        (HINSTANCE)GetWindowLongPtr(hWnd, GWLP_HINSTANCE),
        NULL
    );
    
    // –ö–Ω–æ–ø–∫–∞ —Å–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏—è
    g_hMinimizeButton = CreateWindow(
        L"BUTTON",
        L"‚îÄ",
        WS_CHILD | WS_VISIBLE | BS_OWNERDRAW,
        WINDOW_WIDTH - (BUTTON_SIZE * 2) - (BUTTON_MARGIN * 2),
        BUTTON_MARGIN,
        BUTTON_SIZE,
        BUTTON_SIZE,
        hWnd,
        (HMENU)1002,
        (HINSTANCE)GetWindowLongPtr(hWnd, GWLP_HINSTANCE),
        NULL
    );
    
    // –ö–Ω–æ–ø–∫–∞ –∑–∞–ø—É—Å–∫–∞ –∏–≥—Ä—ã
    g_hLaunchButton = CreateWindow(
        L"BUTTON",
        L"üöÄ –ó–ê–ü–£–°–¢–ò–¢–¨ MAJESTIKA RP",
        WS_CHILD | WS_VISIBLE | BS_OWNERDRAW,
        (WINDOW_WIDTH - LAUNCH_BUTTON_WIDTH) / 2,
        WINDOW_HEIGHT - 120,
        LAUNCH_BUTTON_WIDTH,
        LAUNCH_BUTTON_HEIGHT,
        hWnd,
        (HMENU)1003,
        (HINSTANCE)GetWindowLongPtr(hWnd, GWLP_HINSTANCE),
        NULL
    );
    
    // –ü—Ä–æ–≥—Ä–µ—Å—Å –±–∞—Ä
    g_hProgressBar = CreateWindowEx(
        0,
        PROGRESS_CLASS,
        NULL,
        WS_CHILD | WS_VISIBLE | PBS_SMOOTH,
        (WINDOW_WIDTH - 350) / 2,
        WINDOW_HEIGHT - 180,
        350,
        12,
        hWnd,
        (HMENU)1004,
        (HINSTANCE)GetWindowLongPtr(hWnd, GWLP_HINSTANCE),
        NULL
    );
    
    SendMessage(g_hProgressBar, PBM_SETRANGE, 0, MAKELPARAM(0, 100));
    SendMessage(g_hProgressBar, PBM_SETPOS, 0, 0);
    SendMessage(g_hProgressBar, PBM_SETBARCOLOR, 0, RGB(52, 152, 219));
    SendMessage(g_hProgressBar, PBM_SETBKCOLOR, 0, RGB(44, 62, 80));
    
    // –ú–µ—Ç–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
    g_hStatusLabel = CreateWindow(
        L"STATIC",
        L"‚ö° –ì–æ—Ç–æ–≤ –∫ –∑–∞–ø—É—Å–∫—É | –ò–≥—Ä–æ–∫–æ–≤ –æ–Ω–ª–∞–π–Ω: 1,247",
        WS_CHILD | WS_VISIBLE | SS_CENTER,
        (WINDOW_WIDTH - 400) / 2,
        WINDOW_HEIGHT - 50,
        400,
        25,
        hWnd,
        (HMENU)1005,
        (HINSTANCE)GetWindowLongPtr(hWnd, GWLP_HINSTANCE),
        NULL
    );
    
    // –°–ø–∏—Å–æ–∫ –Ω–æ–≤–æ—Å—Ç–µ–π
    g_hNewsList = CreateWindowEx(
        WS_EX_CLIENTEDGE,
        L"LISTBOX",
        NULL,
        WS_CHILD | WS_VISIBLE | LBS_NOINTEGRALHEIGHT | LBS_HASSTRINGS,
        SIDEBAR_WIDTH + CONTENT_PADDING,
        TITLE_BAR_HEIGHT + 50,
        WINDOW_WIDTH - SIDEBAR_WIDTH - (CONTENT_PADDING * 2),
        300,
        hWnd,
        (HMENU)1006,
        (HINSTANCE)GetWindowLongPtr(hWnd, GWLP_HINSTANCE),
        NULL
    );
    
    // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤–æ—Å—Ç–∏ –≤ —Å–ø–∏—Å–æ–∫
    for (const auto& news : g_newsItems)
    {
        std::wstring item = news.title + L" | " + news.date;
        SendMessage(g_hNewsList, LB_ADDSTRING, 0, (LPARAM)item.c_str());
    }
    
    // –ú–µ—Ç–∫–∞ –≤–µ—Ä—Å–∏–∏
    g_hVersionLabel = CreateWindow(
        L"STATIC",
        L"üîß –í–µ—Ä—Å–∏—è: 2.1.0 | –°–±–æ—Ä–∫–∞: #2456",
        WS_CHILD | WS_VISIBLE | SS_LEFT,
        CONTENT_PADDING,
        WINDOW_HEIGHT - 40,
        300,
        20,
        hWnd,
        (HMENU)1007,
        (HINSTANCE)GetWindowLongPtr(hWnd, GWLP_HINSTANCE),
        NULL
    );
    
    // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —à—Ä–∏—Ñ—Ç–æ–≤
    HFONT hTitleFont = CreateFont(28, 0, 0, 0, FW_BOLD, FALSE, FALSE, FALSE,
                                 DEFAULT_CHARSET, OUT_DEFAULT_PRECIS, CLIP_DEFAULT_PRECIS,
                                 DEFAULT_QUALITY, DEFAULT_PITCH | FF_DONTCARE, L"Segoe UI");
    
    HFONT hNormalFont = CreateFont(16, 0, 0, 0, FW_NORMAL, FALSE, FALSE, FALSE,
                                  DEFAULT_CHARSET, OUT_DEFAULT_PRECIS, CLIP_DEFAULT_PRECIS,
                                  DEFAULT_QUALITY, DEFAULT_PITCH | FF_DONTCARE, L"Segoe UI");
    
    HFONT hSmallFont = CreateFont(14, 0, 0, 0, FW_NORMAL, FALSE, FALSE, FALSE,
                                 DEFAULT_CHARSET, OUT_DEFAULT_PRECIS, CLIP_DEFAULT_PRECIS,
                                 DEFAULT_QUALITY, DEFAULT_PITCH | FF_DONTCARE, L"Segoe UI");
    
    SendMessage(g_hStatusLabel, WM_SETFONT, (WPARAM)hNormalFont, TRUE);
    SendMessage(g_hNewsList, WM_SETFONT, (WPARAM)hSmallFont, TRUE);
    SendMessage(g_hVersionLabel, WM_SETFONT, (WPARAM)hSmallFont, TRUE);
    
    // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ü–≤–µ—Ç–æ–≤
    SendMessage(g_hNewsList, LB_SETBKCOLOR, 0, RGB(44, 62, 80));
    SendMessage(g_hNewsList, LB_SETTEXTCOLOR, 0, RGB(236, 240, 241));
}

// –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Å–∫—Ä—É–≥–ª–µ–Ω–Ω–æ–≥–æ –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫–∞
void DrawRoundedRect(Graphics& graphics, const Rect& rect, int radius, const Brush& brush)
{
    GraphicsPath path;
    
    path.AddArc(rect.X, rect.Y, radius, radius, 180, 90);
    path.AddArc(rect.X + rect.Width - radius, rect.Y, radius, radius, 270, 90);
    path.AddArc(rect.X + rect.Width - radius, rect.Y + rect.Height - radius, radius, radius, 0, 90);
    path.AddArc(rect.X, rect.Y + rect.Height - radius, radius, radius, 90, 90);
    path.CloseFigure();
    
    graphics.FillPath(&brush, &path);
}

// –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Å–∫—Ä—É–≥–ª–µ–Ω–Ω–æ–≥–æ –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫–∞ —Å —Ä–∞–º–∫–æ–π
void DrawRoundedRectWithBorder(Graphics& graphics, const Rect& rect, int radius, const Brush& brush, const Pen& pen)
{
    GraphicsPath path;
    
    path.AddArc(rect.X, rect.Y, radius, radius, 180, 90);
    path.AddArc(rect.X + rect.Width - radius, rect.Y, radius, radius, 270, 90);
    path.AddArc(rect.X + rect.Width - radius, rect.Y + rect.Height - radius, radius, radius, 0, 90);
    path.AddArc(rect.X, rect.Y + rect.Height - radius, radius, radius, 90, 90);
    path.CloseFigure();
    
    graphics.FillPath(&brush, &path);
    graphics.DrawPath(&pen, &path);
}

// –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ —Ñ–æ–Ω–∞
void DrawModernBackground(HDC hdc, RECT& clientRect)
{
    Graphics graphics(hdc);
    
    // –û—á–∏—Å—Ç–∫–∞ —Ñ–æ–Ω–∞ —Ç–µ–º–Ω—ã–º —Ü–≤–µ—Ç–æ–º
    SolidBrush backgroundBrush(DARK_BG);
    graphics.FillRectangle(&backgroundBrush, 0, 0, clientRect.right, clientRect.bottom);
    
    // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Ñ–æ–Ω–æ–≤–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å —ç—Ñ—Ñ–µ–∫—Ç–æ–º —Ä–∞–∑–º—ã—Ç–∏—è
    if (g_backgroundImage && g_backgroundImage->GetLastStatus() == Ok)
    {
        // –°–æ–∑–¥–∞–µ–º —Ä–∞–∑–º—ã—Ç–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è —Ñ–æ–Ω–∞
        Rect destRect(0, 0, clientRect.right, clientRect.bottom);
        
        // –†–∏—Å—É–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å –Ω–∏–∑–∫–æ–π –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å—é
        ColorMatrix colorMatrix = {
            1.0f, 0.0f, 0.0f, 0.0f, 0.0f,
            0.0f, 1.0f, 0.0f, 0.0f, 0.0f,
            0.0f, 0.0f, 1.0f, 0.0f, 0.0f,
            0.0f, 0.0f, 0.0f, 0.2f, 0.0f, // –ê–ª—å—Ñ–∞ = 0.2
            0.0f, 0.0f, 0.0f, 0.0f, 1.0f
        };
        
        ImageAttributes imageAttributes;
        imageAttributes.SetColorMatrix(&colorMatrix, ColorMatrixFlagsDefault, ColorAdjustTypeBitmap);
        
        graphics.DrawImage(g_backgroundImage.get(), destRect, 0, 0, 
                          g_backgroundImage->GetWidth(), g_backgroundImage->GetHeight(),
                          UnitPixel, &imageAttributes);
    }
    
    // –ì—Ä–∞–¥–∏–µ–Ω—Ç–Ω—ã–π –æ–≤–µ—Ä–ª–µ–π —Å–≤–µ—Ä—Ö—É
    LinearGradientBrush overlayBrush(
        Point(0, 0),
        Point(0, clientRect.bottom),
        Color(180, 30, 39, 46),
        Color(220, 44, 62, 80)
    );
    graphics.FillRectangle(&overlayBrush, 0, 0, clientRect.right, clientRect.bottom);
    
    // –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å
    DrawSidebar(graphics, clientRect);
    
    // –≠—Ñ—Ñ–µ–∫—Ç —Å–≤–µ—á–µ–Ω–∏—è
    if (g_glowEffect)
    {
        DrawGlowEffect(graphics, clientRect);
    }
    
    // –ê–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã
    DrawAnimatedElements(graphics, clientRect);
    
    // –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–º
    LinearGradientBrush titleBarBrush(
        Point(0, 0),
        Point(0, TITLE_BAR_HEIGHT),
        Color(220, 41, 128, 185),
        Color(220, 52, 152, 219)
    );
    
    // –°–∫—Ä—É–≥–ª–µ–Ω–Ω—ã–π –∑–∞–≥–æ–ª–æ–≤–æ–∫
    DrawRoundedRect(graphics, Rect(0, 0, clientRect.right, TITLE_BAR_HEIGHT), 0, titleBarBrush);
    
    // –õ–æ–≥–æ—Ç–∏–ø –∏ –∑–∞–≥–æ–ª–æ–≤–æ–∫
    FontFamily fontFamily(L"Segoe UI");
    Font titleFont(&fontFamily, 24, FontStyleBold, UnitPixel);
    SolidBrush titleBrush(TEXT_COLOR);
    
    StringFormat stringFormat;
    stringFormat.SetAlignment(StringAlignmentCenter);
    
    // –û—Å–Ω–æ–≤–Ω–æ–π –∑–∞–≥–æ–ª–æ–≤–æ–∫
    graphics.DrawString(
        L"MAJESTIKA RP",
        -1,
        &titleFont,
        RectF(0, 10, (REAL)clientRect.right, 30),
        &stringFormat,
        &titleBrush
    );
    
    // –ü–æ–¥–∑–∞–≥–æ–ª–æ–≤–æ–∫
    Font subtitleFont(&fontFamily, 14, FontStyleItalic, UnitPixel);
    SolidBrush subtitleBrush(Color(200, 236, 240, 241));
    
    graphics.DrawString(
        L"–ü–†–ï–ú–ò–£–ú –†–û–õ–ï–í–û–ô –ü–†–û–ï–ö–¢",
        -1,
        &subtitleFont,
        RectF(0, 35, (REAL)clientRect.right, 20),
        &stringFormat,
        &subtitleBrush
    );
    
    // –î–µ–∫–æ—Ä–∞—Ç–∏–≤–Ω—ã–µ –ª–∏–Ω–∏–∏
    Pen accentPen(ACCENT_COLOR, 2);
    graphics.DrawLine(&accentPen, clientRect.right / 4, TITLE_BAR_HEIGHT - 5, 
                     3 * clientRect.right / 4, TITLE_BAR_HEIGHT - 5);
}

// –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –±–æ–∫–æ–≤–æ–π –ø–∞–Ω–µ–ª–∏
void DrawSidebar(Graphics& graphics, RECT& clientRect)
{
    // –§–æ–Ω –±–æ–∫–æ–≤–æ–π –ø–∞–Ω–µ–ª–∏
    LinearGradientBrush sidebarBrush(
        Point(0, TITLE_BAR_HEIGHT),
        Point(SIDEBAR_WIDTH, TITLE_BAR_HEIGHT),
        Color(230, 30, 39, 46),
        Color(230, 44, 62, 80)
    );
    
    DrawRoundedRect(graphics, Rect(0, TITLE_BAR_HEIGHT, SIDEBAR_WIDTH, 
                                  clientRect.bottom - TITLE_BAR_HEIGHT), 15, sidebarBrush);
    
    // –ó–∞–≥–æ–ª–æ–≤–æ–∫ –±–æ–∫–æ–≤–æ–π –ø–∞–Ω–µ–ª–∏
    FontFamily fontFamily(L"Segoe UI");
    Font panelTitleFont(&fontFamily, 20, FontStyleBold, UnitPixel);
    SolidBrush panelTitleBrush(TEXT_COLOR);
    
    graphics.DrawString(
        L"üìä –°–¢–ê–¢–ò–°–¢–ò–ö–ê",
        -1,
        &panelTitleFont,
        RectF(20, (REAL)TITLE_BAR_HEIGHT + 20, 200, 30),
        NULL,
        &panelTitleBrush
    );
    
    // –≠–ª–µ–º–µ–Ω—Ç—ã —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
    Font statFont(&fontFamily, 16, FontStyleRegular, UnitPixel);
    Font statValueFont(&fontFamily, 18, FontStyleBold, UnitPixel);
    
    // –û–Ω–ª–∞–π–Ω –∏–≥—Ä–æ–∫–æ–≤
    graphics.DrawString(
        L"üë• –ò–≥—Ä–æ–∫–æ–≤ –æ–Ω–ª–∞–π–Ω:",
        -1,
        &statFont,
        RectF(30, (REAL)TITLE_BAR_HEIGHT + 70, 200, 25),
        NULL,
        &panelTitleBrush
    );
    
    SolidBrush valueBrush(SUCCESS_COLOR);
    graphics.DrawString(
        L"1,247",
        -1,
        &statValueFont,
        RectF(30, (REAL)TITLE_BAR_HEIGHT + 95, 100, 25),
        NULL,
        &valueBrush
    );
    
    // –°–µ—Ä–≤–µ—Ä–æ–≤
    graphics.DrawString(
        L"üñ•Ô∏è –ê–∫—Ç–∏–≤–Ω—ã—Ö —Å–µ—Ä–≤–µ—Ä–æ–≤:",
        -1,
        &statFont,
        RectF(30, (REAL)TITLE_BAR_HEIGHT + 140, 200, 25),
        NULL,
        &panelTitleBrush
    );
    
    graphics.DrawString(
        L"12",
        -1,
        &statValueFont,
        RectF(30, (REAL)TITLE_BAR_HEIGHT + 165, 100, 25),
        NULL,
        &valueBrush
    );
    
    // –ü–∏–Ω–≥
    graphics.DrawString(
        L"üì° –°—Ä–µ–¥–Ω–∏–π –ø–∏–Ω–≥:",
        -1,
        &statFont,
        RectF(30, (REAL)TITLE_BAR_HEIGHT + 210, 200, 25),
        NULL,
        &panelTitleBrush
    );
    
    SolidBrush pingBrush(Color(255, 241, 196, 15));
    graphics.DrawString(
        L"42 –º—Å",
        -1,
        &statValueFont,
        RectF(30, (REAL)TITLE_BAR_HEIGHT + 235, 100, 25),
        NULL,
        &pingBrush
    );
    
    // –†–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å–Ω–∞—è –ª–∏–Ω–∏—è
    Pen dividerPen(Color(100, 255, 255, 255), 1);
    graphics.DrawLine(&dividerPen, 20, TITLE_BAR_HEIGHT + 280, SIDEBAR_WIDTH - 20, TITLE_BAR_HEIGHT + 280);
    
    // –ë—ã—Å—Ç—Ä—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
    graphics.DrawString(
        L"‚öôÔ∏è –ë–´–°–¢–†–´–ï –ù–ê–°–¢–†–û–ô–ö–ò",
        -1,
        &panelTitleFont,
        RectF(20, (REAL)TITLE_BAR_HEIGHT + 300, 200, 30),
        NULL,
        &panelTitleBrush
    );
}

// –≠—Ñ—Ñ–µ–∫—Ç —Å–≤–µ—á–µ–Ω–∏—è
void DrawGlowEffect(Graphics& graphics, RECT& clientRect)
{
    // –ü–ª–∞–≤–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –∞–ª—å—Ñ–∞-–∫–∞–Ω–∞–ª–∞
    if (g_glowIncreasing)
    {
        g_glowAlpha += 5;
        if (g_glowAlpha >= 100) g_glowIncreasing = false;
    }
    else
    {
        g_glowAlpha -= 5;
        if (g_glowAlpha <= 30) g_glowIncreasing = true;
    }
    
    // –°–≤–µ—á–µ–Ω–∏–µ –≤–æ–∫—Ä—É–≥ –∫–Ω–æ–ø–∫–∏ –∑–∞–ø—É—Å–∫–∞
    int buttonX = (clientRect.right - LAUNCH_BUTTON_WIDTH) / 2;
    int buttonY = clientRect.bottom - 120;
    
    Color glowColor(g_glowAlpha, 52, 152, 219);
    Pen glowPen(glowColor, 3);
    
    // –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∫–æ–Ω—Ç—É—Ä—ã –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∞ —Å–≤–µ—á–µ–Ω–∏—è
    for (int i = 0; i < 3; i++)
    {
        int offset = i * 3;
        Rect glowRect(buttonX - offset, buttonY - offset, 
                     LAUNCH_BUTTON_WIDTH + offset * 2, LAUNCH_BUTTON_HEIGHT + offset * 2);
        DrawRoundedRectWithBorder(graphics, glowRect, 15, SolidBrush(Color(0, 0, 0, 0)), glowPen);
    }
}

// –ê–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã
void DrawAnimatedElements(Graphics& graphics, RECT& clientRect)
{
    g_animationPhase = (g_animationPhase + 1) % 360;
    float angle = g_animationPhase * 3.14159f / 180.0f;
    
    // –ê–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —á–∞—Å—Ç–∏—Ü—ã
    SolidBrush particleBrush(Color(150, 52, 152, 219));
    for (int i = 0; i < 20; i++)
    {
        float particleAngle = angle + i * 0.314f;
        int x = SIDEBAR_WIDTH + 100 + (int)(cos(particleAngle) * 50);
        int y = 200 + (int)(sin(particleAngle * 2) * 30);
        int size = 3 + (int)(sin(particleAngle * 3) * 2);
        
        graphics.FillEllipse(&particleBrush, x, y, size, size);
    }
    
    // –í–æ–ª–Ω–∞ –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ
    Pen wavePen(Color(100 + (int)(sin(angle) * 50), 231, 76, 60), 2);
    for (int i = 0; i < 5; i++)
    {
        int y = TITLE_BAR_HEIGHT - 10 + (int)(sin(angle + i * 0.5f) * 5);
        graphics.DrawLine(&wavePen, i * 50, y, i * 50 + 40, y);
    }
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
void UpdateProgress(int progress, const std::wstring& status)
{
    if (g_hProgressBar)
    {
        SendMessage(g_hProgressBar, PBM_SETPOS, progress, 0);
        
        // –ê–Ω–∏–º–∞—Ü–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ü–≤–µ—Ç–∞
        if (progress < 30)
            SendMessage(g_hProgressBar, PBM_SETBARCOLOR, 0, RGB(231, 76, 60));
        else if (progress < 70)
            SendMessage(g_hProgressBar, PBM_SETBARCOLOR, 0, RGB(241, 196, 15));
        else
            SendMessage(g_hProgressBar, PBM_SETBARCOLOR, 0, RGB(46, 204, 113));
    }
    
    if (g_hStatusLabel)
    {
        SetWindowText(g_hStatusLabel, status.c_str());
    }
}

// –ó–∞–ø—É—Å–∫ –∏–≥—Ä—ã
void LaunchGame()
{
    UpdateProgress(10, L"üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π...");
    Sleep(800);
    
    UpdateProgress(25, L"üì• –ó–∞–≥—Ä—É–∑–∫–∞ –ø–∞—Ç—á–µ–π...");
    Sleep(1200);
    
    UpdateProgress(45, L"üîß –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫...");
    Sleep(600);
    
    UpdateProgress(65, L"‚ö° –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤...");
    Sleep(900);
    
    UpdateProgress(85, L"üöÄ –ó–∞–ø—É—Å–∫ –∏–≥—Ä–æ–≤–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞...");
    Sleep(500);
    
    UpdateProgress(100, L"‚úÖ –ò–≥—Ä–∞ –∑–∞–ø—É—â–µ–Ω–∞! –ü—Ä–∏—è—Ç–Ω–æ–π –∏–≥—Ä—ã!");
    Sleep(1000);
    
    // –ó–¥–µ—Å—å –±—É–¥–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫ –∏–≥—Ä—ã
    // ShellExecute(NULL, L"open", L"majestika.exe", NULL, NULL, SW_SHOW);
    
    // –ê–Ω–∏–º–∞—Ü–∏—è –∑–∞–∫—Ä—ã—Ç–∏—è
    for (int i = 255; i >= 0; i -= 5)
    {
        SetLayeredWindowAttributes(g_hWnd, 0, i, LWA_ALPHA);
        Sleep(10);
    }
    
    PostMessage(g_hWnd, WM_CLOSE, 0, 0);
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∞–Ω–∏–º–∞—Ü–∏–∏
void UpdateAnimation()
{
    g_animationPhase = (g_animationPhase + 2) % 360;
    InvalidateRect(g_hWnd, NULL, TRUE);
}

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–æ–±—â–µ–Ω–∏–π –æ–∫–Ω–∞
LRESULT CALLBACK WndProc(HWND hWnd, UINT message, WPARAM wParam, LPARAM lParam)
{
    switch (message)
    {
    case WM_CREATE:
        GetWindowRect(hWnd, &g_windowRect);
        break;
        
    case WM_PAINT:
        {
            PAINTSTRUCT ps;
            HDC hdc = BeginPaint(hWnd, &ps);
            
            RECT clientRect;
            GetClientRect(hWnd, &clientRect);
            
            // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ —Ñ–æ–Ω–∞
            DrawModernBackground(hdc, clientRect);
            
            EndPaint(hWnd, &ps);
        }
        break;
        
    case WM_TIMER:
        if (wParam == 1)
        {
            UpdateAnimation();
        }
        break;
        
    case WM_DRAWITEM:
        {
            LPDRAWITEMSTRUCT lpDrawItem = (LPDRAWITEMSTRUCT)lParam;
            HDC hdc = lpDrawItem->hDC;
            RECT rc = lpDrawItem->rcItem;
            
            Graphics graphics(hdc);
            
            switch (lpDrawItem->CtlID)
            {
            case 1001: // –ö–Ω–æ–ø–∫–∞ –∑–∞–∫—Ä—ã—Ç–∏—è
                {
                    // –ì—Ä–∞–¥–∏–µ–Ω—Ç–Ω—ã–π —Ñ–æ–Ω
                    LinearGradientBrush closeBrush(
                        Point(rc.left, rc.top),
                        Point(rc.right, rc.bottom),
                        Color(255, 231, 76, 60),
                        Color(255, 192, 57, 43)
                    );
                    
                    DrawRoundedRect(graphics, Rect(rc.left, rc.top, rc.right - rc.left, rc.bottom - rc.top), 8, closeBrush);
                    
                    // –ë–µ–ª—ã–π –∫—Ä–µ—Å—Ç–∏–∫
                    FontFamily fontFamily(L"Segoe UI");
                    Font font(&fontFamily, 20, FontStyleBold, UnitPixel);
                    SolidBrush textBrush(Color(255, 255, 255));
                    
                    StringFormat stringFormat;
                    stringFormat.SetAlignment(StringAlignmentCenter);
                    stringFormat.SetLineAlignment(StringAlignmentCenter);
                    
                    graphics.DrawString(
                        L"‚úï",
                        -1,
                        &font,
                        RectF((REAL)rc.left, (REAL)rc.top, (REAL)(rc.right - rc.left), (REAL)(rc.bottom - rc.top)),
                        &stringFormat,
                        &textBrush
                    );
                    
                    // –≠—Ñ—Ñ–µ–∫—Ç –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏
                    if (lpDrawItem->itemState & ODS_HOTLIGHT)
                    {
                        SolidBrush hoverBrush(Color(50, 255, 255, 255));
                        graphics.FillRectangle(&hoverBrush, rc.left, rc.top, rc.right - rc.left, rc.bottom - rc.top);
                    }
                }
                break;
                
            case 1002: // –ö–Ω–æ–ø–∫–∞ —Å–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏—è
                {
                    LinearGradientBrush minimizeBrush(
                        Point(rc.left, rc.top),
                        Point(rc.right, rc.bottom),
                        Color(255, 52, 152, 219),
                        Color(255, 41, 128, 185)
                    );
                    
                    DrawRoundedRect(graphics, Rect(rc.left, rc.top, rc.right - rc.left, rc.bottom - rc.top), 8, minimizeBrush);
                    
                    FontFamily fontFamily(L"Segoe UI");
                    Font font(&fontFamily, 20, FontStyleBold, UnitPixel);
                    SolidBrush textBrush(Color(255, 255, 255));
                    
                    StringFormat stringFormat;
                    stringFormat.SetAlignment(StringAlignmentCenter);
                    stringFormat.SetLineAlignment(StringAlignmentCenter);
                    
                    graphics.DrawString(
                        L"‚îÄ",
                        -1,
                        &font,
                        RectF((REAL)rc.left, (REAL)rc.top, (REAL)(rc.right - rc.left), (REAL)(rc.bottom - rc.top)),
                        &stringFormat,
                        &textBrush
                    );
                    
                    if (lpDrawItem->itemState & ODS_HOTLIGHT)
                    {
                        SolidBrush hoverBrush(Color(50, 255, 255, 255));
                        graphics.FillRectangle(&hoverBrush, rc.left, rc.top, rc.right - rc.left, rc.bottom - rc.top);
                    }
                }
                break;
                
            case 1003: // –ö–Ω–æ–ø–∫–∞ –∑–∞–ø—É—Å–∫–∞ –∏–≥—Ä—ã
                {
                    // –ê–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –≥—Ä–∞–¥–∏–µ–Ω—Ç
                    int gradientOffset = (g_animationPhase % 100) * 2;
                    LinearGradientBrush launchBrush(
                    // –ê–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –≥—Ä–∞–¥–∏–µ–Ω—Ç
                    int gradientOffset = (g_animationPhase % 100) * 2;
                    LinearGradientBrush launchBrush(
                        Point(rc.left - gradientOffset, rc.top),
                        Point(rc.right + gradientOffset, rc.bottom),
                        Color(255, 41, 128, 185),
                        Color(255, 52, 152, 219)
                    );
                    
                    // –°–∫—Ä—É–≥–ª–µ–Ω–Ω–∞—è –∫–Ω–æ–ø–∫–∞ —Å —Ç–µ–Ω—å—é
                    DrawRoundedRectWithBorder(graphics, 
                        Rect(rc.left, rc.top, rc.right - rc.left, rc.bottom - rc.top), 
                        15, 
                        launchBrush,
                        Pen(Color(255, 255, 255), 2)
                    );
                    
                    // –¢–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏
                    FontFamily fontFamily(L"Segoe UI");
                    Font font(&fontFamily, 20, FontStyleBold, UnitPixel);
                    SolidBrush textBrush(Color(255, 255, 255));
                    
                    StringFormat stringFormat;
                    stringFormat.SetAlignment(StringAlignmentCenter);
                    stringFormat.SetLineAlignment(StringAlignmentCenter);
                    
                    graphics.DrawString(
                        L"üöÄ –ó–ê–ü–£–°–¢–ò–¢–¨ MAJESTIKA RP",
                        -1,
                        &font,
                        RectF((REAL)rc.left, (REAL)rc.top, (REAL)(rc.right - rc.left), (REAL)(rc.bottom - rc.top)),
                        &stringFormat,
                        &textBrush
                    );
                    
                    // –≠—Ñ—Ñ–µ–∫—Ç –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏
                    if (lpDrawItem->itemState & ODS_HOTLIGHT)
                    {
                        SolidBrush hoverBrush(Color(30, 255, 255, 255));
                        graphics.FillRectangle(&hoverBrush, rc.left, rc.top, rc.right - rc.left, rc.bottom - rc.top);
                    }
                    
                    // –≠—Ñ—Ñ–µ–∫—Ç –Ω–∞–∂–∞—Ç–∏—è
                    if (lpDrawItem->itemState & ODS_SELECTED)
                    {
                        SolidBrush pressedBrush(Color(50, 0, 0, 0));
                        graphics.FillRectangle(&pressedBrush, rc.left, rc.top, rc.right - rc.left, rc.bottom - rc.top);
                    }
                }
                break;
            }
            
            return TRUE;
        }
        break;
        
    case WM_COMMAND:
        {
            int wmId = LOWORD(wParam);
            
            switch (wmId)
            {
            case 1001: // –ó–∞–∫—Ä—ã—Ç—å
                {
                    // –ê–Ω–∏–º–∞—Ü–∏—è –∑–∞–∫—Ä—ã—Ç–∏—è
                    for (int i = 255; i >= 0; i -= 10)
                    {
                        SetLayeredWindowAttributes(hWnd, 0, i, LWA_ALPHA);
                        Sleep(10);
                    }
                    PostMessage(hWnd, WM_CLOSE, 0, 0);
                }
                break;
                
            case 1002: // –°–≤–µ—Ä–Ω—É—Ç—å
                ShowWindow(hWnd, SW_MINIMIZE);
                break;
                
            case 1003: // –ó–∞–ø—É—Å—Ç–∏—Ç—å –∏–≥—Ä—É
                {
                    // –û—Ç–∫–ª—é—á–µ–Ω–∏–µ –∫–Ω–æ–ø–∫–∏ –≤–æ –≤—Ä–µ–º—è –∑–∞–ø—É—Å–∫–∞
                    EnableWindow(g_hLaunchButton, FALSE);
                    
                    // –ó–∞–ø—É—Å–∫ –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –ø–æ—Ç–æ–∫–µ
                    std::thread launchThread(LaunchGame);
                    launchThread.detach();
                }
                break;
                
            case 1006: // –í—ã–±–æ—Ä –Ω–æ–≤–æ—Å—Ç–∏
                {
                    int selectedIndex = SendMessage(g_hNewsList, LB_GETCURSEL, 0, 0);
                    if (selectedIndex != LB_ERR && selectedIndex < (int)g_newsItems.size())
                    {
                        const auto& news = g_newsItems[selectedIndex];
                        std::wstring message = news.title + L"\n\n" + news.content + L"\n\n–î–∞—Ç–∞: " + news.date;
                        MessageBox(hWnd, message.c_str(), L"üì∞ –ù–æ–≤–æ—Å—Ç—å", MB_OK | MB_ICONINFORMATION);
                    }
                }
                break;
            }
        }
        break;
        
    case WM_LBUTTONDOWN:
        {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–∞–∂–∞–ª–∏ –ª–∏ –Ω–∞ –∑–∞–≥–æ–ª–æ–≤–æ–∫ –¥–ª—è –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è
            int xPos = GET_X_LPARAM(lParam);
            int yPos = GET_Y_LPARAM(lParam);
            
            if (yPos < TITLE_BAR_HEIGHT)
            {
                g_isDragging = true;
                g_dragStartPoint.x = xPos;
                g_dragStartPoint.y = yPos;
                SetCapture(hWnd);
            }
        }
        break;
        
    case WM_MOUSEMOVE:
        {
            if (g_isDragging)
            {
                int xPos = GET_X_LPARAM(lParam);
                int yPos = GET_Y_LPARAM(lParam);
                
                RECT windowRect;
                GetWindowRect(hWnd, &windowRect);
                
                int newX = windowRect.left + (xPos - g_dragStartPoint.x);
                int newY = windowRect.top + (yPos - g_dragStartPoint.y);
                
                SetWindowPos(hWnd, NULL, newX, newY, 0, 0, SWP_NOSIZE | SWP_NOZORDER);
            }
        }
        break;
        
    case WM_LBUTTONUP:
        {
            if (g_isDragging)
            {
                g_isDragging = false;
                ReleaseCapture();
            }
        }
        break;
        
    case WM_NCHITTEST:
        {
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞ –æ–∫–Ω–∞ –ø–æ –∫—Ä–∞—è–º
            POINT pt = {GET_X_LPARAM(lParam), GET_Y_LPARAM(lParam)};
            ScreenToClient(hWnd, &pt);
            
            RECT clientRect;
            GetClientRect(hWnd, &clientRect);
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –æ–±–ª–∞—Å—Ç–∏ –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞
            const int borderSize = 8;
            
            if (pt.y < borderSize)
            {
                if (pt.x < borderSize) return HTTOPLEFT;
                if (pt.x > clientRect.right - borderSize) return HTTOPRIGHT;
                return HTTOP;
            }
            else if (pt.y > clientRect.bottom - borderSize)
            {
                if (pt.x < borderSize) return HTBOTTOMLEFT;
                if (pt.x > clientRect.right - borderSize) return HTBOTTOMRIGHT;
                return HTBOTTOM;
            }
            else if (pt.x < borderSize)
            {
                return HTLEFT;
            }
            else if (pt.x > clientRect.right - borderSize)
            {
                return HTRIGHT;
            }
            else if (pt.y < TITLE_BAR_HEIGHT)
            {
                return HTCAPTION;
            }
            
            return HTCLIENT;
        }
        break;
        
    case WM_SIZE:
        {
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–π —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ä–∞–∑–º–µ—Ä–∞
            int newWidth = LOWORD(lParam);
            int newHeight = HIWORD(lParam);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–∑–∏—Ü–∏–∏ –∫–Ω–æ–ø–æ–∫
            if (g_hCloseButton)
            {
                SetWindowPos(g_hCloseButton, NULL, 
                            newWidth - BUTTON_SIZE - BUTTON_MARGIN,
                            BUTTON_MARGIN,
                            BUTTON_SIZE, BUTTON_SIZE, SWP_NOZORDER);
            }
            
            if (g_hMinimizeButton)
            {
                SetWindowPos(g_hMinimizeButton, NULL,
                            newWidth - (BUTTON_SIZE * 2) - (BUTTON_MARGIN * 2),
                            BUTTON_MARGIN,
                            BUTTON_SIZE, BUTTON_SIZE, SWP_NOZORDER);
            }
            
            if (g_hLaunchButton)
            {
                SetWindowPos(g_hLaunchButton, NULL,
                            (newWidth - LAUNCH_BUTTON_WIDTH) / 2,
                            newHeight - 120,
                            LAUNCH_BUTTON_WIDTH, LAUNCH_BUTTON_HEIGHT, SWP_NOZORDER);
            }
            
            if (g_hProgressBar)
            {
                SetWindowPos(g_hProgressBar, NULL,
                            (newWidth - 350) / 2,
                            newHeight - 180,
                            350, 12, SWP_NOZORDER);
            }
            
            if (g_hStatusLabel)
            {
                SetWindowPos(g_hStatusLabel, NULL,
                            (newWidth - 400) / 2,
                            newHeight - 50,
                            400, 25, SWP_NOZORDER);
            }
            
            if (g_hNewsList)
            {
                SetWindowPos(g_hNewsList, NULL,
                            SIDEBAR_WIDTH + CONTENT_PADDING,
                            TITLE_BAR_HEIGHT + 50,
                            newWidth - SIDEBAR_WIDTH - (CONTENT_PADDING * 2),
                            300, SWP_NOZORDER);
            }
            
            if (g_hVersionLabel)
            {
                SetWindowPos(g_hVersionLabel, NULL,
                            CONTENT_PADDING,
                            newHeight - 40,
                            300, 20, SWP_NOZORDER);
            }
            
            InvalidateRect(hWnd, NULL, TRUE);
        }
        break;
        
    case WM_CTLCOLORSTATIC:
        {
            HDC hdcStatic = (HDC)wParam;
            SetTextColor(hdcStatic, RGB(236, 240, 241));
            SetBkMode(hdcStatic, TRANSPARENT);
            return (LRESULT)GetStockObject(NULL_BRUSH);
        }
        break;
        
    case WM_CTLCOLORLISTBOX:
        {
            HDC hdcListBox = (HDC)wParam;
            SetTextColor(hdcListBox, RGB(236, 240, 241));
            SetBkColor(hdcListBox, RGB(44, 62, 80));
            return (LRESULT)CreateSolidBrush(RGB(44, 62, 80));
        }
        break;
        
    case WM_ERASEBKGND:
        return TRUE; // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É—é –æ—á–∏—Å—Ç–∫—É —Ñ–æ–Ω–∞
        
    case WM_DESTROY:
        PostQuitMessage(0);
        break;
        
    default:
        return DefWindowProc(hWnd, message, wParam, lParam);
    }
    
    return 0;
}
