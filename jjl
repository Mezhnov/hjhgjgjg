#include <windows.h>
#include <gdiplus.h>
#include <urlmon.h>
#include <shellapi.h>
#include <dwmapi.h>
#include <wchar.h>
#include <gdiplus.h>
using namespace Gdiplus;
#pragma comment(lib, "gdiplus.lib")
#pragma comment(lib, "urlmon.lib")
#pragma comment(lib, "dwmapi.lib")

using namespace Gdiplus;

// ================= CONFIG =================
const int W = 1200;
const int H = 700;

const wchar_t* BG_URL = L"https://avatars.mds.yandex.net/i?id=36cbb9eb6253b776b00360ca303f84d7_l-12608381-images-thumbs&n=13";
const wchar_t* BG_FILE = L"background.jpg";
const wchar_t* LOGO_URL = L"https://i.imgur.com/placeholder.png"; // ‚Üê –∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π –ª–æ–≥–æ—Ç–∏–ø
const wchar_t* LOGO_FILE = L"logo.png";

const wchar_t* GTA_PATH = L"C:\\Games\\GTA5\\GTA5.exe";

// ================= –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï =================
ULONG_PTR gdiToken;
Image* background = nullptr;
Image* logo = nullptr;
bool isFullscreen = false;
RECT normalRect;
float progress = 0.0f;
bool showNews = false;
bool showSettings = false;
int currentNewsIndex = 0;

// ================= –ù–û–í–û–°–¢–ò =================
struct NewsItem {
    const wchar_t* title;
    const wchar_t* description;
    const wchar_t* imageUrl;
    const wchar_t* imageFile;
};

NewsItem newsItems[] = {
    { L"–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ 1.5: –ù–æ–≤—ã–µ –º–∞—à–∏–Ω—ã!", L"–î–æ–±–∞–≤–ª–µ–Ω—ã –Ω–æ–≤—ã–µ –∞–≤—Ç–æ–º–æ–±–∏–ª–∏ –∏ –º–∏—Å—Å–∏–∏. –ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ –Ω–∞ —Ñ–æ—Ä—É–º–µ.", L"https://example.com/news1.jpg", L"news1.jpg" },
    { L"–ö–æ–Ω–∫—É—Ä—Å –Ω–∞ –ª—É—á—à–∏–π –±–∏–ª–¥", L"–£—á–∞—Å—Ç–≤—É–π—Ç–µ –∏ –≤—ã–∏–≥—Ä—ã–≤–∞–π—Ç–µ –ø—Ä–∏–∑—ã! –°—Ä–æ–∫ –¥–æ 20.01.2026.", L"https://example.com/news2.jpg", L"news2.jpg" },
    { L"–ë–∞–Ω –≤–æ–ª–Ω–∞ —á–∏—Ç–µ—Ä–æ–≤", L"–û—á–∏—â–∞–µ–º —Å–µ—Ä–≤–µ—Ä –æ—Ç –Ω–∞—Ä—É—à–∏—Ç–µ–ª–µ–π. –°–ø–∞—Å–∏–±–æ –∑–∞ —Ä–µ–ø–æ—Ä—Ç—ã!", L"https://example.com/news3.jpg", L"news3.jpg" },
};
const int numNews = sizeof(newsItems) / sizeof(NewsItem);
Image* newsImages[3] = { nullptr };

// ================= –ù–ê–°–¢–†–û–ô–ö–ò =================
bool settingFullscreen = false;
bool settingAutoUpdate = true;
bool settingSoundEffects = true;
int  settingVolume = 75;   // 0‚Äì100

// ================= UI –°–¢–†–£–ö–¢–£–†–´ =================
struct Button {
    RECT rect;
    const wchar_t* text;
    bool hover;
    Color normalColor;
    Color hoverColor;
    int fontSize;
    const wchar_t* tooltip;
};

struct Panel {
    RECT rect;
    Color bgColor;
    int borderRadius;
};

// ================= –ö–ù–û–ü–ö–ò (–ü–ï–†–ï–ú–ï–©–ï–ù–´ –í–ü–†–ê–í–û) =================
// –û—Å–Ω–æ–≤–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ —Å–ø—Ä–∞–≤–∞
Button btnPlay = { {800,500,1150,580}, L"–ó–ê–ü–£–°–¢–ò–¢–¨ –ò–ì–†–£", false, Color(80, 255,140,0),  Color(255,255,165,0),  24, L"–ó–∞–ø—É—Å—Ç–∏—Ç—å GTA V" };
Button btnNews = { {800, 180,1150,250}, L"–ù–û–í–û–°–¢–ò",        false, Color(120,30,30,35),   Color(180,40,40,45),   18, L"–ü–æ—Å–ª–µ–¥–Ω–∏–µ –Ω–æ–≤–æ—Å—Ç–∏" };
Button btnSettings = { {800, 270,1150,340}, L"–ù–ê–°–¢–†–û–ô–ö–ò",      false, Color(120,30,30,35),   Color(180,40,40,45),   18, L"–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ª–∞—É–Ω—á–µ—Ä–∞" };
Button btnDiscord = { {800, 360,1150,430}, L"DISCORD",        false, Color(120,88,101,242), Color(200,88,101,242), 18, L"Discord —Å–æ–æ–±—â–µ—Å—Ç–≤–æ" };
Button btnForum = { {800, 450,1150,520}, L"–§–û–†–£–ú",          false, Color(120,30,30,35),   Color(180,40,40,45),   18, L"–§–æ—Ä—É–º Majestic" };
Button btnDonate = { {50,180,350,250},L"–î–û–ù–ê–¢",          false, Color(120,255,215,0),  Color(200,255,215,0),  18, L"–ü–æ–¥–¥–µ—Ä–∂–∞—Ç—å –ø—Ä–æ–µ–∫—Ç" };
Button btnStats = { {50,270,350,340},L"–°–¢–ê–¢–ò–°–¢–ò–ö–ê",     false, Color(120,30,30,35),   Color(180,40,40,45),   18, L"–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞" };
Button btnRules = { {50,360,350,430},L"–ü–†–ê–í–ò–õ–ê",        false, Color(120,200,0,0),    Color(180,220,20,20),  18, L"–ü—Ä–∞–≤–∏–ª–∞ —Å–µ—Ä–≤–µ—Ä–∞" };
Button btnEvents = { {50,  540,350,610},L"–°–û–ë–´–¢–ò–Ø",        false, Color(120,0,200,200),  Color(180,20,220,220), 18, L"–°–æ–±—ã—Ç–∏—è" };

// –°–∏—Å—Ç–µ–º–Ω—ã–µ –∫–Ω–æ–ø–∫–∏
Button btnMinimize = { {W - 140,10,W - 100,40}, L"‚Äî", false, Color(0,0,0,0), Color(100,255,255,255), 20, L"–°–≤–µ—Ä–Ω—É—Ç—å" };
Button btnMaximize = { {W - 90, 10,W - 50, 40}, L"‚ñ°", false, Color(0,0,0,0), Color(100,255,255,255), 20, L"–†–∞–∑–≤–µ—Ä–Ω—É—Ç—å" };
Button btnClose = { {W - 40, 10,W - 10, 40}, L"‚úï", false, Color(0,0,0,0), Color(200,255,0,0),     20, L"–ó–∞–∫—Ä—ã—Ç—å" };

// –ö–Ω–æ–ø–∫–∏ –Ω–æ–≤–æ—Å—Ç–µ–π
Button btnNewsBack = { {50,  50,150,100}, L"–ù–ê–ó–ê–î", false, Color(120,30,30,35), Color(180,40,40,45), 18, L"–í–µ—Ä–Ω—É—Ç—å—Å—è" };
Button btnNewsPrev = { {400,600,500,650}, L"<",    false, Color(120,30,30,35), Color(180,40,40,45), 24, L"–ü—Ä–µ–¥—ã–¥—É—â–∞—è" };
Button btnNewsNext = { {700,600,800,650}, L">",    false, Color(120,30,30,35), Color(180,40,40,45), 24, L"–°–ª–µ–¥—É—é—â–∞—è" };

// –ö–Ω–æ–ø–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫
Button btnSettingsBack = { {50,  50,150,100}, L"–ù–ê–ó–ê–î", false, Color(120,30,30,35), Color(180,40,40,45), 18, L"–í–µ—Ä–Ω—É—Ç—å—Å—è" };

// –ß–µ–∫–±–æ–∫—Å—ã –Ω–∞—Å—Ç—Ä–æ–µ–∫
Button btnCheckFullscreen = { {250,180,700,220}, L"–ó–∞–ø—É—Å–∫–∞—Ç—å –∏–≥—Ä—É –≤ –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω–æ–º —Ä–µ–∂–∏–º–µ", false, Color(0,0,0,0), Color(80,80,80,120), 16, L"" };
Button btnCheckAutoUpdate = { {250,240,700,280}, L"–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è",     false, Color(0,0,0,0), Color(80,80,80,120), 16, L"" };
Button btnCheckSound = { {250,300,700,340}, L"–í–∫–ª—é—á–∏—Ç—å –∑–≤—É–∫–æ–≤—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã –ª–∞—É–Ω—á–µ—Ä–∞",     false, Color(0,0,0,0), Color(80,80,80,120), 16, L"" };

// ================= –ü–ê–ù–ï–õ–ò (–û–ë–ù–û–í–õ–ï–ù–ù–´–ï) =================
Panel mainPanel = { {30,  150,370,640}, Color(140,15,15,20), 15 };
Panel rightPanel = { {780, 150,1170,640},Color(140,15,15,20), 15 };
Panel playPanel = { {780, 480,1170,600}, Color(0,0,0,0),      20 };
Panel newsPanel = { {200, 100,1000,550},Color(140,15,15,20), 20 };
Panel settingsPanel = { {200, 100,1000,550},Color(140,15,15,20), 20 };

// ================= –£–¢–ò–õ–ò–¢–´ =================
bool InRect(const POINT& p, const RECT& r) {
    return p.x >= r.left && p.x <= r.right && p.y >= r.top && p.y <= r.bottom;
}

void DrawRoundedRect(Graphics& g, Brush* brush, const RectF& rect, float radius) {
    GraphicsPath path;
    path.AddArc(rect.X, rect.Y, radius * 2, radius * 2, 180, 90);
    path.AddArc(rect.X + rect.Width - radius * 2, rect.Y, radius * 2, radius * 2, 270, 90);
    path.AddArc(rect.X + rect.Width - radius * 2, rect.Y + rect.Height - radius * 2, radius * 2, radius * 2, 0, 90);
    path.AddArc(rect.X, rect.Y + rect.Height - radius * 2, radius * 2, radius * 2, 90, 90);
    path.CloseFigure();
    g.FillPath(brush, &path);
}

void DrawPanel(Graphics& g, const Panel& p) {
    SolidBrush brush(p.bgColor);
    RectF rect((REAL)p.rect.left, (REAL)p.rect.top, (REAL)(p.rect.right - p.rect.left), (REAL)(p.rect.bottom - p.rect.top));
    if (p.borderRadius > 0) DrawRoundedRect(g, &brush, rect, (float)p.borderRadius);
    else g.FillRectangle(&brush, rect);

    // –£–ª—É—á—à–µ–Ω–Ω–∞—è —Ç–µ–Ω—å
    Pen shadowPen(Color(80, 0, 0, 0), 3.0f);
    GraphicsPath shadowPath; shadowPath.AddRectangle(rect);
    g.TranslateTransform(3.0f, 3.0f);
    g.DrawPath(&shadowPen, &shadowPath);
    g.ResetTransform();

    // –í–Ω—É—Ç—Ä–µ–Ω–Ω–µ–µ —Å–≤–µ—á–µ–Ω–∏–µ
    Pen glowPen(Color(40, 255, 255, 255), 1.0f);
    g.DrawRectangle(&glowPen, rect);
}

void DrawButton(Graphics& g, const Button& b) {
    Color bg = b.hover ? b.hoverColor : b.normalColor;
    SolidBrush brush(bg);
    RectF r((REAL)b.rect.left, (REAL)b.rect.top, (REAL)(b.rect.right - b.rect.left), (REAL)(b.rect.bottom - b.rect.top));
    
    // –ì—Ä–∞–¥–∏–µ–Ω—Ç –¥–ª—è –∫–Ω–æ–ø–∫–∏
    LinearGradientBrush gradBrush(r, 
        Color(bg.GetA(), bg.GetR()/2, bg.GetG()/2, bg.GetB()/2), 
        bg, 
        LinearGradientModeVertical);
    
    DrawRoundedRect(g, &gradBrush, r, 12.0f);

    // –£–ª—É—á—à–µ–Ω–Ω–∞—è –æ–±–≤–æ–¥–∫–∞ –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏
    if (b.hover) {
        Pen pen(Color(220, 255, 255, 255), 2.5f);
        pen.SetDashStyle(DashStyleDash);
        GraphicsPath path; path.AddRectangle(r);
        g.DrawPath(&pen, &path);
    }

    FontFamily ff(L"Segoe UI");
    Font font(&ff, (REAL)b.fontSize, FontStyleBold);
    
    // –¢–µ–Ω—å —Ç–µ–∫—Å—Ç–∞
    SolidBrush shadow(Color(100, 0, 0, 0));
    RectF shadowRect(r.X + 1, r.Y + 1, r.Width, r.Height);
    StringFormat fmt;
    fmt.SetAlignment(StringAlignmentCenter);
    fmt.SetLineAlignment(StringAlignmentCenter);
    g.DrawString(b.text, -1, &font, shadowRect, &fmt, &shadow);
    
    // –û—Å–Ω–æ–≤–Ω–æ–π —Ç–µ–∫—Å—Ç
    SolidBrush text(Color::White);
    g.DrawString(b.text, -1, &font, r, &fmt, &text);
}

void DrawCheckbox(Graphics& g, const Button& b, bool checked) {
    RectF r((REAL)b.rect.left, (REAL)b.rect.top, (REAL)(b.rect.right - b.rect.left), (REAL)(b.rect.bottom - b.rect.top));

    // –ì—Ä–∞–¥–∏–µ–Ω—Ç–Ω—ã–π —Ñ–æ–Ω
    LinearGradientBrush bg(r, 
        b.hover ? Color(80, 60, 60, 60) : Color(60, 40, 40, 40),
        b.hover ? Color(100, 80, 80, 80) : Color(80, 60, 60, 60),
        LinearGradientModeVertical);
    g.FillRectangle(&bg, r);

    RectF box(r.X + 10, r.Y + (r.Height - 24) / 2, 24, 24);
    
    // –°—Ç–∏–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π —á–µ–∫–±–æ–∫—Å
    Pen pen(Color::White, 2);
    g.DrawRectangle(&pen, box);

    if (checked) {
        // –ì—Ä–∞–¥–∏–µ–Ω—Ç–Ω–∞—è –∑–∞–ª–∏–≤–∫–∞
        LinearGradientBrush fill(box, 
            Color(255, 0, 180, 80), 
            Color(255, 0, 140, 60), 
            LinearGradientModeVertical);
        g.FillRectangle(&fill, box.X + 4, box.Y + 4, box.Width - 8, box.Height - 8);
        
        // –ì–∞–ª–æ—á–∫–∞
        Pen checkPen(Color::White, 3);
        g.DrawLine(&checkPen, box.X + 7, box.Y + 12, box.X + 11, box.Y + 16);
        g.DrawLine(&checkPen, box.X + 11, box.Y + 16, box.X + 17, box.Y + 8);
    }

    FontFamily ff(L"Segoe UI");
    Font font(&ff, 16, FontStyleRegular);
    SolidBrush text(Color::White);
    RectF textRect(r.X + 45, r.Y, r.Width - 50, r.Height);
    StringFormat fmt; fmt.SetLineAlignment(StringAlignmentCenter);
    g.DrawString(b.text, -1, &font, textRect, &fmt, &text);
}

void DrawTooltip(Graphics& g, const wchar_t* text, const POINT& pos) {
    if (!text) return;

    FontFamily ff(L"Segoe UI");
    Font font(&ff, 12, FontStyleRegular);
    SolidBrush bg(Color(220, 20, 20, 25));
    SolidBrush textBrush(Color::White);

    RectF rect((REAL)pos.x + 10, (REAL)pos.y + 10, 200, 40);
    DrawRoundedRect(g, &bg, rect, 8.0f);

    // –û–±–≤–æ–¥–∫–∞ —Ç—É–ª—Ç–∏–ø–∞
    Pen borderPen(Color(100, 255, 255, 255), 1);
    g.DrawRectangle(&borderPen, rect);

    StringFormat fmt;
    fmt.SetLineAlignment(StringAlignmentCenter);
    g.DrawString(text, -1, &font, rect, &fmt, &textBrush);
}

void DrawVolumeSlider(Graphics& g, int volume) {
    RectF track(250, 380, 500, 10);
    
    // –§–æ–Ω —Å–ª–∞–π–¥–µ—Ä–∞
    LinearGradientBrush trackBg(track, 
        Color(80, 60, 60, 60), 
        Color(80, 80, 80, 80), 
        LinearGradientModeHorizontal);
    DrawRoundedRect(g, &trackBg, track, 5.0f);

    // –ó–∞–ø–æ–ª–Ω–µ–Ω–Ω–∞—è —á–∞—Å—Ç—å
    float pos = (float)volume / 100.0f;
    RectF fill(250, 380, 500 * pos, 10);
    LinearGradientBrush grad(PointF(250, 380), PointF(750, 380), 
        Color(255, 60, 200, 255), Color(255, 0, 120, 255));
    DrawRoundedRect(g, &grad, fill, 5.0f);

    // –ü–æ–ª–∑—É–Ω–æ–∫
    REAL x = 250 + 500 * pos - 12;
    LinearGradientBrush circleBrush(PointF(x, 375), PointF(x + 24, 395),
        Color(255, 255, 255, 255), Color(255, 200, 200, 200));
    Pen border(Color(150, 100, 100, 100), 2);
    g.FillEllipse(&circleBrush, x, 375, 24, 24);
    g.DrawEllipse(&border, x, 375, 24, 24);

    wchar_t txt[32];
    swprintf(txt, 32, L"–ì—Ä–æ–º–∫–æ—Å—Ç—å: %d%%", volume);
    FontFamily ff(L"Segoe UI");
    Font font(&ff, 14, FontStyleBold);
    SolidBrush text(Color::White);
    g.DrawString(txt, -1, &font, PointF(250, 410), &text);
}

void DrawGradientOverlay(Graphics& g) {
    // –ë–æ–ª–µ–µ —Å–ª–æ–∂–Ω—ã–π –≥—Ä–∞–¥–∏–µ–Ω—Ç
    LinearGradientBrush gradient(Point(0, 0), Point(0, H), 
        Color(240, 0, 0, 0), Color(80, 0, 0, 0));
    g.FillRectangle(&gradient, 0, 0, W, H);

    // –ë–æ–∫–æ–≤—ã–µ –≥—Ä–∞–¥–∏–µ–Ω—Ç—ã
    LinearGradientBrush leftGrad(Point(0, 0), Point(400, 0), 
        Color(150, 0, 0, 0), Color(0, 0, 0, 0));
    g.FillRectangle(&leftGrad, 0, 0, 400, H);

    LinearGradientBrush rightGrad(Point(W-400, 0), Point(W, 0), 
        Color(0, 0, 0, 0), Color(150, 0, 0, 0));
    g.FillRectangle(&rightGrad, W-400, 0, 400, H);
}

void DrawHeader(Graphics& g) {
    // –£–ª—É—á—à–µ–Ω–Ω—ã–π –≥—Ä–∞–¥–∏–µ–Ω—Ç –∑–∞–≥–æ–ª–æ–≤–∫–∞
    LinearGradientBrush headerGrad(Point(0, 0), Point(0, 80), 
        Color(220, 15, 15, 20), Color(120, 10, 10, 15));
    g.FillRectangle(&headerGrad, 0, 0, W, 80);

    // –õ–æ–≥–æ—Ç–∏–ø —Å —ç—Ñ—Ñ–µ–∫—Ç–æ–º —Å–≤–µ—á–µ–Ω–∏—è
    if (logo) {
        ColorMatrix glowMatrix = {
            1.0f, 0.0f, 0.0f, 0.0f, 0.0f,
            0.0f, 1.0f, 0.0f, 0.0f, 0.0f,
            0.0f, 0.0f, 1.0f, 0.0f, 0.0f,
            0.0f, 0.0f, 0.0f, 1.0f, 0.0f,
            0.1f, 0.1f, 0.0f, 0.0f, 1.0f
        };
        ImageAttributes attr;
        attr.SetColorMatrix(&glowMatrix);
        g.DrawImage(logo, Rect(15, 15, 60, 60), 0, 0, logo->GetWidth(), logo->GetHeight(), UnitPixel, &attr);
    }

    FontFamily ff(L"Segoe UI");
    Font titleFont(&ff, 36.0f, FontStyleBold);
    
    // –¢–µ–Ω—å –∑–∞–≥–æ–ª–æ–≤–∫–∞
    SolidBrush shadow(Color(100, 0, 0, 0));
    g.DrawString(L"MAJESTIC", -1, &titleFont, PointF(87, 17), &shadow);
    g.DrawString(L"ROLEPLAY", -1, &titleFont, PointF(287, 17), &shadow);
    
    // –û—Å–Ω–æ–≤–Ω–æ–π —Ç–µ–∫—Å—Ç —Å –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–º
    LinearGradientBrush orangeGrad(PointF(80, 10), PointF(80, 50), 
        Color(255, 255, 180, 0), Color(255, 255, 140, 0));
    g.DrawString(L"MAJESTIC", -1, &titleFont, PointF(85, 15), &orangeGrad);
    
    SolidBrush white(Color::White);
    g.DrawString(L"ROLEPLAY", -1, &titleFont, PointF(285, 15), &white);
    
    // –ü–æ–¥–∑–∞–≥–æ–ª–æ–≤–æ–∫
    Font subFont(&ff, 14.0f, FontStyleItalic);
    SolidBrush gray(Color(180, 200, 200, 200));
    g.DrawString(L"–ü—Ä–µ–º–∏—É–º GTA V RolePlay —Å–µ—Ä–≤–µ—Ä", -1, &subFont, PointF(85, 55), &gray);
}

void DrawServerInfo(Graphics& g) {
    FontFamily ff(L"Segoe UI");
    Font infoFont(&ff, 16.0f, FontStyleBold);
    Font smallFont(&ff, 12.0f, FontStyleRegular);
    SolidBrush white(Color::White), green(Color(0, 255, 100)), gray(Color(200, 200, 200, 200));

    // –ü–∞–Ω–µ–ª—å —Å—Ç–∞—Ç—É—Å–∞
    SolidBrush statusBg(Color(80, 20, 20, 25));
    RectF statusRect((REAL)W - 300, 20, 280, 40);
    DrawRoundedRect(g, &statusBg, statusRect, 8.0f);

    // –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –æ–Ω–ª–∞–π–Ω
    g.DrawString(L"‚óè ONLINE", -1, &infoFont, PointF((REAL)W - 290, 25), &green);
    g.DrawString(L"–û–Ω–ª–∞–π–Ω: 2847/3000", -1, &smallFont, PointF((REAL)W - 380, 28), &gray);
    
    // –ü–∏–Ω–≥
    g.DrawString(L"–ü–∏–Ω–≥: 24ms", -1, &smallFont, PointF((REAL)W - 180, 28), &gray);
}

void DrawInfoBoxes(Graphics& g) {
    FontFamily ff(L"Segoe UI");
    Font titleFont(&ff, 18.0f, FontStyleBold);
    Font textFont(&ff, 13.0f, FontStyleRegular);
    SolidBrush white(Color::White), gray(Color(220, 200, 200, 200));

    // –õ–µ–≤–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–∞—è –ø–∞–Ω–µ–ª—å
    SolidBrush boxBg(Color(70, 30, 30, 35));
    RectF box1(50, 390, 320, 80);
    RectF box2(50, 480, 320, 80);
    DrawRoundedRect(g, &boxBg, box1, 10);
    DrawRoundedRect(g, &boxBg, box2, 10);

    // –ò–∫–æ–Ω–∫–∏ (—Å–∏–º–≤–æ–ª–∏—á–µ—Å–∫–∏–µ)
    Font iconFont(&ff, 24.0f, FontStyleRegular);
    SolidBrush iconBrush(Color(180, 255, 140, 0));
    g.DrawString(L"‚öô", -1, &iconFont, PointF(70, 400), &iconBrush);
    g.DrawString(L"üìÖ", -1, &iconFont, PointF(70, 490), &iconBrush);

    g.DrawString(L"–í–µ—Ä—Å–∏—è –∏–≥—Ä—ã", -1, &textFont, PointF(110, 400), &gray);
    g.DrawString(L"3095.2", -1, &titleFont, PointF(110, 420), &white);
    g.DrawString(L"–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ", -1, &textFont, PointF(110, 490), &gray);
    g.DrawString(L"15.01.2025", -1, &titleFont, PointF(110, 510), &white);
}

void DrawProgressBar(Graphics& g, float progress) {
    RectF bgRect(800, 630, 350, 15);
    RectF progressRect(800, 630, 350 * progress, 15);

    // –§–æ–Ω –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–∞
    LinearGradientBrush bgBrush(bgRect, 
        Color(100, 50, 50, 50), 
        Color(100, 70, 70, 70), 
        LinearGradientModeHorizontal);
    DrawRoundedRect(g, &bgBrush, bgRect, 8);

    // –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Å –∞–Ω–∏–º–∞—Ü–∏–æ–Ω–Ω—ã–º —ç—Ñ—Ñ–µ–∫—Ç–æ–º
    LinearGradientBrush progressBrush(progressRect, 
        Color(255, 255, 180, 0), 
        Color(255, 255, 100, 0), 
        LinearGradientModeHorizontal);
    DrawRoundedRect(g, &progressBrush, progressRect, 8);

    // –ü–æ–ª–æ—Å–∫–∏ –∞–Ω–∏–º–∞—Ü–∏–∏
    if (progress > 0) {
        Pen shinePen(Color(150, 255, 255, 255), 2);
        for (int i = 0; i < 5; i++) {
            float x = 800 + progress * 350 * (i / 5.0f);
            g.DrawLine(&shinePen, x, 632, x, 642);
        }
    }

    wchar_t txt[16];
    swprintf(txt, 16, L"%.0f%%", progress * 100);
    FontFamily ff(L"Segoe UI");
    Font font(&ff, 12.0f, FontStyleBold);
    SolidBrush textBrush(Color::White);
    
    // –¢–µ–Ω—å —Ç–µ–∫—Å—Ç–∞
    SolidBrush shadowBrush(Color(100, 0, 0, 0));
    g.DrawString(txt, -1, &font, PointF(975, 628), &shadowBrush);
    g.DrawString(txt, -1, &font, PointF(974, 627), &textBrush);
}

void DrawNews(Graphics& g) {
    DrawPanel(g, newsPanel);

    FontFamily ff(L"Segoe UI");
    Font titleFont(&ff, 28.0f, FontStyleBold);
    Font descFont(&ff, 16.0f, FontStyleRegular);
    Font dateFont(&ff, 12.0f, FontStyleItalic);
    SolidBrush white(Color::White);
    SolidBrush orange(Color(255, 255, 180, 0));
    SolidBrush gray(Color(180, 200, 200, 200));

    // –ó–∞–≥–æ–ª–æ–≤–æ–∫ –Ω–æ–≤–æ—Å—Ç–∏
    RectF titleRect(220, 120, 760, 60);
    g.DrawString(newsItems[currentNewsIndex].title, -1, &titleFont, titleRect, nullptr, &orange);

    // –î–∞—Ç–∞ (—Å–∏–º–≤–æ–ª–∏—á–µ—Å–∫–∞—è)
    g.DrawString(L"15 —è–Ω–≤–∞—Ä—è 2025", -1, &dateFont, PointF(220, 185), &gray);

    // –û–ø–∏—Å–∞–Ω–∏–µ
    RectF descRect(220, 210, 760, 150);
    g.DrawString(newsItems[currentNewsIndex].description, -1, &descFont, descRect, nullptr, &white);

    // –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–æ–≤–æ—Å—Ç–∏
    if (newsImages[currentNewsIndex]) {
        RectF imageRect(220, 380, 760, 140);
        
        // –†–∞–º–∫–∞ –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
        Pen imageBorder(Color(100, 255, 255, 255), 2);
        g.DrawRectangle(&imageBorder, imageRect);
        
        g.DrawImage(newsImages[currentNewsIndex], imageRect);
    }

    // –ù–∞–≤–∏–≥–∞—Ü–∏—è
    DrawButton(g, btnNewsPrev);
    DrawButton(g, btnNewsNext);

    // –°—á–µ—Ç—á–∏–∫
    wchar_t idx[32];
    swprintf(idx, 32, L"–ù–æ–≤–æ—Å—Ç—å %d –∏–∑ %d", currentNewsIndex + 1, numNews);
    g.DrawString(idx, -1, &descFont, PointF(580, 620), &white);

    DrawButton(g, btnNewsBack);
}

void DrawSettings(Graphics& g) {
    DrawPanel(g, settingsPanel);

    FontFamily ff(L"Segoe UI");
    Font titleFont(&ff, 32, FontStyleBold);
    SolidBrush white(Color::White);
    SolidBrush orange(Color(255, 255, 180, 0));
    
    // –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å –∏–∫–æ–Ω–∫–æ–π
    g.DrawString(L"‚öô ", -1, &titleFont, PointF(220, 120), &orange);
    g.DrawString(L"–ù–ê–°–¢–†–û–ô–ö–ò –õ–ê–£–ù–ß–ï–†–ê", -1, &titleFont, PointF(260, 120), &white);

    // –†–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å
    Pen dividerPen(Color(80, 255, 255, 255), 1);
    g.DrawLine(&dividerPen, 220, 170, 980, 170);

    DrawCheckbox(g, btnCheckFullscreen, settingFullscreen);
    DrawCheckbox(g, btnCheckAutoUpdate, settingAutoUpdate);
    DrawCheckbox(g, btnCheckSound, settingSoundEffects);

    DrawVolumeSlider(g, settingVolume);

    // –ö–Ω–æ–ø–∫–∞ —Å–±—Ä–æ—Å–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫
    Button btnReset = { {250, 450, 450, 500}, L"–°–±—Ä–æ—Å–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏", false, 
        Color(120, 200, 50, 50), Color(180, 220, 70, 70), 16, L"–í–µ—Ä–Ω—É—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é" };
    DrawButton(g, btnReset);

    DrawButton(g, btnSettingsBack);
}

// ================= WINDOW PROC =================
LRESULT CALLBACK WndProc(HWND hwnd, UINT msg, WPARAM wParam, LPARAM lParam)
{
    static POINT mousePos;
    static const Button* hoveredButton = nullptr;

    switch (msg)
    {
    case WM_CREATE:
    {
        DWM_WINDOW_CORNER_PREFERENCE pref = DWMWCP_ROUND;
        DwmSetWindowAttribute(hwnd, DWMWA_WINDOW_CORNER_PREFERENCE, &pref, sizeof(pref));

        URLDownloadToFileW(nullptr, BG_URL, BG_FILE, 0, nullptr);
        URLDownloadToFileW(nullptr, LOGO_URL, LOGO_FILE, 0, nullptr);
        background = Image::FromFile(BG_FILE);
        logo = Image::FromFile(LOGO_FILE);

        for (int i = 0; i < numNews; ++i) {
            URLDownloadToFileW(nullptr, newsItems[i].imageUrl, newsItems[i].imageFile, 0, nullptr);
            newsImages[i] = Image::FromFile(newsItems[i].imageFile);
        }

        SetTimer(hwnd, 1, 50, nullptr);
        break;
    }

    case WM_TIMER:
        if (wParam == 1) {
            progress += 0.01f;
            if (progress > 1.0f) progress = 1.0f;
            InvalidateRect(hwnd, nullptr, FALSE);
        }
        break;

    case WM_PAINT:
    {
        PAINTSTRUCT ps;
        HDC hdc = BeginPaint(hwnd, &ps);

        HDC memDC = CreateCompatibleDC(hdc);
        HBITMAP memBmp = CreateCompatibleBitmap(hdc, W, H);
        SelectObject(memDC, memBmp);

        Graphics g(memDC);
        g.SetSmoothingMode(SmoothingModeAntiAlias);
        g.SetTextRenderingHint(TextRenderingHintAntiAlias);
        g.SetInterpolationMode(InterpolationModeHighQualityBicubic);

        if (background) g.DrawImage(background, 0, 0, W, H);
        DrawGradientOverlay(g);
        DrawHeader(g);
        DrawServerInfo(g);

        if (!showNews && !showSettings) {
            DrawPanel(g, mainPanel);
            DrawPanel(g, rightPanel);
            DrawButton(g, btnNews);
            DrawButton(g, btnSettings);
            DrawButton(g, btnDiscord);
            DrawButton(g, btnForum);
            DrawButton(g, btnDonate);
            DrawButton(g, btnStats);
            DrawButton(g, btnRules);
            DrawButton(g, btnEvents);
            DrawInfoBoxes(g);
            DrawButton(g, btnPlay);
            DrawProgressBar(g, progress);
        }
        else if (showNews) {
            DrawNews(g);
        }
        else if (showSettings) {
            DrawSettings(g);
        }

        DrawButton(g, btnMinimize);
        DrawButton(g, btnMaximize);
        DrawButton(g, btnClose);

        if (hoveredButton) DrawTooltip(g, hoveredButton->tooltip, mousePos);

        BitBlt(hdc, 0, 0, W, H, memDC, 0, 0, SRCCOPY);
        DeleteObject(memBmp);
        DeleteDC(memDC);
        EndPaint(hwnd, &ps);
        break;
    }

    case WM_MOUSEMOVE:
    {
        POINT p;
        GetCursorPos(&p);
        ScreenToClient(hwnd, &p);
        mousePos = p;

        static Button* mainButtons[] = {
            &btnPlay, &btnNews, &btnSettings, &btnDiscord,
            &btnForum, &btnDonate, &btnStats, &btnRules,
            &btnEvents, &btnMinimize, &btnMaximize, &btnClose
        };

        static Button* newsButtons[] = {
            &btnNewsBack, &btnNewsPrev, &btnNewsNext,
            &btnMinimize, &btnMaximize, &btnClose
        };

        static Button* settingsButtons[] = {
            &btnSettingsBack, &btnCheckFullscreen,
            btnCheckAutoUpdate, &btnCheckSound,
            &btnMinimize, &btnMaximize, &btnClose
        };

        Button** buttons = mainButtons;
        int count = sizeof(mainButtons) / sizeof(Button*);

        if (showNews) {
            buttons = newsButtons;
            count = sizeof(newsButtons) / sizeof(Button*);
        }
        else if (showSettings) {
            buttons = settingsButtons;
            count = sizeof(settingsButtons) / sizeof(Button*);
        }

        hoveredButton = nullptr;
        for (int i = 0; i < count; ++i) {
            buttons[i]->hover = InRect(p, buttons[i]->rect);
            if (buttons[i]->hover) hoveredButton = buttons[i];
        }

        InvalidateRect(hwnd, nullptr, FALSE);
        break;
    }

    case WM_LBUTTONDOWN:
    {
        POINT p;
        GetCursorPos(&p);
        ScreenToClient(hwnd, &p);

        if (InRect(p, btnClose.rect)) {
            PostQuitMessage(0);
        }
        else if (InRect(p, btnMinimize.rect)) {
            ShowWindow(hwnd, SW_MINIMIZE);
        }
        else if (InRect(p, btnMaximize.rect)) {
            if (isFullscreen) {
                SetWindowLong(hwnd, GWL_STYLE, WS_OVERLAPPEDWINDOW);
                SetWindowPos(hwnd, nullptr, normalRect.left, normalRect.top,
                    normalRect.right - normalRect.left, normalRect.bottom - normalRect.top,
                    SWP_FRAMECHANGED);
                isFullscreen = false;
            }
            else {
                GetWindowRect(hwnd, &normalRect);
                SetWindowLong(hwnd, GWL_STYLE, WS_POPUP);
                SetWindowPos(hwnd, HWND_TOP, 0, 0, GetSystemMetrics(SM_CXSCREEN),
                    GetSystemMetrics(SM_CYSCREEN), SWP_FRAMECHANGED);
                isFullscreen = true;
            }
        }
        else if (InRect(p, btnPlay.rect)) {
            ShellExecuteW(nullptr, L"open", GTA_PATH, nullptr, nullptr, SW_SHOWNORMAL);
        }
        else if (InRect(p, btnNews.rect)) {
            showNews = true;
            showSettings = false;
        }
        else if (InRect(p, btnSettings.rect)) {
            showSettings = true;
            showNews = false;
        }
        else if (InRect(p, btnNewsBack.rect) || InRect(p, btnSettingsBack.rect)) {
            showNews = false;
            showSettings = false;
        }
        else if (InRect(p, btnNewsPrev.rect)) {
            currentNewsIndex = (currentNewsIndex - 1 + numNews) % numNews;
        }
        else if (InRect(p, btnNewsNext.rect)) {
            currentNewsIndex = (currentNewsIndex + 1) % numNews;
        }
        else if (InRect(p, btnCheckFullscreen.rect)) {
            settingFullscreen = !settingFullscreen;
        }
        else if (InRect(p, btnCheckAutoUpdate.rect)) {
            settingAutoUpdate = !settingAutoUpdate;
        }
        else if (InRect(p, btnCheckSound.rect)) {
            settingSoundEffects = !settingSoundEffects;
        }
        else if (InRect(p, btnDiscord.rect)) {
            ShellExecuteW(nullptr, L"open", L"https://discord.gg/majestic", nullptr, nullptr, SW_SHOWNORMAL);
        }
        else if (InRect(p, btnForum.rect)) {
            ShellExecuteW(nullptr, L"open", L"https://forum.majestic-rp.ru", nullptr, nullptr, SW_SHOWNORMAL);
        }
        else if (InRect(p, btnDonate.rect)) {
            ShellExecuteW(nullptr, L"open", L"https://donate.majestic-rp.ru", nullptr, nullptr, SW_SHOWNORMAL);
        }
        else if (InRect(p, btnStats.rect)) {
            ShellExecuteW(nullptr, L"open", L"https://stats.majestic-rp.ru", nullptr, nullptr, SW_SHOWNORMAL);
        }
        else if (InRect(p, btnRules.rect)) {
            ShellExecuteW(nullptr, L"open", L"https://rules.majestic-rp.ru", nullptr, nullptr, SW_SHOWNORMAL);
        }
        else if (InRect(p, btnEvents.rect)) {
            ShellExecuteW(nullptr, L"open", L"https://events.majestic-rp.ru", nullptr, nullptr, SW_SHOWNORMAL);
        }

        InvalidateRect(hwnd, nullptr, FALSE);
        break;
    }

    case WM_NCHITTEST:
    {
        POINT p;
        GetCursorPos(&p);
        ScreenToClient(hwnd, &p);
        RECT clientRect;
        GetClientRect(hwnd, &clientRect);

        // –†–∞–∑—Ä–µ—à–∞–µ–º –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ –∑–∞ –∑–∞–≥–æ–ª–æ–≤–æ–∫
        if (p.y < 80) return HTCAPTION;
        return HTCLIENT;
    }

    case WM_DESTROY:
        delete background;
        delete logo;
        for (int i = 0; i < numNews; ++i) delete newsImages[i];
        PostQuitMessage(0);
        break;

    default:
        return DefWindowProc(hwnd, msg, wParam, lParam);
    }
    return 0;
}

// ================= MAIN =================
int WINAPI WinMain(HINSTANCE hInstance, HINSTANCE hPrevInstance, LPSTR lpCmdLine, int nCmdShow)
{
    GdiplusStartupInput gdiInput;
    GdiplusStartup(&gdiToken, &gdiInput, nullptr);

    WNDCLASSEXW wc = { 0 };
    wc.cbSize = sizeof(WNDCLASSEXW);
    wc.style = CS_HREDRAW | CS_VREDRAW;
    wc.lpfnWndProc = WndProc;
    wc.hInstance = hInstance;
    wc.hCursor = LoadCursor(nullptr, IDC_ARROW);
    wc.hbrBackground = (HBRUSH)CreateSolidBrush(RGB(15, 15, 20));
    wc.lpszClassName = L"MajesticLauncher";
    RegisterClassExW(&wc);

    HWND hwnd = CreateWindowExW(
        WS_EX_LAYERED | WS_EX_TOPMOST,
        L"MajesticLauncher",
        L"Majestic RP Launcher",
        WS_POPUP | WS_VISIBLE,
        (GetSystemMetrics(SM_CXSCREEN) - W) / 2,
        (GetSystemMetrics(SM_CYSCREEN) - H) / 2,
        W, H,
        nullptr, nullptr, hInstance, nullptr
    );

    SetLayeredWindowAttributes(hwnd, 0, 255, LWA_ALPHA);

    ShowWindow(hwnd, nCmdShow);
    UpdateWindow(hwnd);

    MSG msg;
    while (GetMessage(&msg, nullptr, 0, 0)) {
        TranslateMessage(&msg);
        DispatchMessage(&msg);
    }

    GdiplusShutdown(gdiToken);
    return (int)msg.wParam;
}
