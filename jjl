#include <windows.h>
#include <gdiplus.h>
#include <urlmon.h>
#include <shellapi.h>
#include <dwmapi.h>
#include <wchar.h>
#include <cmath>
#include <string>

#pragma comment(lib, "gdiplus.lib")
#pragma comment(lib, "urlmon.lib")
#pragma comment(lib, "dwmapi.lib")

using namespace Gdiplus;

// ================= CONFIG =================
const int W = 1400;
const int H = 800;

const wchar_t* BG_URL    = L"https://images.unsplash.com/photo-1557683311-973673bafdbd?w=1800";
const wchar_t* BG_FILE   = L"background.jpg";
const wchar_t* LOGO_URL  = L"https://i.imgur.com/placeholder.png";
const wchar_t* LOGO_FILE = L"logo.png";

const wchar_t* GTA_PATH = L"C:\\Games\\GTA5\\GTA5.exe";

// ================= –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï =================
ULONG_PTR gdiToken;
Image* background = nullptr;
Image* logo = nullptr;
bool isFullscreen = false;
RECT normalRect;
float progress = 0.0f;
bool showNews = false;
bool showSettings = false;
bool showDiscord = false;
bool showForum = false;
bool showDonate = false;
bool showStats = false;
bool showRules = false;
bool showEvents = false;
int currentNewsIndex = 0;

// –í—Ö–æ–¥/–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
enum AppScreen { SCREEN_LOGIN, SCREEN_REGISTER, SCREEN_MAIN };
AppScreen currentScreen = SCREEN_LOGIN;
std::wstring loginUsername;
std::wstring loginPassword;
std::wstring regUsername;
std::wstring regPassword;
std::wstring regEmail;
int activeInput = 0; // 0 - –Ω–µ—Ç, 1-3 –¥–ª—è –ª–æ–≥–∏–Ω–∞, 4-6 –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏

// ================= –ù–û–í–û–°–¢–ò =================
struct NewsItem {
    const wchar_t* title;
    const wchar_t* description;
    const wchar_t* imageUrl;
    const wchar_t* imageFile;
};

NewsItem newsItems[] = {
    { L"üî• –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ 1.5: –ù–æ–≤—ã–µ –º–∞—à–∏–Ω—ã!", L"–î–æ–±–∞–≤–ª–µ–Ω—ã 15 –Ω–æ–≤—ã—Ö –ø—Ä–µ–º–∏–∞–ª—å–Ω—ã—Ö –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π –∏ 5 –∑–∞—Ö–≤–∞—Ç—ã–≤–∞—é—â–∏—Ö –º–∏—Å—Å–∏–π.\n–ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ –Ω–∞ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–º —Ñ–æ—Ä—É–º–µ.", L"https://picsum.photos/900/160?random=1", L"news1.jpg" },
    { L"üèÜ –ö–æ–Ω–∫—É—Ä—Å –Ω–∞ –ª—É—á—à–∏–π –±–∏–ª–¥", L"–£—á–∞—Å—Ç–≤—É–π—Ç–µ –∏ –≤—ã–∏–≥—Ä—ã–≤–∞–π—Ç–µ —ç–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã–µ –ø—Ä–∏–∑—ã! –ì–ª–∞–≤–Ω—ã–π –ø—Ä–∏–∑ - 50.000.000$\n–°—Ä–æ–∫ –ø–æ–¥–∞—á–∏ –∑–∞—è–≤–æ–∫ –¥–æ 20 —è–Ω–≤–∞—Ä—è 2026.", L"https://picsum.photos/900/160?random=2", L"news2.jpg" },
    { L"‚öîÔ∏è –ú–∞—Å—à—Ç–∞–±–Ω–∞—è –±–∞–Ω –≤–æ–ª–Ω–∞ —á–∏—Ç–µ—Ä–æ–≤", L"–ù–∞—à–∞ –∫–æ–º–∞–Ω–¥–∞ –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–æ–≤ –æ—á–∏—Å—Ç–∏–ª–∞ —Å–µ—Ä–≤–µ—Ä –æ—Ç 847 –Ω–∞—Ä—É—à–∏—Ç–µ–ª–µ–π.\n–°–ø–∞—Å–∏–±–æ –∏–≥—Ä–æ–∫–∞–º –∑–∞ –∞–∫—Ç–∏–≤–Ω—ã–µ —Ä–µ–ø–æ—Ä—Ç—ã!", L"https://picsum.photos/900/160?random=3", L"news3.jpg" },
    { L"üéâ –ü—Ä–∞–∑–¥–Ω–∏—á–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ", L"–° 25 –¥–µ–∫–∞–±—Ä—è –ø–æ 10 —è–Ω–≤–∞—Ä—è - –Ω–æ–≤–æ–≥–æ–¥–Ω–∏–µ –∫–≤–µ—Å—Ç—ã —Å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º–∏ –Ω–∞–≥—Ä–∞–¥–∞–º–∏!", L"https://picsum.photos/900/160?random=4", L"news4.jpg" },
};
const int numNews = sizeof(newsItems) / sizeof(NewsItem);
Image* newsImages[4] = { nullptr };

// ================= –ù–ê–°–¢–†–û–ô–ö–ò =================
bool settingFullscreen    = false;
bool settingAutoUpdate    = true;
bool settingSoundEffects  = true;
bool settingNotifications = true;
bool settingFPS           = false;
int  settingVolume        = 75;
int  settingGraphics      = 1; // 0=Low, 1=Medium, 2=High

// ================= UI –°–¢–†–£–ö–¢–£–†–´ =================
struct Button {
    RECT rect;
    const wchar_t* text;
    bool hover;
    Color normalColor;
    Color hoverColor;
    int fontSize;
    const wchar_t* tooltip;
};

struct Panel {
    RECT rect;
    Color bgColor;
    int borderRadius;
};

struct InputField {
    RECT rect;
    std::wstring* value;
    const wchar_t* placeholder;
    bool isPassword;
    bool active;
    bool hover;
    int cursorPos;
};

// ================= –ö–ù–û–ü–ö–ò –ì–õ–ê–í–ù–û–ì–û –≠–ö–†–ê–ù–ê =================
Button btnPlay       { {500,550,900,640}, L"‚ñ∂ –ó–ê–ü–£–°–¢–ò–¢–¨ –ò–ì–†–£", false, Color(100, 60,180,255), Color(120, 80,200,255), 28, L"–ó–∞–ø—É—Å—Ç–∏—Ç—å GTA V" };
Button btnNews       { {50, 200,370,280}, L"üì∞ –ù–û–í–û–°–¢–ò",         false, Color(70, 40, 50,140),  Color(100, 60, 80,200),  20, L"–ü–æ—Å–ª–µ–¥–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è" };
Button btnSettings   { {50, 300,370,380}, L"‚öô –ù–ê–°–¢–†–û–ô–ö–ò",       false, Color(70, 40, 50,140),  Color(100, 60, 80,200),  20, L"–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ª–∞—É–Ω—á–µ—Ä–∞" };
Button btnDiscord    { {50, 400,370,480}, L"üí¨ DISCORD",         false, Color(88, 88,101,242),  Color(110, 110,130,255), 20, L"–ù–∞—à–µ Discord —Å–æ–æ–±—â–µ—Å—Ç–≤–æ" };
Button btnForum      { {50, 500,370,580}, L"üåê –§–û–†–£–ú",           false, Color(70, 40, 50,140),  Color(100, 60, 80,200),  20, L"–û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π —Ñ–æ—Ä—É–º" };
Button btnDonate     { {1030,200,1350,280},L"üíé –î–û–ù–ê–¢",          false, Color(100, 255,215,80), Color(120, 255,235,100), 20, L"–ü–æ–¥–¥–µ—Ä–∂–∞—Ç—å –ø—Ä–æ–µ–∫—Ç" };
Button btnStats      { {1030,300,1350,380},L"üìä –°–¢–ê–¢–ò–°–¢–ò–ö–ê",     false, Color(70, 40, 50,140),  Color(100, 60, 80,200),  20, L"–ò–≥—Ä–æ–≤–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞" };
Button btnRules      { {1030,400,1350,480},L"üìú –ü–†–ê–í–ò–õ–ê",        false, Color(100, 220,60,60),  Color(120, 240,90,90),   20, L"–ü—Ä–∞–≤–∏–ª–∞ —Å–µ—Ä–≤–µ—Ä–∞" };
Button btnEvents     { {1030,500,1350,580},L"üé™ –°–û–ë–´–¢–ò–Ø",        false, Color(100, 140,0,200),  Color(120, 180,40,240),  20, L"–ë–ª–∏–∂–∞–π—à–∏–µ –∏–≤–µ–Ω—Ç—ã" };

Button btnMinimize   { {W-150,10,W-110,50}, L"‚Äî", false, Color(0,0,0,0), Color(180, 180,180,220), 22, L"–°–≤–µ—Ä–Ω—É—Ç—å" };
Button btnMaximize   { {W-100,10,W-60, 50}, L"‚ñ°", false, Color(0,0,0,0), Color(180, 180,180,220), 22, L"–†–∞–∑–≤–µ—Ä–Ω—É—Ç—å" };
Button btnClose      { {W-50, 10,W-10, 50}, L"‚úï", false, Color(0,0,0,0), Color(220, 220,60,60),   22, L"–ó–∞–∫—Ä—ã—Ç—å" };

// ================= –ö–ù–û–ü–ö–ò –í–õ–û–ñ–ï–ù–ù–´–• –≠–ö–†–ê–ù–û–í =================
Button btnNewsBack   { {50,  80,200,140}, L"‚Üê –ù–ê–ó–ê–î", false, Color(80, 60,60,100), Color(120, 100,100,150), 20, L"–í–µ—Ä–Ω—É—Ç—å—Å—è" };
Button btnNewsPrev   { {450,680,580,740}, L"‚óÑ",       false, Color(80, 60,60,100), Color(120, 100,100,150), 28, L"–ü—Ä–µ–¥—ã–¥—É—â–∞—è" };
Button btnNewsNext   { {820,680,950,740}, L"‚ñ∫",       false, Color(80, 60,60,100), Color(120, 100,100,150), 28, L"–°–ª–µ–¥—É—é—â–∞—è" };

Button btnSettingsBack { {50,  80,200,140}, L"‚Üê –ù–ê–ó–ê–î", false, Color(80, 60,60,100), Color(120, 100,100,150), 20, L"–í–µ—Ä–Ω—É—Ç—å—Å—è" };

Button btnCheckFullscreen  { {280,210,1100,255}, L"üñ• –ó–∞–ø—É—Å–∫–∞—Ç—å –∏–≥—Ä—É –≤ –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω–æ–º —Ä–µ–∂–∏–º–µ",      false, Color(0,0,0,0), Color(90, 90,90,110), 18, L"" };
Button btnCheckAutoUpdate  { {280,275,1100,320}, L"üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è",        false, Color(0,0,0,0), Color(90, 90,90,110), 18, L"" };
Button btnCheckSound       { {280,340,1100,385}, L"üîä –í–∫–ª—é—á–∏—Ç—å –∑–≤—É–∫–æ–≤—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã",                 false, Color(0,0,0,0), Color(90, 90,90,110), 18, L"" };
Button btnCheckNotify      { {280,405,1100,450}, L"üîî –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è",                    false, Color(0,0,0,0), Color(90, 90,90,110), 18, L"" };
Button btnCheckFPS         { {280,470,1100,515}, L"üìà –û—Ç–æ–±—Ä–∞–∂–∞—Ç—å FPS –≤ –∏–≥—Ä–µ",                     false, Color(0,0,0,0), Color(90, 90,90,110), 18, L"" };

// –ö–Ω–æ–ø–∫–∏ –¥—Ä—É–≥–∏—Ö —ç–∫—Ä–∞–Ω–æ–≤
Button btnDiscordBack { {50,  80,200,140}, L"‚Üê –ù–ê–ó–ê–î", false, Color(80, 60,60,100), Color(120, 100,100,150), 20, L"–í–µ—Ä–Ω—É—Ç—å—Å—è" };
Button btnForumBack   { {50,  80,200,140}, L"‚Üê –ù–ê–ó–ê–î", false, Color(80, 60,60,100), Color(120, 100,100,150), 20, L"–í–µ—Ä–Ω—É—Ç—å—Å—è" };
Button btnDonateBack  { {50,  80,200,140}, L"‚Üê –ù–ê–ó–ê–î", false, Color(80, 60,60,100), Color(120, 100,100,150), 20, L"–í–µ—Ä–Ω—É—Ç—å—Å—è" };
Button btnStatsBack   { {50,  80,200,140}, L"‚Üê –ù–ê–ó–ê–î", false, Color(80, 60,60,100), Color(120, 100,100,150), 20, L"–í–µ—Ä–Ω—É—Ç—å—Å—è" };
Button btnRulesBack   { {50,  80,200,140}, L"‚Üê –ù–ê–ó–ê–î", false, Color(80, 60,60,100), Color(120, 100,100,150), 20, L"–í–µ—Ä–Ω—É—Ç—å—Å—è" };
Button btnEventsBack  { {50,  80,200,140}, L"‚Üê –ù–ê–ó–ê–î", false, Color(80, 60,60,100), Color(120, 100,100,150), 20, L"–í–µ—Ä–Ω—É—Ç—å—Å—è" };

// –ö–Ω–æ–ø–∫–∏ –≤—Ö–æ–¥–∞/—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
Button btnLogin       { {W/2-280,500,W/2-20,570}, L"–í–û–ô–¢–ò",          false, Color(120, 60,180,255), Color(150, 80,200,255), 22, L"–í–æ–π—Ç–∏ –≤ –∞–∫–∫–∞—É–Ω—Ç" };
Button btnToRegister  { {W/2-280,600,W/2-20,660}, L"–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è",   false, Color(80, 60,60,100),   Color(120, 100,100,150), 18, L"–°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç" };
Button btnRegister    { {W/2+20,500,W/2+280,570}, L"–°–û–ó–î–ê–¢–¨ –ê–ö–ö–ê–£–ù–¢", false, Color(120, 60,180,255), Color(150, 80,200,255), 22, L"–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è" };
Button btnToLogin     { {W/2+20,600,W/2+280,660}, L"–£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç", false, Color(80, 60,60,100),  Color(120, 100,100,150), 18, L"–í–µ—Ä–Ω—É—Ç—å—Å—è –∫–æ –≤—Ö–æ–¥—É" };

// ================= –ü–û–õ–Ø –í–í–û–î–ê =================
InputField loginUsernameField { {W/2-280,320,W/2-20,370}, &loginUsername, L"–õ–æ–≥–∏–Ω", false, false, false, 0 };
InputField loginPasswordField { {W/2-280,390,W/2-20,440}, &loginPassword, L"–ü–∞—Ä–æ–ª—å", true, false, false, 0 };

InputField regUsernameField   { {W/2+20,280,W/2+280,330}, &regUsername, L"–õ–æ–≥–∏–Ω", false, false, false, 0 };
InputField regEmailField      { {W/2+20,350,W/2+280,400}, &regEmail,    L"Email", false, false, false, 0 };
InputField regPasswordField   { {W/2+20,420,W/2+280,470}, &regPassword, L"–ü–∞—Ä–æ–ª—å", true, false, false, 0 };

// ================= –ü–ê–ù–ï–õ–ò =================
Panel mainPanelLeft   { {30,  170,390,610}, Color(50, 25,25,35), 20 };
Panel mainPanelRight  { {1010,170,1370,610},Color(50, 25,25,35), 20 };
Panel playPanel       { {480, 530,920,660}, Color(40, 15,15,25), 28 };
Panel newsPanel       { {220, 120,1180,760},Color(60, 30,30,45), 24 };
Panel settingsPanel   { {220, 120,1180,760},Color(60, 30,30,45), 24 };
Panel contentPanel    { {220, 120,1180,760},Color(60, 30,30,45), 24 };

Panel loginPanel      { {W/2-320,200,W/2-20,690}, Color(60, 30,30,45), 24 };
Panel registerPanel   { {W/2+20,200,W/2+320,690}, Color(60, 30,30,45), 24 };

// ================= –£–¢–ò–õ–ò–¢–´ =================
bool InRect(const POINT& p, const RECT& r) {
    return p.x >= r.left && p.x <= r.right && p.y >= r.top && p.y <= r.bottom;
}

void DrawRoundedRect(Graphics& g, Brush* brush, const RectF& rect, REAL radius) {
    GraphicsPath path;
    path.AddArc(rect.X, rect.Y, radius*2, radius*2, 180, 90);
    path.AddArc(rect.X + rect.Width - radius*2, rect.Y, radius*2, radius*2, 270, 90);
    path.AddArc(rect.X + rect.Width - radius*2, rect.Y + rect.Height - radius*2, radius*2, radius*2, 0, 90);
    path.AddArc(rect.X, rect.Y + rect.Height - radius*2, radius*2, radius*2, 90, 90);
    path.CloseFigure();
    g.FillPath(brush, &path);
}

void DrawRoundedRectOutline(Graphics& g, Pen* pen, const RectF& rect, REAL radius) {
    GraphicsPath path;
    path.AddArc(rect.X, rect.Y, radius*2, radius*2, 180, 90);
    path.AddArc(rect.X + rect.Width - radius*2, rect.Y, radius*2, radius*2, 270, 90);
    path.AddArc(rect.X + rect.Width - radius*2, rect.Y + rect.Height - radius*2, radius*2, radius*2, 0, 90);
    path.AddArc(rect.X, rect.Y + rect.Height - radius*2, radius*2, radius*2, 90, 90);
    path.CloseFigure();
    g.DrawPath(pen, &path);
}

void DrawPanel(Graphics& g, const Panel& p) {
    SolidBrush brush(p.bgColor);
    RectF rect((REAL)p.rect.left, (REAL)p.rect.top, (REAL)(p.rect.right - p.rect.left), (REAL)(p.rect.bottom - p.rect.top));
    DrawRoundedRect(g, &brush, rect, (REAL)p.borderRadius);

    Pen border(Color(100, 140, 160, 100), 1.5f);
    DrawRoundedRectOutline(g, &border, rect, (REAL)p.borderRadius);
}

void DrawButton(Graphics& g, const Button& b) {
    Color bg = b.hover ? b.hoverColor : b.normalColor;
    SolidBrush brush(bg);
    RectF r((REAL)b.rect.left, (REAL)b.rect.top, (REAL)(b.rect.right - b.rect.left), (REAL)(b.rect.bottom - b.rect.top));
    DrawRoundedRect(g, &brush, r, 14.0f);

    if (b.hover) {
        Pen pen(Color(180, 255, 255, 255), 2.5f);
        DrawRoundedRectOutline(g, &pen, r, 14.0f);
    }

    FontFamily ff(L"Segoe UI");
    Font font(&ff, (REAL)b.fontSize, FontStyleBold);
    SolidBrush text(Color(255, 255, 255));
    SolidBrush shadow(Color(100, 0, 0, 0));

    StringFormat fmt;
    fmt.SetAlignment(StringAlignmentCenter);
    fmt.SetLineAlignment(StringAlignmentCenter);

    g.DrawString(b.text, -1, &font, PointF(r.X+2, r.Y+2), &fmt, &shadow);
    g.DrawString(b.text, -1, &font, r, &fmt, &text);
}

void DrawCheckbox(Graphics& g, const Button& b, bool checked) {
    RectF r((REAL)b.rect.left, (REAL)b.rect.top, (REAL)(b.rect.right - b.rect.left), (REAL)(b.rect.bottom - b.rect.top));

    SolidBrush bg(b.hover ? Color(80, 70,70,90) : Color(50, 50,50,60));
    DrawRoundedRect(g, &bg, r, 10.0f);

    RectF box(r.X + 18, r.Y + (r.Height-30)/2, 30, 30);
    
    if (checked) {
        LinearGradientBrush fill(PointF(box.X, box.Y), PointF(box.X+30, box.Y+30), Color(80, 200, 100), Color(60, 160, 80));
        DrawRoundedRect(g, &fill, box, 6.0f);
        
        // –ì–∞–ª–æ—á–∫–∞
        Pen check(Color(255, 255, 255), 3.0f);
        check.SetLineCap(LineCapRound, LineCapRound, DashCapRound);
        g.DrawLine(&check, box.X+7, box.Y+15, box.X+13, box.Y+21);
        g.DrawLine(&check, box.X+13, box.Y+21, box.X+23, box.Y+9);
    } else {
        Pen pen(Color(150, 200, 200, 200), 2.5f);
        DrawRoundedRectOutline(g, &pen, box, 6.0f);
    }

    FontFamily ff(L"Segoe UI");
    Font font(&ff, 18);
    SolidBrush text(Color(240, 240, 250));
    RectF textRect(r.X + 60, r.Y, r.Width - 70, r.Height);
    StringFormat fmt; 
    fmt.SetLineAlignment(StringAlignmentCenter);
    g.DrawString(b.text, -1, &font, textRect, &fmt, &text);
}

void DrawInputField(Graphics& g, const InputField& field) {
    RectF r((REAL)field.rect.left, (REAL)field.rect.top, (REAL)(field.rect.right - field.rect.left), (REAL)(field.rect.bottom - field.rect.top));
    
    Color bgColor = field.active ? Color(80, 60, 60, 80) : (field.hover ? Color(70, 50, 50, 70) : Color(60, 40, 40, 60));
    SolidBrush bg(bgColor);
    DrawRoundedRect(g, &bg, r, 10.0f);

    Pen border(field.active ? Color(200, 100, 200, 255) : Color(120, 100, 120, 180), field.active ? 2.5f : 1.5f);
    DrawRoundedRectOutline(g, &border, r, 10.0f);

    FontFamily ff(L"Segoe UI");
    Font font(&ff, 18.0f);
    SolidBrush textBrush(Color(240, 240, 250));
    SolidBrush placeholderBrush(Color(140, 150, 150, 150));

    RectF textRect(r.X + 15, r.Y, r.Width - 30, r.Height);
    StringFormat fmt;
    fmt.SetLineAlignment(StringAlignmentCenter);
    fmt.SetTrimming(StringTrimmingNone);

    if (field.value->empty()) {
        g.DrawString(field.placeholder, -1, &font, textRect, &fmt, &placeholderBrush);
    } else {
        if (field.isPassword) {
            std::wstring masked(field.value->length(), L'‚óè');
            g.DrawString(masked.c_str(), -1, &font, textRect, &fmt, &textBrush);
        } else {
            g.DrawString(field.value->c_str(), -1, &font, textRect, &fmt, &textBrush);
        }
        
        // –ö—É—Ä—Å–æ—Ä
        if (field.active && ((GetTickCount() / 500) % 2 == 0)) {
            RectF bound;
            if (field.isPassword) {
                std::wstring masked(field.value->length(), L'‚óè');
                g.MeasureString(masked.c_str(), -1, &font, textRect, &fmt, &bound);
            } else {
                g.MeasureString(field.value->c_str(), -1, &font, textRect, &fmt, &bound);
            }
            Pen cursor(Color(200, 200, 250), 2.0f);
            REAL cursorX = r.X + 15 + bound.Width;
            g.DrawLine(&cursor, cursorX, r.Y + 12, cursorX, r.Y + r.Height - 12);
        }
    }
}

void DrawVolumeSlider(Graphics& g, int volume) {
    RectF track(280, 570, 820, 16);
    SolidBrush trackBg(Color(80, 60, 60, 70));
    DrawRoundedRect(g, &trackBg, track, 8);

    float pos = volume / 100.0f;
    RectF fill(280, 570, 820 * pos, 16);
    LinearGradientBrush grad(PointF(280, 570), PointF(1100, 570), Color(100, 160, 255), Color(80, 100, 220));
    DrawRoundedRect(g, &grad, fill, 8);

    REAL x = 280 + 820 * pos - 18;
    RectF circle(x, 570 - 16, 36, 36);
    LinearGradientBrush circleBrush(PointF(x, 570-16), PointF(x+36, 570+20), Color(255, 255, 255), Color(220, 220, 240));
    g.FillEllipse(&circleBrush, circle);

    Pen borderPen(Color(180, 180, 200), 3.0f);
    g.DrawEllipse(&borderPen, circle);

    wchar_t txt[64];
    swprintf_s(txt, L"üîä –ì—Ä–æ–º–∫–æ—Å—Ç—å –∑–≤—É–∫–æ–≤: %d%%", volume);
    FontFamily ff(L"Segoe UI");
    Font font(&ff, 16.0f);
    SolidBrush text(Color(220, 220, 240));
    g.DrawString(txt, -1, &font, PointF(280, 610), &text);
}

void DrawGraphicsSelector(Graphics& g, int level) {
    const wchar_t* levels[] = { L"–ù–∏–∑–∫–∞—è", L"–°—Ä–µ–¥–Ω—è—è", L"–í—ã—Å–æ–∫–∞—è" };
    
    FontFamily ff(L"Segoe UI");
    Font font(&ff, 16.0f);
    SolidBrush text(Color(220, 220, 240));
    g.DrawString(L"üé® –ö–∞—á–µ—Å—Ç–≤–æ –≥—Ä–∞—Ñ–∏–∫–∏:", -1, &font, PointF(280, 675), &text);

    for (int i = 0; i < 3; ++i) {
        RectF r(280 + i * 280, 710, 260, 45);
        Color bg = (i == level) ? Color(100, 60, 180, 255) : Color(70, 50, 50, 70);
        SolidBrush brush(bg);
        DrawRoundedRect(g, &brush, r, 10);

        if (i == level) {
            Pen border(Color(180, 120, 255, 255), 2.5f);
            DrawRoundedRectOutline(g, &border, r, 10);
        }

        Font btnFont(&ff, 18.0f, FontStyleBold);
        SolidBrush btnText(Color(255, 255, 255));
        StringFormat fmt;
        fmt.SetAlignment(StringAlignmentCenter);
        fmt.SetLineAlignment(StringAlignmentCenter);
        g.DrawString(levels[i], -1, &btnFont, r, &fmt, &btnText);
    }
}

void DrawGradientOverlay(Graphics& g) {
    LinearGradientBrush gradient(Point(0, 0), Point(0, H), Color(200, 0, 0, 0), Color(240, 10, 10, 15));
    g.FillRectangle(&gradient, 0, 0, W, H);
}

void DrawHeader(Graphics& g) {
    LinearGradientBrush headerGrad(Point(0, 0), Point(0, 90), Color(180, 15, 15, 30), Color(80, 5, 5, 15));
    g.FillRectangle(&headerGrad, 0, 0, W, 90);

    if (logo) {
        g.DrawImage(logo, 30, 15, 60, 60);
    }

    FontFamily ff(L"Segoe UI");
    Font titleFont(&ff, 42.0f, FontStyleBold);
    SolidBrush shadow(Color(150, 0, 0, 0));
    
    LinearGradientBrush orange(PointF(100, 15), PointF(400, 60), Color(255, 230, 120), Color(255, 180, 60));
    LinearGradientBrush white(PointF(400, 15), PointF(700, 60), Color(255, 255, 255), Color(220, 220, 240));

    g.DrawString(L"MAJESTIC", -1, &titleFont, PointF(108, 20), &shadow);
    g.DrawString(L"MAJESTIC", -1, &titleFont, PointF(105, 16), &orange);

    g.DrawString(L"ROLEPLAY", -1, &titleFont, PointF(378, 20), &shadow);
    g.DrawString(L"ROLEPLAY", -1, &titleFont, PointF(375, 16), &white);
}

void DrawServerInfo(Graphics& g) {
    FontFamily ff(L"Segoe UI");
    Font infoFont(&ff, 17.0f, FontStyleBold);
    Font smallFont(&ff, 14.0f);
    SolidBrush white(Color::White);
    SolidBrush green(Color(60, 255, 100));
    SolidBrush gray(Color(200, 220, 220, 220));

    g.DrawString(L"‚óè –°–ï–†–í–ï–† –û–ù–õ–ê–ô–ù", -1, &infoFont, PointF((REAL)W - 360, 28), &green);
    g.DrawString(L"–ò–≥—Ä–æ–∫–æ–≤: 2847 / 3000", -1, &smallFont, PointF((REAL)W - 360, 52), &gray);
}

void DrawTooltip(Graphics& g, const wchar_t* text, POINT mouse) {
    if (!text || !*text) return;

    FontFamily ff(L"Segoe UI");
    Font font(&ff, 15.0f);
    RectF bound;
    g.MeasureString(text, -1, &font, PointF(0, 0), &bound);

    REAL w = bound.Width + 28;
    REAL h = bound.Height + 20;
    REAL x = mouse.x + 24;
    REAL y = mouse.y + 32;

    if (x + w > W) x = mouse.x - w - 16;
    if (y + h > H) y = mouse.y - h - 16;

    RectF rect(x, y, w, h);
    LinearGradientBrush bg(PointF(x, y), PointF(x, y+h), Color(250, 40, 40, 60), Color(250, 25, 25, 45));
    DrawRoundedRect(g, &bg, rect, 12.0f);

    Pen border(Color(200, 160, 180, 240), 1.8f);
    DrawRoundedRectOutline(g, &border, rect, 12.0f);

    SolidBrush txtBrush(Color(255, 255, 255));
    StringFormat fmt;
    fmt.SetAlignment(StringAlignmentCenter);
    fmt.SetLineAlignment(StringAlignmentCenter);
    g.DrawString(text, -1, &font, rect, &fmt, &txtBrush);
}

void DrawProgressBar(Graphics& g, float progress) {
    RectF bgRect(500, 680, 400, 20);
    RectF progressRect(500, 680, 400 * progress, 20);

    SolidBrush bgBrush(Color(100, 50, 50, 60));
    DrawRoundedRect(g, &bgBrush, bgRect, 10);

    LinearGradientBrush progressBrush(PointF(500, 680), PointF(900, 680), Color(255, 240, 120), Color(255, 200, 80));
    DrawRoundedRect(g, &progressBrush, progressRect, 10);

    Pen border(Color(150, 200, 200, 100), 1.5f);
    DrawRoundedRectOutline(g, &border, bgRect, 10);

    wchar_t txt[32];
    swprintf_s(txt, L"%.0f%%", progress * 100);
    FontFamily ff(L"Segoe UI");
    Font font(&ff, 13.0f, FontStyleBold);
    SolidBrush textBrush(Color(255, 255, 250));
    StringFormat fmt;
    fmt.SetAlignment(StringAlignmentCenter);
    fmt.SetLineAlignment(StringAlignmentCenter);
    g.DrawString(txt, -1, &font, bgRect, &fmt, &textBrush);
}

// ================= –≠–ö–†–ê–ù–´ =================
void DrawNews(Graphics& g) {
    DrawPanel(g, newsPanel);

    FontFamily ff(L"Segoe UI");
    Font titleFont(&ff, 32.0f, FontStyleBold);
    Font descFont(&ff, 18.0f);
    SolidBrush white(Color(255, 255, 255));
    SolidBrush gray(Color(200, 200, 210));

    g.DrawString(L"üì∞ –ù–û–í–û–°–¢–ò –°–ï–†–í–ï–†–ê", -1, &titleFont, PointF(260, 150), &white);

    NewsItem& news = newsItems[currentNewsIndex];
    
    if (newsImages[currentNewsIndex]) {
        RectF imgRect(250, 240, 900, 180);
        g.DrawImage(newsImages[currentNewsIndex], imgRect);
    }

    g.DrawString(news.title, -1, &titleFont, PointF(250, 450), &white);
    
    RectF descRect(250, 510, 900, 120);
    StringFormat fmt;
    fmt.SetAlignment(StringAlignmentNear);
    g.DrawString(news.description, -1, &descFont, descRect, &fmt, &gray);

    wchar_t counter[32];
    swprintf_s(counter, L"%d / %d", currentNewsIndex + 1, numNews);
    Font counterFont(&ff, 20.0f, FontStyleBold);
    StringFormat ctrFmt;
    ctrFmt.SetAlignment(StringAlignmentCenter);
    g.DrawString(counter, -1, &counterFont, PointF(700, 700), &ctrFmt, &white);

    DrawButton(g, btnNewsBack);
    DrawButton(g, btnNewsPrev);
    DrawButton(g, btnNewsNext);
}

void DrawSettings(Graphics& g) {
    DrawPanel(g, settingsPanel);

    FontFamily ff(L"Segoe UI");
    Font titleFont(&ff, 32.0f, FontStyleBold);
    SolidBrush white(Color(255, 255, 255));

    g.DrawString(L"‚öô –ù–ê–°–¢–†–û–ô–ö–ò –õ–ê–£–ù–ß–ï–†–ê", -1, &titleFont, PointF(260, 150), &white);

    DrawCheckbox(g, btnCheckFullscreen, settingFullscreen);
    DrawCheckbox(g, btnCheckAutoUpdate, settingAutoUpdate);
    DrawCheckbox(g, btnCheckSound, settingSoundEffects);
    DrawCheckbox(g, btnCheckNotify, settingNotifications);
    DrawCheckbox(g, btnCheckFPS, settingFPS);

    DrawVolumeSlider(g, settingVolume);
    DrawGraphicsSelector(g, settingGraphics);

    DrawButton(g, btnSettingsBack);
}

void DrawContentScreen(Graphics& g, const wchar_t* title, const wchar_t* content) {
    DrawPanel(g, contentPanel);

    FontFamily ff(L"Segoe UI");
    Font titleFont(&ff, 32.0f, FontStyleBold);
    Font textFont(&ff, 18.0f);
    SolidBrush white(Color(255, 255, 255));
    SolidBrush gray(Color(200, 200, 210));

    g.DrawString(title, -1, &titleFont, PointF(260, 150), &white);

    RectF contentRect(260, 220, 900, 500);
    StringFormat fmt;
    g.DrawString(content, -1, &textFont, contentRect, &fmt, &gray);
}

void DrawLoginScreen(Graphics& g) {
    DrawPanel(g, loginPanel);

    FontFamily ff(L"Segoe UI");
    Font titleFont(&ff, 28.0f, FontStyleBold);
    Font subtitleFont(&ff, 16.0f);
    SolidBrush white(Color(255, 255, 255));
    SolidBrush gray(Color(180, 180, 200));

    StringFormat center;
    center.SetAlignment(StringAlignmentCenter);

    RectF titleRect(W/2-320, 230, 300, 40);
    g.DrawString(L"üîê –í–•–û–î –í –ê–ö–ö–ê–£–ù–¢", -1, &titleFont, titleRect, &center, &white);

    RectF subtitleRect(W/2-320, 270, 300, 30);
    g.DrawString(L"–í–æ–π–¥–∏—Ç–µ –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è", -1, &subtitleFont, subtitleRect, &center, &gray);

    DrawInputField(g, loginUsernameField);
    DrawInputField(g, loginPasswordField);
    DrawButton(g, btnLogin);
    DrawButton(g, btnToRegister);
}

void DrawRegisterScreen(Graphics& g) {
    DrawPanel(g, registerPanel);

    FontFamily ff(L"Segoe UI");
    Font titleFont(&ff, 28.0f, FontStyleBold);
    Font subtitleFont(&ff, 16.0f);
    SolidBrush white(Color(255, 255, 255));
    SolidBrush gray(Color(180, 180, 200));

    StringFormat center;
    center.SetAlignment(StringAlignmentCenter);

    RectF titleRect(W/2+20, 220, 300, 40);
    g.DrawString(L"‚ú® –†–ï–ì–ò–°–¢–†–ê–¶–ò–Ø", -1, &titleFont, titleRect, &center, &white);

    RectF subtitleRect(W/2+20, 260, 300, 30);
    g.DrawString(L"–°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π –∞–∫–∫–∞—É–Ω—Ç", -1, &subtitleFont, subtitleRect, &center, &gray);

    DrawInputField(g, regUsernameField);
    DrawInputField(g, regEmailField);
    DrawInputField(g, regPasswordField);
    DrawButton(g, btnRegister);
    DrawButton(g, btnToLogin);
}

// ================= WINDOW PROC =================
LRESULT CALLBACK WndProc(HWND hwnd, UINT msg, WPARAM wParam, LPARAM lParam)
{
    static POINT mousePos;
    static const Button* hoveredButton = nullptr;
    static bool isDragging = false;
    static POINT dragOffset;
    static bool isResizingVolume = false;

    switch (msg)
    {
    case WM_CREATE:
    {
        DWM_WINDOW_CORNER_PREFERENCE pref = DWMWCP_ROUND;
        DwmSetWindowAttribute(hwnd, DWMWA_WINDOW_CORNER_PREFERENCE, &pref, sizeof(pref));

        URLDownloadToFileW(nullptr, BG_URL, BG_FILE, 0, nullptr);
        URLDownloadToFileW(nullptr, LOGO_URL, LOGO_FILE, 0, nullptr);
        background = Image::FromFile(BG_FILE);
        logo = Image::FromFile(LOGO_FILE);

        for (int i = 0; i < numNews; ++i) {
            URLDownloadToFileW(nullptr, newsItems[i].imageUrl, newsItems[i].imageFile, 0, nullptr);
            newsImages[i] = Image::FromFile(newsItems[i].imageFile);
        }

        SetTimer(hwnd, 1, 50, nullptr);
        break;
    }

    case WM_TIMER:
        if (wParam == 1) {
            if (currentScreen == SCREEN_MAIN) {
                progress += 0.005f;
                if (progress > 1.0f) progress = 1.0f;
            }
            InvalidateRect(hwnd, nullptr, FALSE);
        }
        break;

    case WM_CHAR:
        if (currentScreen == SCREEN_LOGIN) {
            if (activeInput == 1) {
                if (wParam == VK_BACK && !loginUsername.empty()) {
                    loginUsername.pop_back();
                } else if (wParam >= 32 && wParam < 127) {
                    loginUsername += (wchar_t)wParam;
                }
                InvalidateRect(hwnd, nullptr, FALSE);
            } else if (activeInput == 2) {
                if (wParam == VK_BACK && !loginPassword.empty()) {
                    loginPassword.pop_back();
                } else if (wParam >= 32 && wParam < 127) {
                    loginPassword += (wchar_t)wParam;
                }
                InvalidateRect(hwnd, nullptr, FALSE);
            }
        } else if (currentScreen == SCREEN_REGISTER) {
            if (activeInput == 3) {
                if (wParam == VK_BACK && !regUsername.empty()) {
                    regUsername.pop_back();
                } else if (wParam >= 32 && wParam < 127) {
                    regUsername += (wchar_t)wParam;
                }
                InvalidateRect(hwnd, nullptr, FALSE);
            } else if (activeInput == 4) {
                if (wParam == VK_BACK && !regEmail.empty()) {
                    regEmail.pop_back();
                } else if (wParam >= 32 && wParam < 127) {
                    regEmail += (wchar_t)wParam;
                }
                InvalidateRect(hwnd, nullptr, FALSE);
            } else if (activeInput == 5) {
                if (wParam == VK_BACK && !regPassword.empty()) {
                    regPassword.pop_back();
                } else if (wParam >= 32 && wParam < 127) {
                    regPassword += (wchar_t)wParam;
                }
                InvalidateRect(hwnd, nullptr, FALSE);
            }
        }
        break;

    case WM_PAINT:
    {
        PAINTSTRUCT ps;
        HDC hdc = BeginPaint(hwnd, &ps);

        HDC memDC = CreateCompatibleDC(hdc);
        HBITMAP memBmp = CreateCompatibleBitmap(hdc, W, H);
        SelectObject(memDC, memBmp);

        Graphics g(memDC);
        g.SetSmoothingMode(SmoothingModeAntiAlias);
        g.SetTextRenderingHint(TextRenderingHintAntiAlias);
        g.SetInterpolationMode(InterpolationModeHighQualityBicubic);

        if (background) g.DrawImage(background, 0, 0, W, H);
        DrawGradientOverlay(g);
        DrawHeader(g);
        
        if (currentScreen == SCREEN_LOGIN) {
            DrawLoginScreen(g);
            DrawRegisterScreen(g);
        } else if (currentScreen == SCREEN_REGISTER) {
            DrawLoginScreen(g);
            DrawRegisterScreen(g);
        } else if (currentScreen == SCREEN_MAIN) {
            DrawServerInfo(g);

            if (!showNews && !showSettings && !showDiscord && !showForum && 
                !showDonate && !showStats && !showRules && !showEvents) {
                DrawPanel(g, mainPanelLeft);
                DrawPanel(g, mainPanelRight);
                DrawButton(g, btnNews);
                DrawButton(g, btnSettings);
                DrawButton(g, btnDiscord);
                DrawButton(g, btnForum);
                DrawButton(g, btnDonate);
                DrawButton(g, btnStats);
                DrawButton(g, btnRules);
                DrawButton(g, btnEvents);
                DrawButton(g, btnPlay);
                DrawProgressBar(g, progress);
            } else if (showNews) {
                DrawNews(g);
            } else if (showSettings) {
                DrawSettings(g);
            } else if (showDiscord) {
                DrawContentScreen(g, L"üí¨ DISCORD –°–ï–†–í–ï–†", L"–ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–π—Ç–µ—Å—å –∫ –Ω–∞—à–µ–º—É Discord —Å–æ–æ–±—â–µ—Å—Ç–≤—É!\n\n–ó–¥–µ—Å—å –≤—ã –Ω–∞–π–¥–µ—Ç–µ:\n‚Ä¢ –ê–∫—Ç—É–∞–ª—å–Ω—ã–µ –Ω–æ–≤–æ—Å—Ç–∏ –ø—Ä–æ–µ–∫—Ç–∞\n‚Ä¢ –û–±—â–µ–Ω–∏–µ —Å –∏–≥—Ä–æ–∫–∞–º–∏\n‚Ä¢ –¢–µ—Ö–Ω–∏—á–µ—Å–∫—É—é –ø–æ–¥–¥–µ—Ä–∂–∫—É\n‚Ä¢ –ö–æ–Ω–∫—É—Ä—Å—ã –∏ —Ä–æ–∑—ã–≥—Ä—ã—à–∏\n\n–°—Å—ã–ª–∫–∞: discord.gg/majesticrp");
                DrawButton(g, btnDiscordBack);
            } else if (showForum) {
                DrawContentScreen(g, L"üåê –§–û–†–£–ú –°–ï–†–í–ï–†–ê", L"–û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π —Ñ–æ—Ä—É–º Majestic RP\n\n–†–∞–∑–¥–µ–ª—ã —Ñ–æ—Ä—É–º–∞:\n‚Ä¢ –ù–æ–≤–æ—Å—Ç–∏ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è\n‚Ä¢ –ü—Ä–∞–≤–∏–ª–∞ —Å–µ—Ä–≤–µ—Ä–∞\n‚Ä¢ –†–µ–ø–æ—Ä—Ç—ã –∏ –±–∞–Ω—ã\n‚Ä¢ –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è\n‚Ä¢ –ü–æ–º–æ—â—å –∏–≥—Ä–æ–∫–∞–º\n\n–ê–¥—Ä–µ—Å: forum.majesticrp.ru");
                DrawButton(g, btnForumBack);
            } else if (showDonate) {
                DrawContentScreen(g, L"üíé –ü–û–î–î–ï–†–ñ–ö–ê –ü–†–û–ï–ö–¢–ê", L"–ü–æ–¥–¥–µ—Ä–∂–∏—Ç–µ —Ä–∞–∑–≤–∏—Ç–∏–µ Majestic RP!\n\n–í–∞—à–∏ –¥–æ–Ω–∞—Ç—ã –ø–æ–º–æ–≥–∞—é—Ç:\n‚Ä¢ –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å —Å–µ—Ä–≤–µ—Ä—ã\n‚Ä¢ –†–∞–∑—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –Ω–æ–≤—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç\n‚Ä¢ –ü—Ä–æ–≤–æ–¥–∏—Ç—å —Å–æ–±—ã—Ç–∏—è\n‚Ä¢ –£–ª—É—á—à–∞—Ç—å –∏–≥—Ä–æ–≤–æ–π –æ–ø—ã—Ç\n\n–î–æ—Å—Ç—É–ø–Ω—ã–µ –ø–∞–∫–µ—Ç—ã:\n‚Ä¢ VIP - 299‚ÇΩ/–º–µ—Å—è—Ü\n‚Ä¢ Premium - 599‚ÇΩ/–º–µ—Å—è—Ü\n‚Ä¢ Diamond - 999‚ÇΩ/–º–µ—Å—è—Ü");
                DrawButton(g, btnDonateBack);
            } else if (showStats) {
                DrawContentScreen(g, L"üìä –í–ê–®–ê –°–¢–ê–¢–ò–°–¢–ò–ö–ê", L"–ò–≥—Ä–æ–≤–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞\n\n–û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:\n‚Ä¢ –£—Ä–æ–≤–µ–Ω—å: 47\n‚Ä¢ –ß–∞—Å–æ–≤ –≤ –∏–≥—Ä–µ: 234\n‚Ä¢ –î–µ–Ω—å–≥–∏: $2,847,500\n‚Ä¢ –†–µ–ø—É—Ç–∞—Ü–∏—è: 89%\n\n–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è:\n‚Ä¢ –ü–æ–ª—É—á–µ–Ω–æ: 34/120\n‚Ä¢ –†–µ–¥–∫–∏–µ: 5\n‚Ä¢ –õ–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–µ: 1");
                DrawButton(g, btnStatsBack);
            } else if (showRules) {
                DrawContentScreen(g, L"üìú –ü–†–ê–í–ò–õ–ê –°–ï–†–í–ï–†–ê", L"–û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞ Majestic RP\n\n1. –ó–∞–ø—Ä–µ—â–µ–Ω —á–∏—Ç–µ—Ä—Å—Ç–≤–æ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –±–∞–≥–æ–≤\n2. –£–≤–∞–∂–∞–π—Ç–µ –¥—Ä—É–≥–∏—Ö –∏–≥—Ä–æ–∫–æ–≤\n3. –ù–µ –æ—Å–∫–æ—Ä–±–ª—è–π—Ç–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏—é\n4. –°–ª–µ–¥—É–π—Ç–µ RP –ø—Ä–∞–≤–∏–ª–∞–º\n5. –ù–µ –Ω–∞—Ä—É—à–∞–π—Ç–µ –ø—Ä–∞–≤–∏–ª–∞ –¥–æ—Ä–æ–∂–Ω–æ–≥–æ –¥–≤–∏–∂–µ–Ω–∏—è –±–µ–∑ RP –ø—Ä–∏—á–∏–Ω\n6. –ó–∞–ø—Ä–µ—â–µ–Ω GTA Online –∫–æ–Ω—Ç–µ–Ω—Ç\n\n–ü–æ–ª–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞ –Ω–∞ —Ñ–æ—Ä—É–º–µ");
                DrawButton(g, btnRulesBack);
            } else if (showEvents) {
                DrawContentScreen(g, L"üé™ –ë–õ–ò–ñ–ê–ô–®–ò–ï –°–û–ë–´–¢–ò–Ø", L"–ö–∞–ª–µ–Ω–¥–∞—Ä—å —Å–æ–±—ã—Ç–∏–π –Ω–∞ Majestic RP\n\n–ë–ª–∏–∂–∞–π—à–∏–µ —Å–æ–±—ã—Ç–∏—è:\n‚Ä¢ 15.01 - –ì–æ–Ω–∫–∏ –Ω–∞ –≤—ã–∂–∏–≤–∞–Ω–∏–µ (20:00 –ú–°–ö)\n‚Ä¢ 17.01 - –ó–∞—Ö–≤–∞—Ç —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–π (19:00 –ú–°–ö)\n‚Ä¢ 20.01 - –¢—É—Ä–Ω–∏—Ä 1v1 (18:00 –ú–°–ö)\n‚Ä¢ 25.01 - –†–æ–∑—ã–≥—Ä—ã—à –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π (21:00 –ú–°–ö)\n\n–°–ª–µ–¥–∏—Ç–µ –∑–∞ –∞–Ω–æ–Ω—Å–∞–º–∏ –≤ Discord!");
                DrawButton(g, btnEventsBack);
            }
        }

        DrawButton(g, btnMinimize);
        DrawButton(g, btnMaximize);
        DrawButton(g, btnClose);

        if (hoveredButton && hoveredButton->tooltip && *hoveredButton->tooltip) {
            DrawTooltip(g, hoveredButton->tooltip, mousePos);
        }

        BitBlt(hdc, 0, 0, W, H, memDC, 0, 0, SRCCOPY);
        DeleteObject(memBmp);
        DeleteDC(memDC);
        EndPaint(hwnd, &ps);
        break;
    }

    case WM_MOUSEMOVE:
    {
        POINT p;
        GetCursorPos(&p);
        ScreenToClient(hwnd, &p);
        mousePos = p;

        if (isDragging) {
            POINT screenPos;
            GetCursorPos(&screenPos);
            SetWindowPos(hwnd, nullptr, 
                screenPos.x - dragOffset.x, 
                screenPos.y - dragOffset.y, 
                0, 0, SWP_NOSIZE | SWP_NOZORDER);
        }

        if (isResizingVolume && currentScreen == SCREEN_MAIN && showSettings) {
            int newVolume = (int)((p.x - 280) / 820.0f * 100);
            if (newVolume < 0) newVolume = 0;
            if (newVolume > 100) newVolume = 100;
            settingVolume = newVolume;
            InvalidateRect(hwnd, nullptr, FALSE);
        }

        Button* allButtons[] = {
            &btnPlay, &btnNews, &btnSettings, &btnDiscord, &btnForum,
            &btnDonate, &btnStats, &btnRules, &btnEvents,
            &btnMinimize, &btnMaximize, &btnClose,
            &btnNewsBack, &btnNewsPrev, &btnNewsNext,
            &btnSettingsBack, &btnCheckFullscreen, &btnCheckAutoUpdate,
            &btnCheckSound, &btnCheckNotify, &btnCheckFPS,
            &btnDiscordBack, &btnForumBack, &btnDonateBack,
            &btnStatsBack, &btnRulesBack, &btnEventsBack,
            &btnLogin, &btnToRegister, &btnRegister, &btnToLogin
        };

        InputField* allInputs[] = {
            &loginUsernameField, &loginPasswordField,
            &regUsernameField, &regEmailField, &regPasswordField
        };

        bool needRedraw = false;
        const Button* newHover = nullptr;

        for (auto btn : allButtons) {
            bool old = btn->hover;
            btn->hover = InRect(p, btn->rect);
            if (old != btn->hover) needRedraw = true;
            if (btn->hover) newHover = btn;
        }

        for (auto input : allInputs) {
            bool old = input->hover;
            input->hover = InRect(p, input->rect);
            if (old != input->hover) needRedraw = true;
        }

        if (hoveredButton != newHover) {
            hoveredButton = newHover;
            needRedraw = true;
        }

        if (needRedraw) InvalidateRect(hwnd, nullptr, FALSE);

        TRACKMOUSEEVENT tme = { sizeof(tme), TME_LEAVE, hwnd, 0 };
        TrackMouseEvent(&tme);
        break;
    }

    case WM_MOUSELEAVE:
        hoveredButton = nullptr;
        InvalidateRect(hwnd, nullptr, FALSE);
        break;

    case WM_LBUTTONDOWN:
    {
        POINT p;
        GetCursorPos(&p);
        ScreenToClient(hwnd, &p);

        // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ–∫–Ω–æ–º
        if (InRect(p, btnMinimize.rect)) {
            ShowWindow(hwnd, SW_MINIMIZE);
        } else if (InRect(p, btnMaximize.rect)) {
            if (!isFullscreen) {
                GetWindowRect(hwnd, &normalRect);
                SetWindowPos(hwnd, nullptr, 0, 0, 
                    GetSystemMetrics(SM_CXSCREEN), 
                    GetSystemMetrics(SM_CYSCREEN), 
                    SWP_NOZORDER);
                isFullscreen = true;
            } else {
                SetWindowPos(hwnd, nullptr, 
                    normalRect.left, normalRect.top,
                    normalRect.right - normalRect.left,
                    normalRect.bottom - normalRect.top,
                    SWP_NOZORDER);
                isFullscreen = false;
            }
        } else if (InRect(p, btnClose.rect)) {
            DestroyWindow(hwnd);
        }
        // –ü–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ –æ–∫–Ω–∞
        else if (p.y < 90 && p.x < W - 160) {
            isDragging = true;
            POINT screenPos;
            GetCursorPos(&screenPos);
            RECT windowRect;
            GetWindowRect(hwnd, &windowRect);
            dragOffset.x = screenPos.x - windowRect.left;
            dragOffset.y = screenPos.y - windowRect.top;
            SetCapture(hwnd);
        }
        // –í—Ö–æ–¥/–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
        else if (currentScreen == SCREEN_LOGIN || currentScreen == SCREEN_REGISTER) {
            activeInput = 0;
            loginUsernameField.active = false;
            loginPasswordField.active = false;
            regUsernameField.active = false;
            regEmailField.active = false;
            regPasswordField.active = false;

            if (InRect(p, loginUsernameField.rect)) {
                activeInput = 1;
                loginUsernameField.active = true;
            } else if (InRect(p, loginPasswordField.rect)) {
                activeInput = 2;
                loginPasswordField.active = true;
            } else if (InRect(p, regUsernameField.rect)) {
                activeInput = 3;
                regUsernameField.active = true;
            } else if (InRect(p, regEmailField.rect)) {
                activeInput = 4;
                regEmailField.active = true;
            } else if (InRect(p, regPasswordField.rect)) {
                activeInput = 5;
                regPasswordField.active = true;
            } else if (InRect(p, btnLogin.rect)) {
                currentScreen = SCREEN_MAIN;
                progress = 0.0f;
            } else if (InRect(p, btnRegister.rect)) {
                currentScreen = SCREEN_MAIN;
                progress = 0.0f;
            } else if (InRect(p, btnToRegister.rect)) {
                currentScreen = SCREEN_REGISTER;
            } else if (InRect(p, btnToLogin.rect)) {
                currentScreen = SCREEN_LOGIN;
            }
            InvalidateRect(hwnd, nullptr, FALSE);
        }
        // –ì–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω
        else if (currentScreen == SCREEN_MAIN) {
            if (showNews) {
                if (InRect(p, btnNewsBack.rect)) {
                    showNews = false;
                } else if (InRect(p, btnNewsPrev.rect)) {
                    currentNewsIndex = (currentNewsIndex - 1 + numNews) % numNews;
                } else if (InRect(p, btnNewsNext.rect)) {
                    currentNewsIndex = (currentNewsIndex + 1) % numNews;
                }
            } else if (showSettings) {
                if (InRect(p, btnSettingsBack.rect)) {
                    showSettings = false;
                } else if (InRect(p, btnCheckFullscreen.rect)) {
                    settingFullscreen = !settingFullscreen;
                } else if (InRect(p, btnCheckAutoUpdate.rect)) {
                    settingAutoUpdate = !settingAutoUpdate;
                } else if (InRect(p, btnCheckSound.rect)) {
                    settingSoundEffects = !settingSoundEffects;
                } else if (InRect(p, btnCheckNotify.rect)) {
                    settingNotifications = !settingNotifications;
                } else if (InRect(p, btnCheckFPS.rect)) {
                    settingFPS = !settingFPS;
                } else if (p.y >= 570 && p.y <= 586 && p.x >= 280 && p.x <= 1100) {
                    isResizingVolume = true;
                    SetCapture(hwnd);
                    int newVolume = (int)((p.x - 280) / 820.0f * 100);
                    if (newVolume < 0) newVolume = 0;
                    if (newVolume > 100) newVolume = 100;
                    settingVolume = newVolume;
                } else if (p.y >= 710 && p.y <= 755) {
                    if (p.x >= 280 && p.x < 540) settingGraphics = 0;
                    else if (p.x >= 560 && p.x < 820) settingGraphics = 1;
                    else if (p.x >= 840 && p.x < 1100) settingGraphics = 2;
                }
            } else if (showDiscord && InRect(p, btnDiscordBack.rect)) {
                showDiscord = false;
            } else if (showForum && InRect(p, btnForumBack.rect)) {
                showForum = false;
            } else if (showDonate && InRect(p, btnDonateBack.rect)) {
                showDonate = false;
            } else if (showStats && InRect(p, btnStatsBack.rect)) {
                showStats = false;
            } else if (showRules && InRect(p, btnRulesBack.rect)) {
                showRules = false;
            } else if (showEvents && InRect(p, btnEventsBack.rect)) {
                showEvents = false;
            } else {
                if (InRect(p, btnPlay.rect)) {
                    ShellExecuteW(nullptr, L"open", GTA_PATH, nullptr, nullptr, SW_SHOW);
                } else if (InRect(p, btnNews.rect)) {
                    showNews = true;
                } else if (InRect(p, btnSettings.rect)) {
                    showSettings = true;
                } else if (InRect(p, btnDiscord.rect)) {
                    showDiscord = true;
                } else if (InRect(p, btnForum.rect)) {
                    showForum = true;
                } else if (InRect(p, btnDonate.rect)) {
                    showDonate = true;
                } else if (InRect(p, btnStats.rect)) {
                    showStats = true;
                } else if (InRect(p, btnRules.rect)) {
                    showRules = true;
                } else if (InRect(p, btnEvents.rect)) {
                    showEvents = true;
                }
            }
            InvalidateRect(hwnd, nullptr, FALSE);
        }
        break;
    }

    case WM_LBUTTONUP:
        isDragging = false;
        isResizingVolume = false;
        ReleaseCapture();
        break;

    case WM_DESTROY:
        delete background;
        delete logo;
        for (int i = 0; i < numNews; ++i) delete newsImages[i];
        GdiplusShutdown(gdiToken);
        PostQuitMessage(0);
        break;

    default:
        return DefWindowProcW(hwnd, msg, wParam, lParam);
    }
    return 0;
}

// ================= ENTRY POINT =================
int WINAPI WinMain(HINSTANCE hInstance, HINSTANCE, LPSTR, int nCmdShow)
{
    GdiplusStartupInput gdiplusStartupInput;
    GdiplusStartup(&gdiToken, &gdiplusStartupInput, nullptr);

    WNDCLASSW wc = {};
    wc.lpfnWndProc    = WndProc;
    wc.hInstance      = hInstance;
    wc.lpszClassName  = L"MAJESTIC_LAUNCHER";
    wc.hCursor        = LoadCursor(nullptr, IDC_ARROW);
    wc.hbrBackground  = (HBRUSH)GetStockObject(BLACK_BRUSH);
    RegisterClassW(&wc);

    HWND hwnd = CreateWindowExW(
        WS_EX_LAYERED | WS_EX_APPWINDOW,
        wc.lpszClassName,
        L"Majestic RP Launcher",
        WS_POPUP,
        (GetSystemMetrics(SM_CXSCREEN) - W) / 2,
        (GetSystemMetrics(SM_CYSCREEN) - H) / 2,
        W, H,
        nullptr, nullptr, hInstance, nullptr
    );

    SetLayeredWindowAttributes(hwnd, 0, 255, LWA_ALPHA);
    ShowWindow(hwnd, SW_SHOW);
    UpdateWindow(hwnd);

    MSG msg = {};
    while (GetMessageW(&msg, nullptr, 0, 0)) {
        TranslateMessage(&msg);
        DispatchMessageW(&msg);
    }

    return (int)msg.wParam;
}
