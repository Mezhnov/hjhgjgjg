using Avalonia;
using Avalonia.Controls;
using Avalonia.Controls.ApplicationLifetimes;
using Avalonia.Interactivity;
using Avalonia.Markup.Xaml;
using Avalonia.Styling;
using System.Collections.Generic;
using System.IO;
using System.Text;

namespace SingleFileAvaloniaApp;

public class App : Application
{
    public override void Initialize()
    {
        using var stream = new MemoryStream(Encoding.UTF8.GetBytes(Xaml));
        AvaloniaXamlLoader.Load(this, stream);
    }

    public override void OnFrameworkInitializationCompleted()
    {
        if (ApplicationLifetime is IClassicDesktopStyleApplicationLifetime desktop)
            desktop.MainWindow = new MainWindow();

        base.OnFrameworkInitializationCompleted();
    }

    private const string Xaml = @"
<Application xmlns=""https://github.com/avaloniaui"">
    <Application.Styles>
        <FluentTheme />
    </Application.Styles>
</Application>";
}

public class MainWindow : Window
{
    private TextBlock _statusText;

    public MainWindow()
    {
        Title = "ÐœÐ°Ð³Ð°Ð·Ð¸Ð½ Ð¸Ð³Ñ€";
        Width = 500;
        Height = 400;

        var games = new List<Game>
        {
            new Game("Space Adventure", 499),
            new Game("Dungeon RPG", 799),
            new Game("Indie Puzzle", 299),
        };

        _statusText = new TextBlock
        {
            HorizontalAlignment = Avalonia.Layout.HorizontalAlignment.Center
        };

        Content = new StackPanel
        {
            Margin = new Thickness(20),
            Spacing = 10,
            Children =
            {
                new TextBlock
                {
                    Text = "ðŸŽ® ÐœÐ°Ð³Ð°Ð·Ð¸Ð½ Ð¸Ð³Ñ€",
                    FontSize = 22,
                    HorizontalAlignment = Avalonia.Layout.HorizontalAlignment.Center
                },

                new ListBox
                {
                    Items = games,
                    ItemTemplate = new FuncDataTemplate<Game>((game, _) =>
                        new StackPanel
                        {
                            Orientation = Avalonia.Layout.Orientation.Horizontal,
                            Spacing = 10,
                            Children =
                            {
                                new TextBlock { Text = game.Name, Width = 200 },
                                new TextBlock { Text = game.Price + " â‚½", Width = 80 },
                                new Button
                                {
                                    Content = "ÐšÑƒÐ¿Ð¸Ñ‚ÑŒ",
                                    Click = (_, _) => BuyGame(game)
                                }
                            }
                        })
                },

                _statusText
            }
        };
    }

    private void BuyGame(Game game)
    {
        _statusText.Text = "Ð’Ñ‹ ÐºÑƒÐ¿Ð¸Ð»Ð¸: " + game.Name + " ðŸŽ‰";
    }
}

public class Game
{
    public string Name { get; }
    public int Price { get; }

    public Game(string name, int price)
    {
        Name = name;
        Price = price;
    }
}

class Program
{
    public static void Main(string[] args)
        => AppBuilder.Configure<App>()
            .UsePlatformDetect()
            .StartWithClassicDesktopLifetime(args);
}
